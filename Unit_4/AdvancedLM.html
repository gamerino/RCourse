<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AdvancedLM</title><script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    jax: ["input/TeX","output/HTML-CSS"],
    extensions: ["[a11y]/accessibility-menu.js"],
    'HTML-CSS': {
      availableFonts: [],
      webFont: 'TeX',
      undefinedFamily: "serif",
      mtextFontInherit: true,
    },
    TeX: {
  "Macros": {},
  "equationNumbers": {},
  "extensions": [
    "AMSmath.js",
    "AMSsymbols.js",
    "noErrors.js",
    "noUndefined.js"
  ]
},
    showMathMenu: true
  });
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js"></script>
    <style>body { padding: 0; margin: 0; }
.markdown-preview-plus-view:not([data-use-github-style]) {
  padding: 2em;
  font-size: 1.2em;
  color: #657b83;
  background-color: #fdf6e3;
}
.markdown-preview-plus-view:not([data-use-github-style]) span.critic.comment > span {
  background-color: #fdf6e3;
}
.markdown-preview-plus-view:not([data-use-github-style]) > :first-child {
  margin-top: 0;
}
.markdown-preview-plus-view:not([data-use-github-style]) h1,
.markdown-preview-plus-view:not([data-use-github-style]) h2,
.markdown-preview-plus-view:not([data-use-github-style]) h3,
.markdown-preview-plus-view:not([data-use-github-style]) h4,
.markdown-preview-plus-view:not([data-use-github-style]) h5,
.markdown-preview-plus-view:not([data-use-github-style]) h6 {
  line-height: 1.2;
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  color: #1e2427;
}
.markdown-preview-plus-view:not([data-use-github-style]) h1 {
  font-size: 2.4em;
  font-weight: 300;
}
.markdown-preview-plus-view:not([data-use-github-style]) h2 {
  font-size: 1.8em;
  font-weight: 400;
}
.markdown-preview-plus-view:not([data-use-github-style]) h3 {
  font-size: 1.5em;
  font-weight: 500;
}
.markdown-preview-plus-view:not([data-use-github-style]) h4 {
  font-size: 1.2em;
  font-weight: 600;
}
.markdown-preview-plus-view:not([data-use-github-style]) h5 {
  font-size: 1.1em;
  font-weight: 600;
}
.markdown-preview-plus-view:not([data-use-github-style]) h6 {
  font-size: 1em;
  font-weight: 600;
}
.markdown-preview-plus-view:not([data-use-github-style]) strong {
  color: #1e2427;
}
.markdown-preview-plus-view:not([data-use-github-style]) del {
  color: #90a3a9;
}
.markdown-preview-plus-view:not([data-use-github-style]) a,
.markdown-preview-plus-view:not([data-use-github-style]) a code {
  color: #002b36;
}
.markdown-preview-plus-view:not([data-use-github-style]) img {
  max-width: 100%;
}
.markdown-preview-plus-view:not([data-use-github-style]) > p {
  margin-top: 0;
  margin-bottom: 1.5em;
}
.markdown-preview-plus-view:not([data-use-github-style]) > ul,
.markdown-preview-plus-view:not([data-use-github-style]) > ol {
  margin-bottom: 1.5em;
}
.markdown-preview-plus-view:not([data-use-github-style]) blockquote {
  margin: 1.5em 0;
  font-size: inherit;
  color: #90a3a9;
  border-color: #f8de97;
  border-width: 4px;
}
.markdown-preview-plus-view:not([data-use-github-style]) hr {
  margin: 3em 0;
  border-top: 2px dashed #f8de97;
  background: none;
}
.markdown-preview-plus-view:not([data-use-github-style]) table {
  margin: 1.5em 0;
}
.markdown-preview-plus-view:not([data-use-github-style]) th {
  color: #1e2427;
}
.markdown-preview-plus-view:not([data-use-github-style]) th,
.markdown-preview-plus-view:not([data-use-github-style]) td {
  padding: 0.66em 1em;
  border: 1px solid #f8de97;
}
.markdown-preview-plus-view:not([data-use-github-style]) pre,
.markdown-preview-plus-view:not([data-use-github-style]) code {
  color: #1e2427;
  background-color: #fbedc6;
}
.markdown-preview-plus-view:not([data-use-github-style]) pre,
.markdown-preview-plus-view:not([data-use-github-style]) pre.editor-colors {
  margin: 1.5em 0;
  padding: 1em;
  font-size: 0.92em;
  border-radius: 3px;
  background-color: #fcf0d0;
}
.markdown-preview-plus-view:not([data-use-github-style]) kbd {
  color: #1e2427;
  border: 1px solid #f8de97;
  border-bottom: 2px solid #f6d47a;
  background-color: #fbedc6;
}

@include 'style-variables';
.markdown-preview-plus-view {
  display: block;
  overflow-x: hidden;
}
.markdown-preview-plus-view .emoji {
  max-width: 1em !important;
}
.markdown-preview-plus-view del {
  text-decoration: none;
  position: relative;
}
.markdown-preview-plus-view del::after {
  border-bottom: 1px solid black;
  content: '';
  left: 0;
  position: absolute;
  right: 0;
  top: 50%;
}
.markdown-preview-plus-view ul.contains-task-list li.task-list-item {
  position: relative;
  list-style-type: none;
}
.markdown-preview-plus-view ul.contains-task-list li.task-list-item input.task-list-item-checkbox {
  position: absolute;
  transform: translateX(-100%);
  width: 30px;
}
.markdown-preview-plus-view span.critic.comment {
  position: relative;
}
.markdown-preview-plus-view span.critic.comment::before {
  content: '\1f4ac';
  position: initial;
}
.markdown-preview-plus-view span.critic.comment > span {
  display: none;
}
.markdown-preview-plus-view span.critic.comment:hover > span {
  display: initial;
  position: absolute;
  top: 100%;
  left: 0;
  border: 1px solid;
  border-radius: 5px;
  max-height: 4em;
  overflow: auto;
}
.markdown-preview-plus-view span.critic.comment:focus > span {
  display: initial;
  text-decoration: underline;
  position: initial;
  top: auto;
  left: auto;
  border: initial;
  border-radius: initial;
}

body.markdown-preview-plus-view[data-use-github-style] {
  overflow: initial !important;
}
.markdown-preview-plus-view[data-use-github-style] {
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  line-height: 1.6;
  word-wrap: break-word;
  padding: 30px;
  font-size: 16px;
  color: #333;
  background-color: #fff;
}
.markdown-preview-plus-view[data-use-github-style] > *:first-child {
  margin-top: 0 !important;
}
.markdown-preview-plus-view[data-use-github-style] > *:last-child {
  margin-bottom: 0 !important;
}
.markdown-preview-plus-view[data-use-github-style] a:not([href]) {
  color: inherit;
  text-decoration: none;
}
.markdown-preview-plus-view[data-use-github-style] .absent {
  color: #c00;
}
.markdown-preview-plus-view[data-use-github-style] .anchor {
  position: absolute;
  top: 0;
  left: 0;
  display: block;
  padding-right: 6px;
  padding-left: 30px;
  margin-left: -30px;
}
.markdown-preview-plus-view[data-use-github-style] .anchor:focus {
  outline: none;
}
.markdown-preview-plus-view[data-use-github-style] h1,
.markdown-preview-plus-view[data-use-github-style] h2,
.markdown-preview-plus-view[data-use-github-style] h3,
.markdown-preview-plus-view[data-use-github-style] h4,
.markdown-preview-plus-view[data-use-github-style] h5,
.markdown-preview-plus-view[data-use-github-style] h6 {
  position: relative;
  margin-top: 1em;
  margin-bottom: 16px;
  font-weight: bold;
  line-height: 1.4;
}
.markdown-preview-plus-view[data-use-github-style] h1 .octicon-link,
.markdown-preview-plus-view[data-use-github-style] h2 .octicon-link,
.markdown-preview-plus-view[data-use-github-style] h3 .octicon-link,
.markdown-preview-plus-view[data-use-github-style] h4 .octicon-link,
.markdown-preview-plus-view[data-use-github-style] h5 .octicon-link,
.markdown-preview-plus-view[data-use-github-style] h6 .octicon-link {
  display: none;
  color: #000;
  vertical-align: middle;
}
.markdown-preview-plus-view[data-use-github-style] h1:hover .anchor,
.markdown-preview-plus-view[data-use-github-style] h2:hover .anchor,
.markdown-preview-plus-view[data-use-github-style] h3:hover .anchor,
.markdown-preview-plus-view[data-use-github-style] h4:hover .anchor,
.markdown-preview-plus-view[data-use-github-style] h5:hover .anchor,
.markdown-preview-plus-view[data-use-github-style] h6:hover .anchor {
  padding-left: 8px;
  margin-left: -30px;
  text-decoration: none;
}
.markdown-preview-plus-view[data-use-github-style] h1:hover .anchor .octicon-link,
.markdown-preview-plus-view[data-use-github-style] h2:hover .anchor .octicon-link,
.markdown-preview-plus-view[data-use-github-style] h3:hover .anchor .octicon-link,
.markdown-preview-plus-view[data-use-github-style] h4:hover .anchor .octicon-link,
.markdown-preview-plus-view[data-use-github-style] h5:hover .anchor .octicon-link,
.markdown-preview-plus-view[data-use-github-style] h6:hover .anchor .octicon-link {
  display: inline-block;
}
.markdown-preview-plus-view[data-use-github-style] h1 tt,
.markdown-preview-plus-view[data-use-github-style] h2 tt,
.markdown-preview-plus-view[data-use-github-style] h3 tt,
.markdown-preview-plus-view[data-use-github-style] h4 tt,
.markdown-preview-plus-view[data-use-github-style] h5 tt,
.markdown-preview-plus-view[data-use-github-style] h6 tt,
.markdown-preview-plus-view[data-use-github-style] h1 code,
.markdown-preview-plus-view[data-use-github-style] h2 code,
.markdown-preview-plus-view[data-use-github-style] h3 code,
.markdown-preview-plus-view[data-use-github-style] h4 code,
.markdown-preview-plus-view[data-use-github-style] h5 code,
.markdown-preview-plus-view[data-use-github-style] h6 code {
  font-size: inherit;
}
.markdown-preview-plus-view[data-use-github-style] h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}
.markdown-preview-plus-view[data-use-github-style] h1 .anchor {
  line-height: 1;
}
.markdown-preview-plus-view[data-use-github-style] h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}
.markdown-preview-plus-view[data-use-github-style] h2 .anchor {
  line-height: 1;
}
.markdown-preview-plus-view[data-use-github-style] h3 {
  font-size: 1.5em;
  line-height: 1.43;
}
.markdown-preview-plus-view[data-use-github-style] h3 .anchor {
  line-height: 1.2;
}
.markdown-preview-plus-view[data-use-github-style] h4 {
  font-size: 1.25em;
}
.markdown-preview-plus-view[data-use-github-style] h4 .anchor {
  line-height: 1.2;
}
.markdown-preview-plus-view[data-use-github-style] h5 {
  font-size: 1em;
}
.markdown-preview-plus-view[data-use-github-style] h5 .anchor {
  line-height: 1.1;
}
.markdown-preview-plus-view[data-use-github-style] h6 {
  font-size: 1em;
  color: #777;
}
.markdown-preview-plus-view[data-use-github-style] h6 .anchor {
  line-height: 1.1;
}
.markdown-preview-plus-view[data-use-github-style] p,
.markdown-preview-plus-view[data-use-github-style] blockquote,
.markdown-preview-plus-view[data-use-github-style] ul,
.markdown-preview-plus-view[data-use-github-style] ol,
.markdown-preview-plus-view[data-use-github-style] dl,
.markdown-preview-plus-view[data-use-github-style] table,
.markdown-preview-plus-view[data-use-github-style] pre {
  margin-top: 0;
  margin-bottom: 16px;
}
.markdown-preview-plus-view[data-use-github-style] hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}
.markdown-preview-plus-view[data-use-github-style] ul,
.markdown-preview-plus-view[data-use-github-style] ol {
  padding-left: 2em;
}
.markdown-preview-plus-view[data-use-github-style] ul.no-list,
.markdown-preview-plus-view[data-use-github-style] ol.no-list {
  padding: 0;
  list-style-type: none;
}
.markdown-preview-plus-view[data-use-github-style] ul ul,
.markdown-preview-plus-view[data-use-github-style] ul ol,
.markdown-preview-plus-view[data-use-github-style] ol ol,
.markdown-preview-plus-view[data-use-github-style] ol ul {
  margin-top: 0;
  margin-bottom: 0;
}
.markdown-preview-plus-view[data-use-github-style] li > p {
  margin-top: 16px;
}
.markdown-preview-plus-view[data-use-github-style] dl {
  padding: 0;
}
.markdown-preview-plus-view[data-use-github-style] dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}
.markdown-preview-plus-view[data-use-github-style] dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}
.markdown-preview-plus-view[data-use-github-style] blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}
.markdown-preview-plus-view[data-use-github-style] blockquote > :first-child {
  margin-top: 0;
}
.markdown-preview-plus-view[data-use-github-style] blockquote > :last-child {
  margin-bottom: 0;
}
.markdown-preview-plus-view[data-use-github-style] table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}
.markdown-preview-plus-view[data-use-github-style] table th {
  font-weight: bold;
}
.markdown-preview-plus-view[data-use-github-style] table th,
.markdown-preview-plus-view[data-use-github-style] table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}
.markdown-preview-plus-view[data-use-github-style] table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}
.markdown-preview-plus-view[data-use-github-style] table tr:nth-child(2n) {
  background-color: #f8f8f8;
}
.markdown-preview-plus-view[data-use-github-style] img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}
.markdown-preview-plus-view[data-use-github-style] .emoji {
  max-width: none;
}
.markdown-preview-plus-view[data-use-github-style] span.frame {
  display: block;
  overflow: hidden;
}
.markdown-preview-plus-view[data-use-github-style] span.frame > span {
  display: block;
  float: left;
  width: auto;
  padding: 7px;
  margin: 13px 0 0;
  overflow: hidden;
  border: 1px solid #ddd;
}
.markdown-preview-plus-view[data-use-github-style] span.frame span img {
  display: block;
  float: left;
}
.markdown-preview-plus-view[data-use-github-style] span.frame span span {
  display: block;
  padding: 5px 0 0;
  clear: both;
  color: #333;
}
.markdown-preview-plus-view[data-use-github-style] span.align-center {
  display: block;
  overflow: hidden;
  clear: both;
}
.markdown-preview-plus-view[data-use-github-style] span.align-center > span {
  display: block;
  margin: 13px auto 0;
  overflow: hidden;
  text-align: center;
}
.markdown-preview-plus-view[data-use-github-style] span.align-center span img {
  margin: 0 auto;
  text-align: center;
}
.markdown-preview-plus-view[data-use-github-style] span.align-right {
  display: block;
  overflow: hidden;
  clear: both;
}
.markdown-preview-plus-view[data-use-github-style] span.align-right > span {
  display: block;
  margin: 13px 0 0;
  overflow: hidden;
  text-align: right;
}
.markdown-preview-plus-view[data-use-github-style] span.align-right span img {
  margin: 0;
  text-align: right;
}
.markdown-preview-plus-view[data-use-github-style] span.float-left {
  display: block;
  float: left;
  margin-right: 13px;
  overflow: hidden;
}
.markdown-preview-plus-view[data-use-github-style] span.float-left span {
  margin: 13px 0 0;
}
.markdown-preview-plus-view[data-use-github-style] span.float-right {
  display: block;
  float: right;
  margin-left: 13px;
  overflow: hidden;
}
.markdown-preview-plus-view[data-use-github-style] span.float-right > span {
  display: block;
  margin: 13px auto 0;
  overflow: hidden;
  text-align: right;
}
.markdown-preview-plus-view[data-use-github-style] code,
.markdown-preview-plus-view[data-use-github-style] tt {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0, 0, 0, 0.04);
  border-radius: 3px;
}
.markdown-preview-plus-view[data-use-github-style] code:before,
.markdown-preview-plus-view[data-use-github-style] tt:before,
.markdown-preview-plus-view[data-use-github-style] code:after,
.markdown-preview-plus-view[data-use-github-style] tt:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}
.markdown-preview-plus-view[data-use-github-style] code br,
.markdown-preview-plus-view[data-use-github-style] tt br {
  display: none;
}
.markdown-preview-plus-view[data-use-github-style] del code {
  text-decoration: inherit;
}
.markdown-preview-plus-view[data-use-github-style] pre > code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}
.markdown-preview-plus-view[data-use-github-style] .highlight {
  margin-bottom: 16px;
}
.markdown-preview-plus-view[data-use-github-style] .highlight pre,
.markdown-preview-plus-view[data-use-github-style] pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}
.markdown-preview-plus-view[data-use-github-style] .highlight pre {
  margin-bottom: 0;
  word-break: normal;
}
.markdown-preview-plus-view[data-use-github-style] pre {
  word-wrap: normal;
}
.markdown-preview-plus-view[data-use-github-style] pre code,
.markdown-preview-plus-view[data-use-github-style] pre tt {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}
.markdown-preview-plus-view[data-use-github-style] pre code:before,
.markdown-preview-plus-view[data-use-github-style] pre tt:before,
.markdown-preview-plus-view[data-use-github-style] pre code:after,
.markdown-preview-plus-view[data-use-github-style] pre tt:after {
  content: normal;
}
.markdown-preview-plus-view[data-use-github-style] kbd {
  display: inline-block;
  padding: 3px 5px;
  font-size: 11px;
  line-height: 10px;
  color: #555;
  vertical-align: middle;
  background-color: #fcfcfc;
  border: solid 1px #ccc;
  border-bottom-color: #bbb;
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 #bbb;
}
.markdown-preview-plus-view[data-use-github-style] span.critic.comment > span {
  background-color: #fff;
}
.markdown-preview-plus-view[data-use-github-style] a {
  color: #337ab7;
}
.markdown-preview-plus-view[data-use-github-style] pre,
.markdown-preview-plus-view[data-use-github-style] code {
  color: inherit;
}
.markdown-preview-plus-view[data-use-github-style] pre,
.markdown-preview-plus-view[data-use-github-style] pre.editor-colors {
  padding: 0.8em 1em;
  margin-bottom: 1em;
  font-size: 0.85em;
  border-radius: 4px;
  overflow: auto;
}

.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}
.line-number.bracket-matcher.bracket-matcher {
  color: #002b36;
  background-color: #dfd4b1;
}

.spell-check-misspelling .region {
  border-bottom: 2px dotted rgba(255, 51, 51, 0.75);
}
.spell-check-corrections {
  width: 25em !important;
}

pre.editor-colors {
  color: #657b83;
  background-color: #fdf6e3;
}
pre.editor-colors .gutter {
  color: #657b83;
  background-color: #eee8d5;
}
pre.editor-colors .gutter .line-number.cursor-line {
  background-color: #dfd4b1;
}
pre.editor-colors .invisible-character {
  color: #dcd0a9;
}
pre.editor-colors .indent-guide {
  color: #dcd0a9;
}
pre.editor-colors .cursor {
  border-color: #002b36;
}
pre.editor-colors .selection .region {
  background-color: #eee8d5;
}
pre.editor-colors .fold-marker:after,
pre.editor-colors .gutter .line-number.folded {
  color: #d33682;
}
pre.editor-colors .bracket-matcher .region {
  border-color: #d33682;
}
.syntax--comment {
  color: #93a1a1;
  font-style: italic;
}
.syntax--comment .syntax--markup.syntax--link {
  color: #93a1a1;
}
.syntax--string {
  color: #2aa198;
}
.syntax--string.syntax--regexp {
  color: #dc322f;
}
.syntax--constant.syntax--numeric {
  color: #d33682;
}
.syntax--constant.syntax--language {
  color: #b58900;
}
.syntax--constant.syntax--character,
.syntax--constant.syntax--other {
  color: #cb4b16;
}
.syntax--variable {
  color: #268bd2;
}
.syntax--keyword {
  color: #859900;
}
.syntax--storage {
  color: #859900;
}
.syntax--entity.syntax--name.syntax--class,
.syntax--entity.syntax--name.syntax--type,
.syntax--entity.syntax--name.syntax--function {
  color: #268bd2;
}
.syntax--entity.syntax--other.syntax--attribute-name {
  color: #657b83;
}
.syntax--support.syntax--function {
  color: #268bd2;
}
.syntax--support.syntax--function.syntax--builtin {
  color: #859900;
}
.syntax--support.syntax--type,
.syntax--support.syntax--class {
  color: #859900;
}
.syntax--tag.syntax--entity.syntax--name {
  color: #268bd2;
}
.syntax--tag.syntax--punctuation.syntax--definition.syntax--html,
.syntax--tag.syntax--punctuation.syntax--definition.syntax--begin,
.syntax--tag.syntax--punctuation.syntax--definition.syntax--end {
  color: #93a1a1;
}
.syntax--invalid.syntax--deprecated {
  color: #b58900;
  text-decoration: underline;
}
.syntax--invalid.syntax--illegal {
  color: #dc322f;
  text-decoration: underline;
}
.syntax--none {
  color: #657b83;
}
.syntax--source.syntax--c .syntax--meta.syntax--preprocessor,
.syntax--source.syntax--cpp .syntax--meta.syntax--preprocessor {
  color: #dc322f;
}
.syntax--source.syntax--c .syntax--keyword.syntax--control.syntax--directive,
.syntax--source.syntax--cpp .syntax--keyword.syntax--control.syntax--directive {
  color: #cb4b16;
}
.syntax--source.syntax--c .syntax--punctuation.syntax--string,
.syntax--source.syntax--cpp .syntax--punctuation.syntax--string {
  color: #2aa198;
}
.syntax--source.syntax--c .syntax--constant,
.syntax--source.syntax--cpp .syntax--constant {
  color: #cb4b16;
}
.syntax--source.syntax--c .syntax--constant.syntax--numeric,
.syntax--source.syntax--cpp .syntax--constant.syntax--numeric,
.syntax--source.syntax--c .syntax--constant.syntax--language.syntax--c,
.syntax--source.syntax--cpp .syntax--constant.syntax--language.syntax--c {
  color: #2aa198;
}
.syntax--source.syntax--c .syntax--storage,
.syntax--source.syntax--cpp .syntax--storage {
  color: #b58900;
}
.syntax--source.syntax--c .syntax--entity,
.syntax--source.syntax--cpp .syntax--entity {
  color: #657b83;
}
.syntax--source.syntax--c .syntax--entity.syntax--name.syntax--function.syntax--preprocessor,
.syntax--source.syntax--cpp .syntax--entity.syntax--name.syntax--function.syntax--preprocessor {
  color: #dc322f;
}
.syntax--source.syntax--c .syntax--support.syntax--type,
.syntax--source.syntax--cpp .syntax--support.syntax--type {
  color: #b58900;
}
.syntax--source.syntax--c .syntax--support.syntax--type.syntax--posix-reserved,
.syntax--source.syntax--cpp .syntax--support.syntax--type.syntax--posix-reserved {
  color: #657b83;
}
.syntax--source.syntax--c .syntax--variable.syntax--other.syntax--dot-access,
.syntax--source.syntax--cpp .syntax--variable.syntax--other.syntax--dot-access {
  color: #657b83;
}
.syntax--source.syntax--c .syntax--variable.syntax--parameter.syntax--preprocessor,
.syntax--source.syntax--cpp .syntax--variable.syntax--parameter.syntax--preprocessor {
  color: #dc322f;
}
.syntax--source.syntax--coffee .syntax--support.syntax--class {
  color: #859900;
}
.syntax--source.syntax--coffee .syntax--variable,
.syntax--source.syntax--coffee .syntax--entity.syntax--name.syntax--function,
.syntax--source.syntax--coffee .syntax--entity.syntax--name.syntax--class {
  color: #268bd2;
}
.syntax--source.syntax--coffee .syntax--variable.syntax--parameter.syntax--function {
  color: #657b83;
}
.syntax--source.syntax--coffee .syntax--variable.syntax--other.syntax--readwrite {
  color: #859900;
}
.syntax--source.syntax--coffee .syntax--storage.syntax--type.syntax--function {
  color: #859900;
}
.syntax--source.syntax--coffee .syntax--entity.syntax--name {
  color: #657b83;
}
.syntax--source.syntax--coffee .syntax--meta.syntax--brace.syntax--round,
.syntax--source.syntax--coffee .syntax--meta.syntax--brace.syntax--square {
  color: #657b83;
}
.syntax--source.syntax--coffee .syntax--meta.syntax--delimiter {
  color: #657b83;
}
.syntax--source.syntax--coffee .syntax--storage.syntax--type.syntax--class {
  color: #859900;
}
.syntax--source.syntax--coffee .syntax--punctuation.syntax--terminator {
  color: #657b83;
}
.syntax--source.syntax--coffee .syntax--punctuation.syntax--section.syntax--embedded {
  color: #dc322f;
}
.syntax--source.syntax--coffee .syntax--embedded.syntax--source {
  color: #657b83;
}
.syntax--source.syntax--coffee .syntax--constant.syntax--numeric {
  color: #d33682;
}
.syntax--source.syntax--coffee .syntax--constant.syntax--language.syntax--boolean {
  color: #b58900;
}
.syntax--source.syntax--css .syntax--punctuation.syntax--separator,
.syntax--source.syntax--css .syntax--punctuation.syntax--terminator {
  color: #657b83;
}
.syntax--source.syntax--css .syntax--punctuation.syntax--property-list.syntax--begin,
.syntax--source.syntax--css .syntax--punctuation.syntax--property-list.syntax--end {
  color: #dc322f;
}
.syntax--source.syntax--css .syntax--punctuation.syntax--section.syntax--function {
  color: #2aa198;
}
.syntax--source.syntax--css .syntax--entity.syntax--name {
  color: #859900;
}
.syntax--source.syntax--css .syntax--attribute-name.syntax--class,
.syntax--source.syntax--css .syntax--id {
  color: #268bd2;
}
.syntax--source.syntax--css .syntax--pseudo-element,
.syntax--source.syntax--css .syntax--pseudo-class {
  color: #cb4b16;
}
.syntax--source.syntax--css .syntax--property-value {
  color: #2aa198;
}
.syntax--source.syntax--css .syntax--constant.syntax--numeric {
  color: #2aa198;
}
.syntax--source.syntax--css .syntax--constant.syntax--numeric .syntax--unit {
  color: #2aa198;
}
.syntax--source.syntax--css .syntax--rgb-value {
  color: #2aa198;
}
.syntax--source.syntax--css .syntax--support.syntax--constant {
  color: #2aa198;
}
.syntax--source.syntax--css .syntax--support.syntax--constant.syntax--media {
  color: #dc322f;
}
.syntax--source.syntax--css .syntax--keyword.syntax--important {
  color: #dc322f;
}
.syntax--source.syntax--less .syntax--keyword.syntax--unit,
.syntax--source.syntax--scss .syntax--keyword.syntax--unit {
  color: #2aa198;
}
.syntax--source.syntax--go .syntax--operator {
  color: #657b83;
}
.syntax--source.syntax--go .syntax--operator.syntax--assignment {
  color: #859900;
}
.syntax--source.syntax--java .syntax--keyword.syntax--operator {
  color: #859900;
}
.syntax--source.syntax--java .syntax--keyword.syntax--import {
  color: #cb4b16;
}
.syntax--source.syntax--java .syntax--storage.syntax--modifier.syntax--import {
  color: #93a1a1;
}
.syntax--source.syntax--java .syntax--meta.syntax--class .syntax--storage.syntax--modifier {
  color: #b58900;
}
.syntax--source.syntax--java .syntax--meta.syntax--class .syntax--meta.syntax--class.syntax--identifier .syntax--entity.syntax--name.syntax--type.syntax--class {
  color: #268bd2;
}
.syntax--source.syntax--java .syntax--storage.syntax--type.syntax--primitive.syntax--array {
  color: #859900;
}
.syntax--source.syntax--java .syntax--constant.syntax--numeric {
  color: #d33682;
}
.syntax--source.syntax--java .syntax--constant.syntax--other {
  color: #cb4b16;
}
.syntax--source.syntax--java .syntax--storage.syntax--type {
  color: #859900;
}
.syntax--source.syntax--java .syntax--meta.syntax--method-call {
  color: #dc322f;
}
.syntax--source.syntax--java .syntax--meta.syntax--method-call .syntax--meta.syntax--method {
  color: #6c71c4;
}
.syntax--source.syntax--java .syntax--meta.syntax--method-call .syntax--punctuation.syntax--definition.syntax--seperator.syntax--parameter {
  color: #859900;
}
.syntax--source.syntax--java .syntax--punctuation.syntax--definition.syntax--method-parameters {
  color: #586e75;
}
.syntax--source.syntax--js .syntax--constant {
  color: #859900;
}
.syntax--source.syntax--js .syntax--comma {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--support.syntax--class {
  color: #859900;
}
.syntax--source.syntax--js .syntax--entity.syntax--name.syntax--type {
  color: #b58900;
}
.syntax--source.syntax--js .syntax--entity.syntax--name {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--meta.syntax--brace {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--keyword {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--keyword.syntax--operator.syntax--new {
  color: #859900;
}
.syntax--source.syntax--js .syntax--keyword.syntax--control {
  color: #859900;
}
.syntax--source.syntax--js .syntax--keyword.syntax--control.syntax--regexp {
  color: #2aa198;
}
.syntax--source.syntax--js .syntax--variable {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--variable.syntax--dom {
  color: #859900;
}
.syntax--source.syntax--js .syntax--delimiter + .syntax--dom {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--name {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--variable.syntax--language {
  color: #268bd2;
}
.syntax--source.syntax--js .syntax--variable.syntax--parameter {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--regexp {
  color: #2aa198;
}
.syntax--source.syntax--js .syntax--support.syntax--function {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--support.syntax--constant {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--storage {
  color: #268bd2;
}
.syntax--source.syntax--js .syntax--constant.syntax--numeric {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--punctuation.syntax--terminator.syntax--statement {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--meta.syntax--delimiter.syntax--method.syntax--period {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--meta.syntax--brace.syntax--square {
  color: #268bd2;
}
.syntax--source.syntax--js .syntax--meta.syntax--brace.syntax--curly {
  color: #268bd2;
}
.syntax--source.syntax--js .syntax--definition.syntax--begin.syntax--curly,
.syntax--source.syntax--js .syntax--definition.syntax--end.syntax--curly {
  color: #268bd2;
}
.syntax--source.syntax--js .syntax--string.syntax--quoted.syntax--template .syntax--embedded.syntax--source {
  color: #657b83;
}
.syntax--source.syntax--js .syntax--string.syntax--quoted.syntax--template .syntax--embedded.syntax--source > .syntax--embedded.syntax--punctuation {
  color: #dc322f;
}
.syntax--source.syntax--js.syntax--embedded .syntax--entity.syntax--name.syntax--tag {
  color: #268bd2;
}
.syntax--source.syntax--js.syntax--jsx .syntax--entity.syntax--name.syntax--tag {
  color: #268bd2;
}
.syntax--gfm .syntax--link .syntax--entity {
  color: #6c71c4;
}
.syntax--gfm .syntax--list.syntax--ordered {
  color: #859900;
}
.syntax--gfm .syntax--list.syntax--unordered {
  color: #b58900;
}
.syntax--gfm .syntax--raw {
  font-style: italic;
}
.syntax--gfm.syntax--support {
  color: #93a1a1;
}
.syntax--gfm.syntax--support.syntax--quote {
  color: #6c71c4;
}
.syntax--markup.syntax--bold {
  font-weight: bold;
}
.syntax--markup.syntax--italic {
  font-style: italic;
}
.syntax--markup.syntax--heading {
  color: #268bd2;
}
.syntax--markup.syntax--link {
  color: #2aa198;
}
.syntax--markup.syntax--deleted {
  color: #dc322f;
}
.syntax--markup.syntax--changed {
  color: #b58900;
}
.syntax--markup.syntax--inserted {
  color: #2aa198;
}
.syntax--source.syntax--php .syntax--storage.syntax--type.syntax--class {
  color: #b58900;
}
.syntax--source.syntax--php .syntax--storage.syntax--type.syntax--function {
  color: #cb4b16;
}
.syntax--source.syntax--php .syntax--storage.syntax--modifier {
  color: #b58900;
}
.syntax--source.syntax--php .syntax--entity.syntax--name.syntax--type.syntax--class {
  color: #657b83;
}
.syntax--source.syntax--php .syntax--entity.syntax--name.syntax--function {
  color: #657b83;
}
.syntax--source.syntax--php .syntax--entity.syntax--other {
  color: #657b83;
}
.syntax--source.syntax--php .syntax--variable {
  color: #268bd2;
}
.syntax--source.syntax--php .syntax--punctuation.syntax--definition {
  color: #657b83;
}
.syntax--source.syntax--php .syntax--punctuation.syntax--definition.syntax--comment {
  color: #93a1a1;
}
.syntax--source.syntax--php .syntax--punctuation.syntax--definition.syntax--array {
  color: #dc322f;
}
.syntax--source.syntax--php .syntax--punctuation.syntax--definition.syntax--string {
  color: #657b83;
}
.syntax--source.syntax--php .syntax--punctuation.syntax--definition.syntax--variable {
  color: #859900;
}
.syntax--source.syntax--php .syntax--support.syntax--function.syntax--construct {
  color: #b58900;
}
.syntax--source.syntax--php .syntax--support.syntax--function.syntax--array {
  color: #859900;
}
.syntax--source.syntax--php .syntax--keyword.syntax--operator.syntax--class {
  color: #b58900;
}
.syntax--source.syntax--php .syntax--keyword.syntax--operator.syntax--assignment {
  color: #859900;
}
.syntax--source.syntax--php .syntax--keyword.syntax--other {
  color: #dc322f;
}
.syntax--source.syntax--python .syntax--entity {
  color: #657b83;
}
.syntax--source.syntax--python .syntax--entity.syntax--name {
  color: #268bd2;
}
.syntax--source.syntax--python .syntax--entity.syntax--other {
  color: #268bd2;
}
.syntax--source.syntax--python .syntax--function {
  color: #268bd2;
}
.syntax--source.syntax--python .syntax--function.syntax--magic {
  color: #268bd2;
}
.syntax--source.syntax--python .syntax--punctuation.syntax--string {
  color: #2aa198;
}
.syntax--source.syntax--python .syntax--keyword.syntax--operator {
  color: #657b83;
}
.syntax--source.syntax--python .syntax--keyword.syntax--operator.syntax--quantifier {
  color: #2aa198;
}
.syntax--source.syntax--python .syntax--keyword.syntax--operator.syntax--logical {
  color: #859900;
}
.syntax--source.syntax--python .syntax--keyword.syntax--control.syntax--import {
  color: #cb4b16;
}
.syntax--source.syntax--python .syntax--keyword.syntax--other {
  color: #859900;
}
.syntax--source.syntax--python .syntax--constant.syntax--language {
  color: #268bd2;
}
.syntax--source.syntax--python .syntax--constant.syntax--character {
  color: #2aa198;
}
.syntax--source.syntax--python .syntax--constant.syntax--other {
  color: #dc322f;
}
.syntax--source.syntax--python .syntax--entity.syntax--name.syntax--type.syntax--class {
  color: #268bd2;
}
.syntax--source.syntax--python .syntax--variable {
  color: #657b83;
}
.syntax--source.syntax--python .syntax--support.syntax--function.syntax--builtin {
  color: #268bd2;
}
.syntax--source.syntax--python .syntax--support.syntax--type.syntax--exception.syntax--python {
  color: #b58900;
}
.syntax--source.syntax--python .syntax--support.syntax--type.syntax--python {
  color: #268bd2;
}
.syntax--source.syntax--python .syntax--storage.syntax--type.syntax--string {
  color: #2aa198;
}
.syntax--source.syntax--python .syntax--storage.syntax--type.syntax--class {
  color: #859900;
}
.syntax--source.syntax--python .syntax--storage.syntax--type.syntax--class.syntax--todo {
  color: #d33682;
}
.syntax--source.syntax--python .syntax--storage.syntax--type.syntax--function {
  color: #859900;
}
.syntax--source.syntax--python .syntax--punctuation.syntax--definition.syntax--parameters {
  color: #657b83;
}
.syntax--source.syntax--python .syntax--punctuation.syntax--section.syntax--function.syntax--begin {
  color: #657b83;
}
.syntax--source.syntax--python .syntax--punctuation.syntax--separator.syntax--parameters {
  color: #657b83;
}
.syntax--source.syntax--ruby .syntax--meta.syntax--embedded .syntax--punctuation.syntax--section {
  color: #dc322f;
}
.syntax--source.syntax--ruby .syntax--punctuation.syntax--definition {
  color: #657b83;
}
.syntax--source.syntax--ruby .syntax--punctuation.syntax--definition.syntax--string {
  color: #dc322f;
}
.syntax--source.syntax--ruby .syntax--punctuation.syntax--definition.syntax--comment {
  color: #93a1a1;
}
.syntax--source.syntax--ruby .syntax--entity.syntax--inherited-class {
  color: #b58900;
}
.syntax--source.syntax--ruby .syntax--variable.syntax--parameter {
  color: #657b83;
}
.syntax--source.syntax--ruby .syntax--variable.syntax--constant {
  color: #b58900;
}
.syntax--source.syntax--ruby .syntax--constant.syntax--boolean {
  color: #2aa198;
}
.syntax--source.syntax--ruby .syntax--instance .syntax--punctuation.syntax--definition {
  color: #268bd2;
}
.syntax--source.syntax--ruby .syntax--class {
  color: #b58900;
}
.syntax--source.syntax--ruby .syntax--class.syntax--control {
  color: #657b83;
}
.syntax--source.syntax--ruby .syntax--module {
  color: #b58900;
}
.syntax--source.syntax--ruby .syntax--require .syntax--keyword.syntax--other.syntax--special-method {
  color: #cb4b16;
}
.syntax--source.syntax--ruby .syntax--keyword.syntax--other.syntax--special-method {
  color: #cb4b16;
}
.syntax--source.syntax--ruby .syntax--keyword.syntax--other {
  color: #859900;
}
.syntax--source.syntax--ruby .syntax--keyword.syntax--control {
  color: #859900;
}
.syntax--source.syntax--ruby .syntax--keyword.syntax--operator {
  color: #657b83;
}
.syntax--source.syntax--ruby .syntax--special-method {
  color: #268bd2;
}
.syntax--source.syntax--ruby .syntax--symbol {
  color: #2aa198;
}
.syntax--source.syntax--ruby .syntax--symbol .syntax--punctuation.syntax--definition {
  color: #2aa198;
}
.syntax--source.syntax--ruby .syntax--hashkey {
  color: #dc322f;
}
.syntax--source.syntax--ruby .syntax--hashkey .syntax--punctuation.syntax--definition {
  color: #dc322f;
}
.syntax--source.syntax--ruby .syntax--string.syntax--regexp {
  color: #dc322f;
}
.syntax--source.syntax--ruby .syntax--todo {
  color: #d33682;
}
.syntax--source.syntax--ruby .syntax--variable.syntax--ruby.syntax--global {
  color: #268bd2;
}
.syntax--source.syntax--ruby .syntax--variable.syntax--ruby.syntax--global .syntax--punctuation {
  color: #268bd2;
}
.syntax--source.syntax--ruby .syntax--variable.syntax--block {
  color: #268bd2;
}
.syntax--source.syntax--ruby .syntax--variable.syntax--self {
  color: #2aa198;
}
.syntax--source.syntax--ruby .syntax--punctuation.syntax--separator {
  color: #657b83;
}
.syntax--source.syntax--ruby .syntax--numeric {
  color: #2aa198;
}
.syntax--source.syntax--ruby .syntax--punctuation.syntax--section.syntax--regexp {
  color: #dc322f;
}
.syntax--source.syntax--ruby .syntax--string.syntax--interpolated {
  color: #2aa198;
}
.syntax--source.syntax--ruby .syntax--string.syntax--interpolated .syntax--embedded.syntax--line.syntax--ruby .syntax--punctuation .syntax--source.syntax--ruby {
  color: #dc322f;
}
.syntax--source.syntax--ruby .syntax--string.syntax--interpolated .syntax--embedded.syntax--line.syntax--ruby .syntax--source.syntax--ruby {
  color: #657b83;
}
.syntax--source.syntax--ruby .syntax--string.syntax--interpolated .syntax--embedded.syntax--line.syntax--ruby .syntax--source.syntax--ruby .syntax--punctuation.syntax--array,
.syntax--source.syntax--ruby .syntax--string.syntax--interpolated .syntax--embedded.syntax--line.syntax--ruby .syntax--source.syntax--ruby .syntax--punctuation.syntax--function {
  color: #657b83;
}
.syntax--source.syntax--ruby .syntax--support.syntax--function {
  color: #657b83;
}
.syntax--source.syntax--ruby .syntax--support.syntax--function.syntax--kernel {
  color: #859900;
}
.syntax--source.syntax--scala .syntax--variable {
  color: #586e75;
}
.syntax--source.syntax--scala .syntax--declaration {
  color: #586e75;
  font-weight: bold;
}
.syntax--source.syntax--scala .syntax--comparison {
  color: #586e75;
}
.syntax--source.syntax--scala .syntax--class,
.syntax--source.syntax--scala .syntax--type {
  color: #b58900;
}
.syntax--source.syntax--scala .syntax--val {
  font-weight: normal;
}
.syntax--source.syntax--scala .syntax--variable {
  font-weight: bold;
}
.syntax--source.syntax--scala .syntax--variable.syntax--parameter {
  color: #6c71c4;
  font-weight: normal;
}
.syntax--source.syntax--scala .syntax--control.syntax--flow {
  color: #586e75;
  font-weight: bold;
}
.syntax--source.syntax--scala .syntax--constant.syntax--language {
  color: #586e75;
  font-weight: bold;
}
.syntax--source.syntax--scala .syntax--function.syntax--declaration {
  color: #6c71c4;
}
.syntax--source.syntax--scala .syntax--modifier.syntax--other {
  font-weight: bold;
}
.syntax--source.syntax--scala .syntax--package {
  color: #586e75;
}
.syntax--source.syntax--scala .syntax--variable.syntax--import {
  font-weight: normal;
}
.syntax--source.syntax--scala .syntax--type .syntax--bounds,
.syntax--source.syntax--scala .syntax--type .syntax--class {
  color: #6c71c4;
}
.syntax--source.syntax--scala .syntax--documentation :not(.syntax--embedded).syntax--link.syntax--entity {
  color: #268bd2;
  text-decoration: underline;
}
.syntax--source.syntax--scala .syntax--documentation :not(.syntax--embedded) .syntax--class,
.syntax--source.syntax--scala .syntax--documentation :not(.syntax--embedded) .syntax--parameter {
  color: #586e75;
}
.syntax--source.syntax--scala .syntax--documentation :not(.syntax--embedded) .syntax--description {
  color: #93a1a1;
}
.syntax--source.syntax--scala .syntax--embedded {
  color: #374549;
  font-style: italic;
}
.syntax--source.syntax--scala .syntax--embedded .syntax--margin,
.syntax--source.syntax--scala .syntax--embedded .syntax--delimiters {
  font-style: normal;
}
</style>

  </head>
  <body class="markdown-preview-plus-view">
    <h1>Unidad 4: Modelos lineales avanzados</h1>
<p>En esta unidad se estudiarán modelos lineales avanzados, su uso, ajuste e implementación así como también su evaluación en el entorno <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">R</code>. Particularmente, nos enfocaremos en los <em>Modelos Lineales Mixtos</em> (MLM).</p>
<h2>1. Modelos lineales mixtos.</h2>
<p>Hasta ahora hemos estudiado modelos útiles para analizar experimentos basados en <em>diseños completamente aleatorizados</em> (DCA).
Es decir, experimentos donde se selecciona aleatoriamente las <em>unidades observacionales</em>, a las cuales se les asigna,
en forma aleatoria, un tratamiento específico.</p>
<p>Un <em>Modelo Lineal Mixto</em> (MLM) es un modelo lineal paramétrico que permiten cuantificar las relaciones
entre una variable dependiente del tipo continua y varias variables predictoras. Los datos a analizar mediante un MLM poseen ciertas características que determinan que los residuos
posean distribución normal pero no presenten varianza constante o estén correlacionados entre sí. Este tipo de datos aparecen en muchas situaciones, sobre todo en experimentos donde se realiza algún tipo de muestreo cuyo diseño experimental no es el DCA. Por ejemplo, el caso de <em>Datos agrupados</em> como los
generados en experimentos con <em>Diseño en Bloque</em>, estudios
longitudinales o de medidas repetidas, etc. Este tipo de diseños se pueden encontrar en diferentes áreas como Medicina, Biología, Ciencias Sociales, Agronomía, etc.</p>
<h3>1.1 Tipo y estructura de los datos</h3>
<p>La estructura de los datos que debemos analizar es el factor determinante para saber cuándo y qué MLM debemos utilizar. Los datos a analizar con MLMs presentan una estructura jerárquica determinada por la estrategia de muestreo y/o por el diseño experimental.</p>
<p>1.1.1 Datos agrupados</p>
<p>En este tipo de datos la variable respuesta se mide una sóla vez en cada individuo (unidad de análsis),
y los individuos están a su vez agrupados (o anidados) en unidades mayores (grupos de unidades) aleatoriamente seleccionadas.
Muchos tipos de datos que seguramente usted conoce tienen una estructura jerárquica:</p>
<ul>
<li>Alumnos en escuelas</li>
<li>Personas en municipios</li>
<li>Pacientes en hospitales</li>
<li>Plantas en una parcela</li>
</ul>
<p>Las jerarquías son una forma de representar la relación de dependencia que hay entre las
unidades de análisis y los grupos a los que pertenecen.
Por ejemplo, supongamos que hacemos un estudio para determinar el efecto del tratamiento con una droga sobre pacientes internados en diferentes hospitales, tendríamos una estructura
a dos niveles: muchos individuos en el <strong>nivel 1</strong> (pacientes) que están agrupados en pocas unidades de <strong>nivel 2</strong> (hospitales).</p>
<p>Las estructuras multinivel pueden aparecer también como consecuencia del diseño experimental.
Por ejemplo, un estudio sobre el rendimiento de distintas variedades agronómicas puede dar lugar a un diseño a tres niveles: primero muestreamos provincias,
luego parcelas y después individuos.
En cada nivel de la jerarquía es posible medir variables y/o aplicar tratamientos. Algunas estarán medidas en su
nivel <em>natural</em>, por ejemplo en el nivel parcelas podriamos registrar los milímetros de lluvia mensual, y al nivel
de las plantas podríamos medir su tamaño de hoja. Otras podrán estar agregadas/disagregadas en distintos niveles. Mientras, en simultáneo, los MLMs
permiten obtener estimaciones de la variabilidad total o asociada a los distintos grupos o jerarquías.</p>
<p>1.1.2 Medidas repetidas</p>
<p>En este tipo de datos la variable dependiente se mide más de una vez en una misma unidad de análisis. Por ejemplo,
un experimento donde se desea contrastar la expresión de genes en tejido tumoral contra tejido tumoral. Para ello, se seleccionan aleatoriamente un conjunto de pacientes con tumor, y se extrae, a cada uno de ellos, dos muestras, una de tejido normal y otra de tejido tumoral.
Este tipo de datos también puede ser considerado como datos multinivel (o jerárquicos) donde el  <strong>nivel 2</strong> son los individuos y el <strong>nivel 1</strong> representa
a las diferentes medidas tomadas. Dado que los registros se hacen sobre un mismo individuo,
es de esperar que dichas medidas no sean independientes, por lo que utilizar un modelo lineal
ordinario no sería apropiado.</p>
<p>Un caso particular de los experimentos con medidas repetidas son los estudios longitudinales. Es decir, aquellos en los que la variable dependiente se ha
medido en distintos instantes de tiempo en cada una de las unidades de análisis. Por ejemplo, consideremos un experimento donde se desea establecer el efecto de diferentes dietas, para lo cual se ha seleccionado aleatoriamente un número de individuos, los cuales son aleatoriamente asignados a diferentes regimenes alimenticios. Durante un año, se registra una vez al mes el peso de los individuos con el objetivo de determinar si hubo un desenso de peso motivado por la dieta.</p>
<p>En algunos casos, cuando la variable dependiente se mide a lo largo del tiempo, puede ser difícil identificar
si los datos son medidas repetidas o datos longitudinales. Desde el punto de vista del análisis de los datos mediante MLMs esta distinción no es un elemento crítico. Lo importante es que
en ambos tipos de datos la variable dependiente se ha medido repetidas veces en la misma unidad observacional, y que por tanto las observaciones estarán correlacionadas.</p>
<h3>1.2 Tipos de factores y efectos en los MLMs</h3>
<p>El nombre de <em>Modelo Lineal Mixto</em>  surge del hecho de que los MLMs son modelos lineales
en los parámetros, donde las covariables o variables independientes pueden representar una mezcla de
efectos fijos y efectos aleatorios. Distinguir entre factores fijos y aleatorios y sus respectivos efectos sobre
la variable dependiente es crítico para la formulación correcta del MLM.</p>
<h4>1.2.1 Factores Fijos</h4>
<p>El concepto de <em>factor fijo</em> proviene del ANOVA. Un <em>factor fijo</em> es una variable de clasificación o categórica
que abarca distintos niveles o condiciones experimentales que son de interés en el estudio. Los <em>factores fijos</em> pueden incluir covariables cualitativas como el sexo o el género,
variables de clasificación vinculadas al proceso de muestreo, como la región o provincia, o factores del diseño experimental,
como el tratamiento con una determinda droga. Los niveles de un <em>factor fijo</em> se eligen ya que representan condiciones o contrastes (combinaciones) específicas que son de interés del estudio.</p>
<h4>1.2.2 Factores Aleatorios</h4>
<p>Un <em>factor aleatorio</em> es una variable de clasificación cuyos niveles pueden pensarse como aleatoriamente muestreados
de una población de niveles a estudiar. No todos los niveles posibles de un factor aleatorio estarán representados en el estudio, pero se tiene la intención de hacer inferencia sobre todos ellos.
Las variables de clasificación asociadas a los niveles 2, 3, etc, en los datos agrupados/medidas repetidas
se suelen considerar factores aleatorios. Considerar los factores aleatorios en el análisis permite evaluar
la variabilidad de la respuesta a través de los niveles de los factores aleatorios, permitiendo que los resultados
sean generalizables a una mayor población de niveles del factor aleatorio.</p>
<p>Los niveles de los factores aleatorios no representan condiciones específicamente diseñadas
o elegidas para cumplir con los objetivos del estudio. Sin embargo, dependiendo del experimento,
un mismo factor puede ser considerado tanto fijo como aleatorio. Por ejemplo, consideremos un experimento
que registra la frecuencia cardíaca en sujetos que tienen diversas afecciones cardíacas, con el
objetivo de determinar si cierto ejericio físico produce un cambio dicha variable. Suponga además que, para cada sujeto,
se registró la afección cardíaca que posee.
Un enfoque de análisis permite asumir que la afección cardíaca que presenta cada uno de los sujetos es una muestra aleatoria
de todas las afecciones cardíacas posibles. En este caso, el análisis permitirá generalizar los resultados,
a una población hipotética de pacientes con diferentes fallas cardíacas. Ahora bien, si
el objetivo es determinar las diferencias de frecuencia cardíaca entre los pacientes que poseen distintas fallas cardíacas,
entonces la <em>falla cardíaca</em> debe ser considerada como un factor fijo, con distintos niveles. Cabe destacar
que, en este caso, las conclusiones aboradas serán válidas sólo para aquellas fallas cardíacas consideradas durante todo el estudio.</p>
<h4>1.2.3 Efectos Fijos y Efectos Aleatorios</h4>
<p>Un <em>efecto fijo</em> es un coeficiente de regresión o parámetro constante desconocido asociado
al efecto de las covariables o factores categóricos de un modelo lineal. Los efectos fijos pueden describir
contrastes o diferencias entre los niveles de un factor fijo, en términos de la respuesta media de la variable respuesta, o
pueden describir la relación entre una covariable continua y la respuesta. Como son desconocidos, los efectos
fijos se estiman en un MLM en base a las observaciones recolectadas.</p>
<p>Un <em>efecto aleatorio</em> es un valor aleatorio asociado a los niveles de un factor aleatorio en un MLM. Los efectos aleatorios
representan desviaciones aleatorias de la relación entre la respuesta y los efectos fijos. Contrario a lo que sucede
con los efectos fijos, los efectos aleatorios se representan en un MLM como variables aleatorias normalmente distribuidas.</p>
<h4>1.2.4 Factores Cruzados, Anidados y sus efectos.</h4>
<p>Cuando un nivel de un factor (fijo o aleatorio) puede medirse sólo dentro de un único nivel
de otro factor, los niveles de estos dos factores se dicen que están <em>anidados</em>. Pensemos por ejemplo en órganos
dentro de pacientes, donde se mide cierta variable. En este caso, los niveles del factor <em>tejido</em> están anidados
dentro de los niveles del factor <em>paciente</em>. Los efectos de este factor anidado sobre la respuesta también
están anidados dentro de los niveles del segundo factor.</p>
<p>Ahora bien, cuando un nivel dado de un factor (fijo o aleatorio) puede medirse en múltiples niveles de otro factor, se dice
que ambos factores estan <em>cruzados</em>, y los efectos de estos factores sobre la respuesta se llaman <em>efectos cruzados</em>.
Por ejemplo, pensemos en sujetos, de ambos sexos, aleatoriamente asignados a dos tratamientos, y a los que posteriormente se les registra cierta variable.
Los factores <em>sexo</em> y <em>tratamiento</em> estan cruzados, ya que cada tratamiento se ha asignado a pacientes de ambos sexos.</p>
<h3>1.3 Por qué usar MLMs?</h3>
<p>Tomemos este ejemplo de Pinheiro and Bates (2000). Un ingeniero desea evaluar la tensión longitudinal en
una prueba de ingeniería destinada a determinar el esfuerzo longitudinal en rieles. Para ello,
se ha registrado el tiempo que tardan ciertas ondas ultrasónicas en viajar a lo largo de los rieles.
Para el experimento se seleccionó aleatoriamente seis rieles, los cuales fueron evaluados en tres oportunidades, siendo el riel lo único que cambia entre distintas observaciones.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; library(nlme)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; data(Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; class(Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>[1] "nffGroupedData" "nfGroupedData"  "groupedData"    "data.frame"</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; head(Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Grouped Data: travel ~ 1 | Rail</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Rail travel</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1    1     55</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>2    1     53</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>3    1     54</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>4    2     26</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>5    2     37</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>6    2     32</span></span></span>
</pre>
<p>La estructura de la base de datos es simple, ya que cada fila se corresponde con una observación.
Los ingenieros desean estimar el tiempo promedio de viaje de la onda a lo largo de un riel, la variabilidad entre los tiempos promedios de viaje entre los rieles (variabilidad entre rieles)
y la variabilidad en los tiempos de viaje observados para un único riel (variabilidad intra-riel).</p>
<p>Los datos de este experimento pueden analizarse mediante modelos lineales o mediante MLMs, dependiendo si el factor <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">riel</code> se considera fijo o aleatorio.
En este experimento, hay una estructura de agrupamiento de los datos ya que se han registrado varias observaciones en un mismo riel. Esto implica que
las observaciones de un mismo riel sean más similares entre ellas, que el tiempo promedio de viaje varíe entre rieles y también entre medidas.</p>
<p>Veamos esto gráficamente:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; library(ggplot2)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; ggplot(Rail, aes(x=Rail, y=travel, color=Rail))+geom_point(size=2)</span></span></span>
</pre>
<p><img src="../Imagenes/railPlot.png" alt="Figura1"></p>
<p><em><strong>Figura 1</strong></em>: Tiempo de propagación de una onda ultrasónica (nanosegundos) para seis rieles.</p>
<p>El análisis de la <a href="Figura1">Figura 1</a> deja en evidencia la necesidad de considerar
la estructura de agrupamiento de los datos, según el riel en el cual se han registrado. Para demostrar esta necesidad, consideremos
primero un modelo lineal simple que ignore este agrupamiento. Si  <span class="math"><script type="math/tex">y_{ij}</script></span> representa el tiempo de propagación
para el i-ésimo riel registrado en la j-ésima oportunidad, entonces el modelo lineal correspondiente será:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
y_{ij}=\mu_0+\epsilon_{ij},~i=1,...,M,~j=1,..., n_i,~\boldsymbol{\epsilon}\sim N(0, \sigma^2\boldsymbol{I})  \label{Ec1}
\tag{1}
\end{equation}
</script></span>
<p>En nuestro caso, <span class="math"><script type="math/tex">M=6</script></span>, y <span class="math"><script type="math/tex">n_1=n_2=...=n_6=3</script></span>, por lo que el total de observaciones, <span class="math"><script type="math/tex">N</script></span>, es <span class="math"><script type="math/tex">18</script></span>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; table(Rail$Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>2 5 1 6 3 4</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 3 3 3 3 3 3</span></span></span>
</pre>
<p>Ajustemos ahora el modelo lineal, donde según la teoría de la estadística muestral, los estimadores serán <span class="math"><script type="math/tex">\hat{\mu}=\overline{\boldsymbol{y}}</script></span> y <span class="math"><script type="math/tex">\hat{\sigma}^2=s^2</script></span>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; LMIntercept&lt;-lm(travel~1, data=Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(LMIntercept)</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Call:</span></span></span>
<span class="syntax--text syntax--plain"><span>     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>lm(formula = travel ~ 1, data = Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min     1Q Median     3Q    Max</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>-40.50 -16.25   0.00  18.50  33.50</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Coefficients:</span></span></span>
<span class="syntax--text syntax--plain"><span>     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Estimate Std. Error t value Pr(&gt;|t|)</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)   66.500      5.573   11.93  1.1e-09 ***</span></span></span>
<span class="syntax--text syntax--plain"><span>     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>---</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>     Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Residual standard error: 23.65 on 17 degrees of freedom</span></span></span>
</pre>
<p><strong>Ejercicio:</strong> Verifique los resultados de ajuste del modelo.</p>
<p>El intercepto es significativo, ya que, claramente, la media no es 0. Veamos lo que
sucede con los gráficos diagnósticos del modelo.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; df&lt;-data.frame(residuals=rstandard(LMIntercept), rail=Rail$Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; g1&lt;-ggplot(df, aes(sample=rstandard(LMIntercept)))+stat_qq(distribution = qnorm)+ stat_qq_line()</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; g2&lt;-ggplot(df, aes(x=rail, y=residuals, color=rail))+geom_point()</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; library(cowplot)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; plot_grid(g1, g2, nrow=1, labels=c("A)", "B)"))</span></span></span>
</pre>
<p><img src="../Imagenes/diagnosticRail.png" alt="Figura2"></p>
<p><em><strong>Figura 2</strong></em>: *Gráficos de los residuos estandarizados del modelo. <strong>A)</strong> QQ-plot. <strong>B)</strong> Residuos según riel.</p>
<p>De la <a href="Figura2">Figura 2</a> resulta evidente la estructura de agrupamiento de los datos, reflejada en el agrupamiento de los residuos.
Por lo tanto, es necesario incorporar el efecto de riel en el modelo. Ahora bien, lo que interesa saber, no es el efecto particular de esos seis rieles,
sino qué sucede con el tiempo de propagación para cualquier riel.
Es por ello que el efecto <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">riel</code> debe incorporarse al modelo permitiendo que el valor medio de cada riel pueda ser
representado por un parámetro diferente, es decir, considerandolo como un efecto fijo, lo que deriva en un modelo ANOVA de una vía, el cual puede escribirse como:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}

\mu_{ij}=\alpha_i+\epsilon_{ij},~i=1,...,M,~j=1,..., n_i,~\boldsymbol{\epsilon}\sim N(0, \sigma^2\boldsymbol{I}) \label{EC2}
\tag{2}
\end{equation}
</script></span>
<p>En la <a href="EC2">Ecuación 2</a>, cada <span class="math"><script type="math/tex">\alpha_i</script></span> representa el tiempo promedio de propagación para el i-ésimo riel. Ajustemos este modelo</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; LMEffect&lt;-lm(travel~Rail-1, data=Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(LMEffect)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Call:</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>lm(formula = travel ~ Rail - 1, data = Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min      1Q  Median      3Q     Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-6.6667 -1.0000  0.1667  1.0000  6.3333</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Coefficients:</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Estimate Std. Error t value Pr(&gt;|t|)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    Rail2   31.667      2.321   13.64 1.15e-08 ***</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    Rail5   50.000      2.321   21.54 5.86e-11 ***</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    Rail1   54.000      2.321   23.26 2.37e-11 ***</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    Rail6   82.667      2.321   35.61 1.54e-13 ***</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    Rail3   84.667      2.321   36.47 1.16e-13 ***</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    Rail4   96.000      2.321   41.35 2.59e-14 ***</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    ---</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>    Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Residual standard error: 4.021 on 12 degrees of freedom</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Multiple R-squared:  0.9978,	Adjusted R-squared:  0.9967</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>F-statistic: 916.6 on 6 and 12 DF,  p-value: 2.971e-15</span></span></span>
</pre>
<p>Como es de esperar, la varianza residual, <span class="math"><script type="math/tex">\hat{\sigma}^2</script></span>, resultó menor que la del modelo anterior,
ya que hemos agregado la estructura de grupos en los datos.</p>
<p><strong>Ejercicio</strong>: Explore los gráficos de los residuos de este nuevo modelo.</p>
<p>El problema que presenta este modelo es que no cumple con los objetivos del estudio ya que
los resultados no son generalizables a cualquier riel,
sino que son específicos para los seis rieles analizados. Para poder superar este inconveniente es que
surgen los MLMs. Particularmente, en este caso, necesitamos modelar la variabilidad debida a los distintos rieles mediante la inclusión del riel como <em>efecto aleatorio</em>  de manera de poder explicar las fluctuaciones de los
tiempos de propagación en torno a una media poblacional. La ecuación correspondiente a este modelo será:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}

y_{ij}=\mu+u_i+\epsilon_{ij},~u_i\sim N(0, \sigma_u^2),~\epsilon_{ij}\sim N (0, \sigma^2),~cov(u_i, \epsilon_{ij})=0 \label{EC3}
\tag{3}
\end{equation}
</script></span>
<p>El modelo descrito por la <a href="EC3">Ecuación 3</a>, conocido como <em>modelo de intercepto aleatorio</em>, reemplaza el parámetro fijo <span class="math"><script type="math/tex">\mu_i−\mu=u_i</script></span>, con un
efecto aleatorio, <span class="math"><script type="math/tex">u_i</script></span>, que es una variable aleatoria específica para el i-ésimo riel, con media 0 y varianza <span class="math"><script type="math/tex">\sigma_u^2</script></span>. Note que en este modelo, las observaciones registradas en el mismo riel están representadas mediante el mismo efecto aleatorio, <span class="math"><script type="math/tex">u_i</script></span>, por lo que están
correlacionadas, contrario a lo que sucede en el modelo de efectos fijos. La covarianza entre las observaciones del mismo riel es <span class="math"><script type="math/tex">\sigma^2_u</script></span>. En este modelo, los parámetros a estimar son <span class="math"><script type="math/tex">\mu</script></span>, <span class="math"><script type="math/tex">\sigma_u^2</script></span>, y <span class="math"><script type="math/tex">\sigma^2</script></span>. Cabe destacar que siempre serán tres, independientemente
del número de rieles evaluados, mientras que en el modelo lineal de efectos fijos, tiene 8 parámetros a estimar.</p>
<h3>1.4 Formulación del Modelo Lineal Mixto</h3>
<p>El nombre los MLMs surge del hecho de que estos modelos son lineales en los parámetros, y en las covariables,
y pueden implicar efectos fijos o aleatorios, por lo que se los considera una extensión de los modelos lineales ya estudiados.</p>
<p>En general el MLM se representa mediante la <a href="EC4">Ecuación 4</a>, donde <span class="math"><script type="math/tex">\boldsymbol{y}</script></span> es el vector de observaciones de la variable respuesta, <span class="math"><script type="math/tex">\boldsymbol{X}</script></span> es una matriz de <span class="math"><script type="math/tex">n</script></span>x<span class="math"><script type="math/tex">k</script></span>,
donde <span class="math"><script type="math/tex">k</script></span> es el número de efectos fijos del modelo, llamada matriz de incidencia de los efectos fijos,
<span class="math"><script type="math/tex">\boldsymbol{\beta}</script></span> es el vector de efectos fijos a estimar, <span class="math"><script type="math/tex">\boldsymbol{Z}</script></span>, matriz de <span class="math"><script type="math/tex">n</script></span>x<span class="math"><script type="math/tex">p</script></span>, es la
matriz de incidencia de los efectos aleatorios, <span class="math"><script type="math/tex">\boldsymbol{u}</script></span>
es el vector de efectos aleatorios y <span class="math"><script type="math/tex">\boldsymbol{\epsilon}</script></span> es el vector de error.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}

\boldsymbol{y} = \boldsymbol{X}\boldsymbol{\beta} + \boldsymbol{Z}\boldsymbol{u} +\boldsymbol{\epsilon} \label{EC4}
\tag{4}
\end{equation}
</script></span>
<p>Tanto <span class="math"><script type="math/tex">\boldsymbol{u}</script></span> como <span class="math"><script type="math/tex">\boldsymbol{\epsilon}</script></span> son vectores aleatorios no observados, con <span class="math"><script type="math/tex">\boldsymbol{u} \sim N(\boldsymbol{0}, \boldsymbol{G})</script></span> y <span class="math"><script type="math/tex">\boldsymbol{\epsilon} \sim N(\boldsymbol{0}, \boldsymbol{R})</script></span>. Además se asume
que <span class="math"><script type="math/tex">cov(\boldsymbol{u}, \boldsymbol{\epsilon})=0</script></span>. Un punto no menor es que los efectos aleatorios y los residuos pueden estar correlacionados, por lo que las matrices de varianza y covarianza <span class="math"><script type="math/tex">\boldsymbol{G}</script></span> y <span class="math"><script type="math/tex">\boldsymbol{R}</script></span> no serán matrices diagonales.
De esta manera,</p>
<span class="math"><script type="math/tex; mode=display">
\begin{equation}

Var(\boldsymbol{y})= \boldsymbol{V}=\boldsymbol{Z}\boldsymbol{G}\boldsymbol{Z}'+ \boldsymbol{R}
\label{EC5}
\tag{5}
\end{equation}

</script></span>
<p>pudiendo ser <span class="math"><script type="math/tex">\boldsymbol{V}</script></span> una matriz no diagonal.</p>
<h4>1.4.1 Estimación de los efectos fijos</h4>
<p>Para estimar los efectos fijos, conviene considerar al MLM mediante la <a href="EC6">Ecuación 6</a>, donde <span class="math"><script type="math/tex">\boldsymbol{\epsilon^*}=\boldsymbol{Z}\boldsymbol{u} +\boldsymbol{\epsilon}</script></span>. Este modelo presenta errores que, a diferencia de un modelo lineal,
pueden estar correlacionados entre sí.</p>
<span class="math"><script type="math/tex; mode=display">
\begin{equation}

\boldsymbol{y} = \boldsymbol{X}\boldsymbol{\beta} +\boldsymbol{\epsilon^*}
\label{EC6}
\tag{6}
\end{equation}

</script></span>
<p>Dada la matriz <span class="math"><script type="math/tex">\boldsymbol{V}</script></span>, el estimador de <span class="math"><script type="math/tex">\boldsymbol{\beta}</script></span> se obtiene por
el método de <em>Mínimos Cuadrados Generalizados</em> (<em>Generalized Least Square, GLS</em>) según la <a href="EC7">Ecuación 7</a>.</p>
<span class="math"><script type="math/tex; mode=display">
\begin{equation}

\hat{\boldsymbol{\beta}}=(\boldsymbol{X}'\boldsymbol{V}^{-1}\boldsymbol{X})^{-1}\boldsymbol{X}'\boldsymbol{V}^{-1}\boldsymbol{y}
\label{EC7}
\tag{7}
\end{equation}

</script></span>
<p>El estimador <em>GLS</em> de <span class="math"><script type="math/tex">\beta</script></span> también se corresponde con el EMV de dicho parámetro, y para el cual además se cumple que <span class="math"><script type="math/tex">\hat{\boldsymbol{\beta}} \sim N(\boldsymbol{\beta},(\boldsymbol{X}'\boldsymbol{V}^{-1}\boldsymbol{X})^{-1})</script></span>.</p>
<h4>1.4.2 Predicción de los efectos aleatorios</h4>
<p>En el caso de los efectos aleatorios hablamos de <em>predicción</em> porque los tales efectos son variables aleatorias.
Existen diversas alternativas para encontrar predictores de <span class="math"><script type="math/tex">\boldsymbol{u}</script></span> que tengan la propiedad de
ser el mejor (menor error cuadrático medio de predicción) predictor lineal insesgado (<em>Best Linear Unbiased Predictor</em>, <em>BLUP</em>).
Una forma de hacerlo es considerando la esperanza condicional de <span class="math"><script type="math/tex">\boldsymbol{u}</script></span> dado un conjunto de observaciones de la respuesta:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}

\hat{\boldsymbol{u}}=E(\boldsymbol{u}|_{\boldsymbol{Y}=\boldsymbol{y}})=\boldsymbol{G}\boldsymbol{Z}'\boldsymbol{V}^{-1}(\boldsymbol{y}-\boldsymbol{X\hat{\boldsymbol{\beta}}})

\label{EC8}
\tag{8}

\end{equation}
</script></span>
<p>Los valores predichos en la <a href="EC8">Ecuación 8</a> son los valores esperados de los efectos aleatorios, <span class="math"><script type="math/tex">u_i</script></span>, asociados con el í-esimo nivel de un factor aleatorio, dado <span class="math"><script type="math/tex">\boldsymbol{y}_i</script></span>. Estas esperanzas condicionales se suelen conocer también como <em>EBLUPs</em> (o BLUPs empíricos), porque se basan en los estimadores de <span class="math"><script type="math/tex">\sigma^2</script></span> y <span class="math"><script type="math/tex">\boldsymbol{\beta}</script></span>.
Tanto el estimador de <span class="math"><script type="math/tex">\boldsymbol{\beta}</script></span> como los <em>EBLUPs</em> dependen de <span class="math"><script type="math/tex">\boldsymbol{V}</script></span>, quien a su vez depende de <span class="math"><script type="math/tex">\boldsymbol{G}</script></span> y <span class="math"><script type="math/tex">\boldsymbol{R}</script></span>, matrices desconocidas
que deberán ser estimadas a partir de los datos.</p>
<h4>1.4.3 Estimación de los componentes de varianza</h4>
<p>Analicemos la estructura de la matriz de varianzas y covarianzas de <span class="math"><script type="math/tex">\boldsymbol{y}</script></span>, <span class="math"><script type="math/tex">\boldsymbol{V}= \boldsymbol{Z}'\boldsymbol{G}\boldsymbol{Z}+\boldsymbol{R}</script></span>.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}

\boldsymbol{V}=\begin{bmatrix}  Z_{11} & ... & Z_{i1} &...& Z_{n1}\\ \vdots & & \vdots & & \vdots \\Z_{1i} & ... & Z_{ii} &...& Z_{ni}\\ \vdots & & \vdots & & \vdots \\Z_{1l} & ... & Z_{il} &...& Z_{nl}\end{bmatrix}\begin{bmatrix}  G_{11} & ... & G_{j1} &...& G_{p1}\\ \vdots & & \vdots & & \vdots \\G_{j1} & ... & G_{jj} &...& G_{pj}\\ \vdots & & \vdots & & \vdots \\G_{p1} & ... & G_{pj} &...& G_{pp}\end{bmatrix}\begin{bmatrix}  Z_{11} & ... & Z_{1i} &...& Z_{1l}\\ \vdots & & \vdots & & \vdots \\Z_{i1} & ... & Z_{ii} &...& Z_{il}\\ \vdots & & \vdots & & \vdots \\Z_{n1} & ... & Z_{ni} &...& Z_{nl}\end{bmatrix} + \begin{bmatrix}  R_{11} & ... & R_{i1} &...& R_{n1}\\ \vdots & & \vdots & & \vdots \\R_{i1} & ... & R_{ii} &...& R_{ni}\\ \vdots & & \vdots & & \vdots \\R_{n1} & ... & R_{ni} &...& R_{nn}\end{bmatrix}
\label{EC9}
\tag{9}
\end{equation}
</script></span>
<p>Los elementos que conforman la diagonal principal de <span class="math"><script type="math/tex">\boldsymbol{G}</script></span> representan las varianzas de los
efectos aleatorios contenidos en <span class="math"><script type="math/tex">\boldsymbol{u}</script></span>, mientras que los elementos fuera de esta diagonal representan las covarianzas entre dos efectos aleatorios. Además, dado que los efectos aleatorios
son variables aleatorios, la matriz <span class="math"><script type="math/tex">\boldsymbol{G}</script></span> resulta ser simétrica y definida positiva. Análogamente, la matriz <span class="math"><script type="math/tex">\boldsymbol{R}</script></span> también es una matriz simétrica y definida positiva, cuya diagonal
principal representa las varianzas de los residuos del modelo y los elementos fuera de ella, las respectivas covarianzas.</p>
<p>Las matrices <span class="math"><script type="math/tex">\boldsymbol{G}</script></span> y <span class="math"><script type="math/tex">\boldsymbol{R}</script></span> pueden presentar ciertas estructuras, como por ejemplo ser matrices diagonales, o no, matrices no estructuradas. Las matrices estructuradas permiten representar
la estructura de varianza mediante un conjunto de funciones o parámetros de menor tamaño que el total de los elementos de la matriz, disminuyendo la cantidad de parámetros a estimar. Usualmente, el conjunto de parámetros o funciones a estimar
asociados a las componentes de varianza se denota por <span class="math"><script type="math/tex">\boldsymbol{\theta}</script></span></p>
<p>Consideremos la matriz <span class="math"><script type="math/tex">\boldsymbol{G}</script></span>. Si no imponemos estructura, <span class="math"><script type="math/tex">\boldsymbol{G}</script></span> contiene <span class="math"><script type="math/tex">\frac{p(p+1)}{2}</script></span> varianzas/covarianzas a determinar. Mientras, si consideramos el caso en que se asumen los efectos aleatorios independientes
entre sí (caso <em>componentes de varianza</em>), <span class="math"><script type="math/tex">\boldsymbol{G}</script></span> resulta ser una matriz diagonal con sólo <span class="math"><script type="math/tex">p</script></span> elementos a estimar, las varianzas de los <span class="math"><script type="math/tex">p</script></span> efectos aleatorios contenidos en <span class="math"><script type="math/tex">\boldsymbol{u}</script></span>. Estos dos casos son los más utilizados en la práctica
para definir la estructura de <span class="math"><script type="math/tex">\boldsymbol{G}</script></span>, aunque no son los únicos.</p>
<p>En el caso de la matriz <span class="math"><script type="math/tex">\boldsymbol{R}</script></span>, las estructuras de covarianzas más comunes se detallan a continuación. Por un lado,
el caso más simple, residuos no correlacionados y de varianza constante (caso ML). Es decir, <span class="math"><script type="math/tex">\boldsymbol{R}=\sigma^2\boldsymbol{I}_{n}</script></span>, siendo <span class="math"><script type="math/tex">\sigma^2</script></span> el único parámetro a estimar.</p>
<p>Otra aletarnativa es la estructura de <em>simetría compuesta</em>, la cual asume que la varianza y la covarianza son constantes y están relacionadas:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}

\boldsymbol{R}=\begin{bmatrix}  \sigma^2+\sigma_1 & ... & \sigma_1 &...& \sigma_1\\ \vdots & & \vdots & & \vdots \\\sigma_1 & ... & \sigma^2+\sigma_1 &...&\sigma_1\\ \vdots & & \vdots & & \vdots \\\sigma_1 & ... & \sigma_1 &...& \sigma^2+\sigma_1\end{bmatrix}
\label{EC10}
\tag{10}

\end{equation}
</script></span>
<p>En esta estructura, se necesita estimar dos parámetros, <span class="math"><script type="math/tex">\sigma^2</script></span> y <span class="math"><script type="math/tex">\sigma_1</script></span>, para poder estimar <span class="math"><script type="math/tex">\boldsymbol{R}</script></span>.
En problemas donde es posible asumir iguales correlaciones, como por ejemplo en el caso de experimentos repetidos bajo las mismas condiciones, se suele usar la estructura de simetría compuesta.</p>
<p>No ahondaremos detalles en los métodos, pero es importante saber que la estimación de <span class="math"><script type="math/tex">\boldsymbol{R}</script></span> y <span class="math"><script type="math/tex">\boldsymbol{G}</script></span> generalmente se obtienen por ML o por ML restringida (<em>Restricted Maximum Likelihood</em>, <em>REML</em>) . Este último método suele ser preferido ya que proporciona estimadores insesgados de las matrices de varianza y covarianza.</p>
<h3>1.5 Ajuste de MLMs en R</h3>
<p>Existen varios paquetes <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">R</code> útiles para el ajuste de MLMs, de los cuales <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lme4</code> son dos de los más utilizados.</p>
<h4>1.5.1 Ajuste con <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code></h4>
<p>La función principal del paquete <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code> es <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lme()</code>. Las llamadas a esta función son similares a las que utilizamos anteriormente para la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lm()</code> sólo que ahora debemos agregar argumentos extras para especificar la estructura de la parte aleatoria del MLM. <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lme()</code> asume
que los datos están agrupados bajo cierta estructura de grupos definida mediante los niveles de alguna variable categórica (<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">factor</code>), por lo que dicha estructura es la que se deberá especificar para cada grupo mediante el uso de efectos aleatorios independientes para cada grupo.</p>
<p>La estructura clásica de un llamado a <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lme()</code> es:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; lme(respuesta ~ predictoras,random= ,correlation=, method=,data= )</span></span></span>
</pre>
<p>La forma más sencilla de especificar la estructura de los efectos aleatorios es utilizando objetos de la clase <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">formula</code>
Supongamos un conjunto de datos <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">df</code> con observaciones de una variable respuesta <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">y</code>, predictoras <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">x</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">z</code> y con agrupamiento de datos especificado por el <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">factor</code> <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">g</code>. La llamada correspondiente
al MLM con <em>intercepto aleatorio</em> será:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; lme(y ~ x+z,random = ~1|g, data= df) # default method = "REML"</span></span></span>
</pre>
<p>Si el efecto aleatorio sólo tiene influencia sobre alguno de las predictoras, por ejemplo <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">x</code>, entonces deberemos especificar <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">~x|g</code> como componente aleatoria del modelo:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; lme(y ~ x+z,random = ~x|g, data= df)</span></span></span>
</pre>
<p>Si el efecto aleatorio influencia tanto la predictora <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">x</code> como la media general, entonces deberemos especificar <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">~1+x|g</code> como componente aleatoria del modelo:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; lme(y ~ x+z,random = ~1+x|g, data= df)</span></span></span>
</pre>
<p>Si tenemos más de un efecto aleatorio, supongamos dos tipos de agrupamiento dados por <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">g1</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">g2</code>, entonces la llamada será:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; lme(y ~ x+z,random =list(~1|g1,~1|g2),data= df)</span></span></span>
</pre>
<p>En el caso que <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">g2</code> esté anidado en <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">g1</code>, podemos entonces especificarlo de la siguiente manera:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; lme(y ~ x+z,random =~1|g1/g2,data= df)</span></span></span>
</pre>
<p>Retomemos el ejemplo de la determinación del tiempo promedio de propagación de onda en rieles. Ajustemos el MLM anteriormente propuesto, donde la variable <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">riel</code> representa un efecto aleatorio.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; library(nlme)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; randomModel &lt;- lme(travel~1,random=~1|Rail,data=Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># or equivalently</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># randomModel &lt;- lme(travel~1,random=list(Rail=~1),data=Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(randomModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: Rail</span></span></span>
<span class="syntax--text syntax--plain"><span>      </span><span class="syntax--meta syntax--paragraph syntax--text"><span>AIC      BIC   logLik</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>128.177 130.6766 -61.0885</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | Rail</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept) Residual</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:    24.80547 4.020779</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects: travel ~ 1</span></span></span>
<span class="syntax--text syntax--plain"><span>            </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Value Std.Error DF  t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)  66.5  10.17104 12 6.538173       0</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min          Q1         Med          Q3         Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-1.61882658 -0.28217671  0.03569328  0.21955784  1.61437744</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 18</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups: 6</span></span></span>
</pre>
<p>Los tres parámetros estimados por este modelo son <span class="math"><script type="math/tex">\hat{E(y_{ij})}=66.5</script></span>, <span class="math"><script type="math/tex">\hat{\sigma}_u=24.81</script></span> y <span class="math"><script type="math/tex">\hat{\sigma}=4.02</script></span>. Las componentes de varianza tambien se pueden obtener con la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">VarCorr()</code>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; VarCorr(randomModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Rail = pdLogChol(1)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Variance  StdDev</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept) 615.31111 24.805465</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Residual     16.16667  4.020779</span></span></span>
</pre>
<p>Conocer las varianzas estimadas resulta útil además para determinar el <em>Coeficiente de Correlación Intraclase</em> (<em>Intraclass Correlation Coefficient, ICC</em>). Este coeficiente es una medida de
la homogeneidad o similaridad de la variable respuesta dentro de un grupo de observaciones. En el caso de modelos con intercepto aleatorio, este coeficiente se obtiene mediante la <a href="EC11">Ecuación 11</a>.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}

ICC=\frac{\hat{\sigma}^2_u}{\hat{\sigma}^2_u+\hat{\sigma}^2}
\label{EC11}
\tag{11}
\end{equation}
</script></span>
<p><strong>Ejercicio</strong>: Obtenga el ICC para el MLM previamente ajustado y concluya sobre el valor obtenido.</p>
<h4>1.5.2 Ajuste con <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme4</code></h4>
<p>La función principal del paquete <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code> es <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lmer()</code>. La ecuación del MLM para <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lmer()</code> se especifica mediante un objeto del tipo <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">formula</code> donde los efectos aleatorios se incluyen en paréntesis.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; lmer( y ~ x + (1|g), data=df)</span></span></span>
</pre>
<p>La principal diferencia con <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lme()</code> es la limitada flexibilidad para definir la estructura de la matriz <span class="math"><script type="math/tex">\boldsymbol{G}</script></span>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; library(lme4)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; rail.lmer &lt;- lmer(travel ~1+(1|Rail),data=Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(rail.lmer)</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed model fit by REML ['lmerMod']</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Formula: travel ~ 1 + (1 | Rail)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Data: Rail</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>REML criterion at convergence: 122.2</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Scaled residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min       1Q   Median       3Q      Max</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>-1.61883 -0.28218  0.03569  0.21956  1.61438</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span>     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Groups   Name        Variance Std.Dev.</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Rail     (Intercept) 615.31   24.805</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Residual              16.17    4.021</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Number of obs: 18, groups:  Rail, 6</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects:</span></span></span>
<span class="syntax--text syntax--plain"><span>     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Estimate Std. Error t value</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)    66.50      10.17   6.538</span></span></span>
</pre>
<h3>1.6 Evaluación y comparación de modelos</h3>
<p>Por lo general, el análisis de datos jerarquizados con MLMs requiere del ajuste de varios modelos. Una vez que se ha determinado que
los modelos propuestos son válidos en sus supestos, éstos deben ser comparados con cierto criterio para establecer
cuál de ellos es el mejor a la hora de predecir/explicar la variación en la respuesta. La elección del mejor modelo
implica considerar los objetivos del estudio, el diseño experimental y la estrategia de muestreo utilizada,
el conocimiento <em>a priori</em> del problema y de las variables involucradas en el experimento, etc. En término de los modelos estadísticos, el <em>mejor modelo</em> es aquel que logra predecir/explicar la variabilidad de la variable respuesta de la forma más simple. Es decir, estamos interesados en el modelo que tenga el mejor ajuste con el menor número posible de parámetros estimados. En este curso estudiaremos la selección
de modelos en base a <em>pruebas de hipótesis</em> y a <em>criterios de información</em>.</p>
<h4>1.6.1 Diagnóstico de los residuos</h4>
<p>La evaluación diagnóstica de los residuos se suele llevar a cabo mediante pruebas informales basadas en gráficas que intentan develar la existencia o ausencia de
patrones específicos en los residuos de un MLM. En el contexto de los MLMs existen distintos tipos de residuos útiles para evaluar los supuestos del modelo.</p>
<h5>1.6.1.1 Residuos crudos o condicionales</h5>
<p>Los residuos <em>crudos</em> o <em>condicionales</em> están dados por la diferencia entre los valores
observados y la predicción condicional de la variable respuesta generada con el modelo ajustado, es decir:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}

\hat{\boldsymbol{\epsilon}}=\boldsymbol{y}-\boldsymbol{X}\hat{\boldsymbol{\beta}}-\boldsymbol{Z}\hat{\boldsymbol{u}}
\label{EC12}
\tag{12}
\end{equation}
</script></span>
<p>Los residuos condicionales en su forma básica pueden no resultar adecuados para evaluar los supuestos
del modelo o detectar observaciones atípicas ya que suelen estar correlacionados y con varianzas diferentes para cada
subgrupo de observaciones.</p>
<h5>1.6.1.2 Residuos estandarizados y estudentizados.</h5>
<p>Una alternativa a los residuos crudos son los residuo <em>estandarizados</em>,  los cuales se obtienen al dividir los residuos crudos por el valor de su desviación estándar. Dado que la desviación estándar no se suele conocer, se divide a los residuos crudos
por el estimador de la desviación, obteniendo así los residuos <em>estudentizados</em>. Una alternativa a estos residuos son los obtenidos al escalar los residuos crudos
por la desviación estándar de la variable respuesta, llamados <em>residuos de Pearson</em>.</p>
<h5>1.6.1.1 Residuos crudos o condicionales</h5>
<p>Los residuos <em>marginales</em> están dados por la diferencia entre los valores
observados y la predicción marginal de la variable respuesta generada con el modelo ajustado, es decir:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}

\hat{\boldsymbol{\epsilon}}^{\ast}=\boldsymbol{y}-\boldsymbol{X}\hat{\boldsymbol{\beta}}
\label{EC12}
\tag{12}
\end{equation}
</script></span>
<p>Los residuos marginales son residuos <em>puros</em> ya que, a diferencia de los residuos condicionales, se basan en las estimaciones de las medias marginales.</p>
<h5>1.6.1.3 Gráficos diagnóstico</h5>
<p>Al igual que en los modelos lineales, dos gráficos que serán de gran utilidad para evaluar los supuestos de un MLM son el QQ-plot de los residuos y el diagrama de residuos vs. valores ajustados/predichos. Por lo general, se prefieren las verciones estudentizadas, o los residuos de Pearson en estos gráficos. Ahora bien, el tipo de residuos a explorar es un debate de continua discusión. Diversos autores sugieren el uso de los residuos condicionales para evaluar los supuestos del modelo [Faraway, Galetik, Brown &amp; PResscot]. Por su parte, Santos Nobre y da Motta Singer (2007) sugieren que dichos residuos pueden no ser útiles para evaluar los supuestos de normalidad. En particular, estos autores recomienda el uso de los residuos marginales para la exploración de la hipótesis de linealidad respecto de las covariables, mientras que los residuos condicionales se sugieren para explorar los patrones de heterocedasticidad y detección de outliers.</p>
<h4>1.6.2 Modelos anidados</h4>
<p>Previo a la definición de los criterios de comparación de modelos definamos que entendemos por modelos anidados. Supongamos dos modelos <span class="math"><script type="math/tex">M_1</script></span> y <span class="math"><script type="math/tex">M_2</script></span> que explican una variable respuesta a partir de un conjunto de predictoras/variables de clasificación. Decimos que <span class="math"><script type="math/tex">M_1</script></span> está <em>anidado</em> en <span class="math"><script type="math/tex">M_2</script></span>, si <span class="math"><script type="math/tex">M_1</script></span> es un caso particular de <span class="math"><script type="math/tex">M_2</script></span>. En el contexto de los MLMs, el anidamiento se puede dar a nivel de los efectos fijos y/o de las componentes de varianza.</p>
<h4>1.6.3 Pruebas de hipótesis</h4>
<p>Las hipótesis sobre los parámetros de un MLM pueden plantearse mediante la formulación de una hipótesis nula (<span class="math"><script type="math/tex">H_0</script></span>) y una alternativa (<span class="math"><script type="math/tex">H_1</script></span>) que involucre los parámetros
en cuestión. También es posible hacerlo mediante la formulación de las hipótesis en término de dos modelos anidados. Por un lado, se debe definir un <em>modelo general</em>, que abarque las dos hipótesis, nula y alternativa,
y por otro, un <em>modelo nulo</em>, más simplificado, que satisface la <span class="math"><script type="math/tex">H_0</script></span>. Es decir, el modelo general (o de referencia) y el nulo difieren en que el modelo de referencia contiene los parámetros que
desean testearse mientras que el modelo nulo no los contiene.</p>
<h5>1.6.3.1 Prueba del Cociente de Verosimilitudes (LRT)</h5>
<p>La Prueba del Cociente de Verosimilitudes (<em>Likelihood Ratio Test</em>, <em>LRT</em>) es un tipo de prueba
basada en la comparación de los valores de la función de verosimilitud de
dos modelos (por ejemplo, el modelo general y el modelo anidado). El LRT se puede usar para hacer pruebas
sobre los parámetros de efecto fijo o sobre las componentes de varianza de los MLMs. En general, el LRT
requiere que tanto el modelo anidado como el general asociados a cierta hipótesis nula se hayan ajustado
con el mismo conjunto de datos. El estadístico de la prueba se calcula según la <a href="EC13">Ecuación 13</a>, donde <span class="math"><script type="math/tex">L_{anidado}</script></span> y <span class="math"><script type="math/tex">L_{referencia}</script></span> refieren a los valores de la función de verosimilitud de la respuesta, calculados con las estimaciones de los parámetros del modelo, las cuales pueden hacerse con ML o REML.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
W_{LRT}=-2ln(\frac{L_{anidado}}{L_{referencia}}),~W_{LRT} \sim~ \chi^2_{df}
\label{EC13}
\tag{13}
\end{equation}
</script></span>
<p>El estadístico de la prueba tiene distribución asintótica <span class="math"><script type="math/tex">\chi^2_{df}</script></span>, donde <span class="math"><script type="math/tex">df</script></span> refiere a los grados de libertad, los cuales se
obtienen restando al número de parámetros del modelo general, el número de parámetros del modelo nulo. De esta manera, la significancia del
LRT se puede determinar en función de este estadístico y la distribución <span class="math"><script type="math/tex">\chi^2</script></span> correspondiente. Si <span class="math"><script type="math/tex">W_{LRT}</script></span> es
lo suficientemente grande, hay evidencia suficiente para rechazar la hipótesis nula, en favor del modelo general. Si las
verosimilitudes de ambos modelos son muy próximas, el estadístico será pequeño, y no habrá suficiente evidencia para rechazar <span class="math"><script type="math/tex">H_0</script></span>, favoreciendo entonces al modelo nulo o anidado.</p>
<h6>1.6.3.1.1 LRT para los efectos fijos</h6>
<p>Para evaluar hipótesis lineales definidas para los efectos fijos de un MLM se recomienda utilizar las estimaciones por MV.
En el LRT para los efectos fijos de un MLM, los modelos nulo y de referencia difieren en los parámetros de efectos fijos pero comparten el mismo
conjunto de parámetros de varianza. Además, en este caso, el estadístico de la prueba, <span class="math"><script type="math/tex">W_{LRT}</script></span> tiene distribución <span class="math"><script type="math/tex">\chi^2_{df}</script></span> con grados de libertad (df)
igual a la diferencia en el número de parámetros de efecto fijo de los modelos nulo y general.</p>
<h6>1.6.3.1.2 LRT para los efectos aleatorios</h6>
<p>En el caso del uso del LRT para evaluar hipótesis vinculadas a los parámetros de covarianza de un MLM, se recomienda la estimación REML para los modelos nulo y general.
Esta prueba asume que ambos modelos son iguales en efectos fijos pero difieren en el conjunto de parámetros de covarianza. La evaluación de la prueba requiere del cálculo
de <span class="math"><script type="math/tex">W_{LRT}</script></span> con las funciones de verosimilitud calculadas a partir de las estimaciones REML.</p>
<p>La distribución del estadístico depende de si la hipótesis nula involucra valores de los parámetros de covarianza que están en la frontera del espacion de parámetros o no. Si esto no sucede, por ejemplo en el caso de
que se quiera compara un modelo con varianza residual variable vs. un modelo con varianza residual constante o evaluar si la covarianza entre dos efectos aleatorios es nula, el estadístico del
LRT se distribuye <span class="math"><script type="math/tex">\chi^2_{df}</script></span> con grados de libertad igual a la diferencia en el número de parámetros de covarianza entre el modelo general y el nulo.
Ahora bien, cuando la hipótesis nula involucra valores de los parámetros de covarianza en la frontera del espacio paramétrico (por ejemplo, si queremos contrastar si un efecto aleatorio es
necesario, estaríamos contrastando si la varianza del efecto alearorio es cero o no), entonces el estadístico tiene distribución asintótica
<span class="math"><script type="math/tex">\chi^2_p</script></span> y <span class="math"><script type="math/tex">\chi^2_{p-1}</script></span> donde <span class="math"><script type="math/tex">p</script></span> es el número de parámetros de la varianza que se hacen cero bajo <span class="math"><script type="math/tex">H_0</script></span>.</p>
<h5>1.6.3.2 Prueba F</h5>
<p>En el contexto de los MLMs es posible utilizar una prueba-F para evaluar hipótesis lineales definidas sobre los efectos fijos del modelo. En general, la prueba de hipótesis será de la forma:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
H_0:~\boldsymbol{L}\boldsymbol{\beta}=\boldsymbol{0}~vs.~H_1:~\boldsymbol{L}\boldsymbol{\beta} \neq \boldsymbol{0}
\label{EC14}
\tag{14}
\end{equation}
</script></span>
<p>donde <span class="math"><script type="math/tex">\boldsymbol{L}</script></span> es una matriz de contrastes conocida. El estadístico <span class="math"><script type="math/tex">F</script></span> asociado a dicha prueba está dado por la <a href="EC15">Ecuación 15</a>.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
F=\frac{\hat{\boldsymbol{\beta}}' \boldsymbol{L}'(\boldsymbol{L}(\sum\limits_i{\boldsymbol{X}_i'\boldsymbol{V}_i^{-1}\boldsymbol{X}_i})^{-1}\boldsymbol{L}')^{-1}\boldsymbol{L}\hat{\boldsymbol{\beta}}}{rango(\boldsymbol{L})}
\label{EC15}
\tag{15}
\end{equation}
</script></span>
<p>El estadístico de la prueba tiene distribución aproximada <span class="math"><script type="math/tex">F</script></span>, con grados de libertad del numerador igual al rango de la matriz <span class="math"><script type="math/tex">\boldsymbol{L}</script></span> y grados de libertad del denominador aproximados mediante diversas estrategias que deben tener en cuenta la presencia de efectos aleatorios y residuos correlacionados.</p>
<h4>1.6.4 Criterios de Información</h4>
<p>Los criterios de información son útiles para evaluar el ajuste de un modelo en base al valor óptimo de la función de log-verosimilitud
luego de aplicar una penalización por el número de parámetros que debe estimar el modelo. No sólo permiten evaluar un único modelo, sino que
además resultan útiles para comparar varios modelos ajustados utilizando el mismo conjunto de datos, que no necesariamente deben estar anidados, ya que
mientras más chico sea el valor que indica el criterio mejor será el ajuste.</p>
<h5>1.6.4.1 Criterio de Información de Akaike (AIC)</h5>
<p>El índice del <em>Criterio de Información de Akaike</em> (AIC) se obtiene a partir de la siguiente ecuación:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
AIC=-2ln(L(\hat{\boldsymbol{\beta}}, \hat{\boldsymbol{\theta}}))+2q
\label{EC16}
\tag{16}
\end{equation}
</script></span>
<p>donde <span class="math"><script type="math/tex">L(\hat{\boldsymbol{\beta}}, \hat{\boldsymbol{\theta}})</script></span> es la función de verosimilitud del modelo ajustado vía ML o REML y <span class="math"><script type="math/tex">q</script></span> representa el número de parámetros que se
estiman en el modelo tanto para los efectos fijos como los aleatorios.</p>
<h5>1.6.4.2 Criterio de Información de Bayes (BIC)</h5>
<p>El índice del <em>Criterio de Información de Bayes</em> (BIC) se obtiene a partir de la <a href="EC17">Ecuación 17</a>, donde <span class="math"><script type="math/tex">n</script></span> refiere al total de las observaciones que se utilizan en la estimación del modelo. La penalización aplicada por el BIC es mayor
que la que aplica el AIC ya que al número de parámetros estimados los multiplica por un número positivo <span class="math"><script type="math/tex">(ln(n))</script></span> que suele ser mayor que <span class="math"><script type="math/tex">2</script></span>.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
BIC=-2ln(L(\hat{\boldsymbol{\beta}}, \hat{\boldsymbol{\theta}}))+qln(n)
\label{EC17}
\tag{17}
\end{equation}
</script></span>
<h3>1.7 Funciones útiles</h3>
<p>La siguiente tabla lista un conjunto de funciones de los paquetes <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lme4</code> útiles para extrer información de un modelo ajustado mediante la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lme()</code>.</p>
<table>
<thead>
<tr>
<th>Resultado</th>
<th>Función sobre <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lmeFit</code> de clase <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lme</code></th>
<th>Función sobre <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lmerFit</code> de clase <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lmer</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Método de estimación</td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lmeFit['method']</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">isREML(lmerFit)</code></td>
</tr>
<tr>
<td><span class="math"><script type="math/tex">\hat{\boldsymbol{\beta}}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">fixef(lmeFit)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">fixef(lmerFit)</code></td>
</tr>
<tr>
<td><span class="math"><script type="math/tex">\hat{\boldsymbol{\beta}}</script></span> , <span class="math"><script type="math/tex">EE(\hat{\boldsymbol{\beta}})</script></span>, prueba t</td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">summary(lmeFit)['tTable']</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">summary(lmerFit)$coefficients</code></td>
</tr>
<tr>
<td><span class="math"><script type="math/tex">\hat{Var}(\hat{\boldsymbol{\beta}})</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">vcov(lmeFit)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">vcov(lmerFit)</code></td>
</tr>
<tr>
<td>I.C. del 95% para <span class="math"><script type="math/tex">\boldsymbol{\beta}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">intervals(lmeFit, which='fixed')</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">confint.merMod(lmerFit, parm ='beta_')</code></td>
</tr>
<tr>
<td><span class="math"><script type="math/tex">\hat{\sigma}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">summary(lmeFit)['sigma']</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">summary(lmerFit)$sigma</code></td>
</tr>
<tr>
<td><span class="math"><script type="math/tex">\hat{\boldsymbol{u}}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">ranef(lmeFit)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">randomeffects(lmerFit)</code></td>
</tr>
<tr>
<td><span class="math"><script type="math/tex">\hat{\boldsymbol{\beta}}_0+\hat{\boldsymbol{u}}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">coef(lmeFit)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">coef(lmerFit)</code></td>
</tr>
<tr>
<td><span class="math"><script type="math/tex">\hat{\boldsymbol{G}}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">getVarCov(lmeFit)</code></td>
<td></td>
</tr>
<tr>
<td><span class="math"><script type="math/tex">\hat{\boldsymbol{G}}</script></span> y <span class="math"><script type="math/tex">\hat{\sigma}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">VarCorr(lmeFit)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">print(VarCorr(lmerFit), comp=c('Variance', 'Std.Dev.')</code></td>
</tr>
<tr>
<td><span class="math"><script type="math/tex">\hat{\boldsymbol{R}}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">getVarCov(lmeFit,type='conditional')</code></td>
<td></td>
</tr>
<tr>
<td><span class="math"><script type="math/tex">\hat{\boldsymbol{V}}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">getVarCov(lmeFit,type='marginal')</code></td>
<td></td>
</tr>
<tr>
<td>log-Verosimilitud vía ML</td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">logLik(lmeFit,REML=FALSE)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">logLik(lmerFit,REML=FALSE)</code></td>
</tr>
<tr>
<td>log-Verosimilitud vía REML</td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">logLik(lmeFit,REML=TRUE)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">logLik(lmerFit,REML=TRUE)</code></td>
</tr>
<tr>
<td>AIC</td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">AIC(lmeFit)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">AIC(lmerFit)</code></td>
</tr>
<tr>
<td>BIC</td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">BIC(lmeFit)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">BIC(lmerFit)</code></td>
</tr>
<tr>
<td><span class="math"><script type="math/tex">\hat{\boldsymbol{y}}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">fitted(lmeFit, level=0)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">fitted(lmerFit)</code></td>
</tr>
<tr>
<td>Residuos crudos o condicionales: <span class="math"><script type="math/tex">\boldsymbol{y}-\hat{\boldsymbol{y}}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">residuals(lmeFit)</code> o <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">resid(lmeFit)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">residuals(lmerFit)</code> o <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">resid(lmerFit)</code></td>
</tr>
<tr>
<td>Residuos marginales: <span class="math"><script type="math/tex">\boldsymbol{y}-\boldsymbol{X}\hat{\boldsymbol{\beta}}</script></span></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">resid(lmeFit, type="response", level=0)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">resid(lmerFit, type="response", level=0)</code></td>
</tr>
<tr>
<td>Residuos de Pearson</td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">resid(lmeFit, type="pearson")</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">resid(lmerFit, type="pearson")</code></td>
</tr>
<tr>
<td>Valores condicionales predichos para un nuevo conjunto de datos</td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">predict(lmeFit, newdata)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">predict(lmerFit, newdata)</code></td>
</tr>
<tr>
<td>Valores marginales predichos para un nuevo conjunto de datos</td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">predict(lmeFit, newdata, level=0)</code></td>
<td><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">predict(lmerFit, newdata, level=0)</code></td>
</tr>
</tbody>
</table>
<h3>1.8 Estrategias de construcción de modelos</h3>
<p>El objetivo principal del proceso de selección de modelos es elegir el modelo más simple que proporcione
el mejor ajuste a los datos observados. En general, suelen existir diversas posibilidades acerca de cuál/cuales
efectos fijos y/o aleatorios deben incluirse en el MLM y de qué estructura se debe adoptar
para las matrices de covarianza. Todas estas consideraciones tinen un impacto tanto en la estimación de la media marginal como en la esimación de la
matriz de varianzas y covarianzas del modelo. El proceso de construir un MLM es iterativo, ya que requiere un conjunto de pasos de ajuste,
evaluación y selección de estructuras apropiadas para los datos observados, es por ello que no existe una única estrategia para llevarlo a cabo.</p>
<h4>1.8.1 La estrategia <em>Top-Down</em></h4>
<p>Esta estrategia ha sido sugerida por Verbeke &amp; Molenberghs (2000) para la construcción de
MLMs a partir de un conjunto de datos. Se la suele llamar estrategia <em>Top-Down</em> porque plantea
iniciar el ajuste a partir de un modelo maxima del efectos fijos. La estrategia consiste en:</p>
<p>I. <strong>Comenzar con una estructura adecuada para la media del modelo</strong>: Este paso implica considerar todos los efectos fijos de interés (y sus interacciones) como sea posible, asegurándose de que las variaciones
sistemáticas en la respuesta sean bien explicadas por las covariables.</p>
<p>II. <strong>Elegir una estructura para los efectos aleatorios</strong>: Se debe optar por una configuración para la estructura de efectos
fijos, la cual debe ser evaluada para determinar si su inclusión en el modelo es o no útil.</p>
<p>III. <strong>Elegir una estructura de covarianza para los residuos del modelo</strong>: Una vez definidos los efectos
fijos y aleatorios, se debe optar por una estructura de covarianza apropiada para explicar la mayor cantidad de  la variabilidad residual de la respuesta.</p>
<p>IV. <strong>Reducir el modelo</strong>: Determinar, mediante pruebas estadísticas, qué efectos fijos son o no necesarios en el modelo.</p>
<p>Por lo general, el proceso de selección implica iterar entre los pasos 2 y 4.</p>
<h4>1.8.2 La estrategia <em>Step-Up</em></h4>
<p>Una estrategia alternativa, desarrollada en el contexto de los modelos lineales jerárquicos, es la llamada <em>Step-Up</em>, definida por
Raudenbush &amp; Bryk (2002) y Snijders &amp; Bosker (1999). La estrategia consiste en:</p>
<p>I. <strong>Comenzar con un modelo de nivel 1</strong>: Ajustar un modelo para los datos de nivel 1, con el intercepto
como único efecto fijo e incluyendo los efectos aleatorios asociados a los niveles superiores. El objetivo de este
modelo es evaluar la variabilidad a lo largo de los diferentes niveles de los datos
agrupados/longitudinales.</p>
<p>II. <strong>Construir el modelo añadiendo las covariables de nivel 1. En el modelo de nivel 2, agregar efectos aleatorios a las
ecuaciones de los coeficientes de nivel 1</strong>: Las covariables de nivel 1 y sus efectos fijos se agregan al modelo de nivel 1.
Estas covariables pueden contribuir a explicar la variación residual asociada a las observaciones en dicho nivel. El modelo de nivel 2
también se modifica para inluir efectos aleatorios a las ecuaciones de los coeficientes de las covariables del nivel 1. De esta manera, se busca representar
las variaciones aleatorias en los efectos de nivel 1 a lo largo de las unidades del nivel 2.</p>
<p>III. <strong>Construir el modelo añadiendo las covariables de nivel 2 al modelo de nivel 2.
Para los modelos a tres niveles, agregar los efectos aleatorios debidos a las covariables de nivel 2 en el modelo de nivel 3.</strong>:
En este paso se añaden las covariables de nivel 2 y sus efectos fijos asociados al modelo de nivel 2. De esta manera, se intenta explicar parte de la variabilidad en los efectos de las covariables de nivel 1, que es captirada por los efectos aleatorios
en el nivel 2. Si el modelo involucra tres niveles, los efectos de las covariables de nivel 2 se pueden incorporar en el modelo de nivel 2 pudiendo además variar aleatoriamente en las unidades de nivel 3.
Después de que se hayan especificado las ecuaciones apropiadas para los efectos de las covariables de nivel 1 en el modelo de nivel 2, se pueden evaluar los supuestos sobre los efectos aleatorios
en el modelo de nivel 2 (por ejemplo, normalidad y varianza constante). Este proceso se repite para el modelo de nivel 3 en el caso de un análisis de tres niveles.</p>
<p>Los pasos de creación de modelos aquí presentados son sólo directrices y no son reglas estrictas para la selección de modelos.</p>
<h2>2. Modelo a dos niveles para datos agrupados</h2>
<p>A continuación vamos a ilustrar el análisis de un conjunto de datos agrupados a dos niveles, siguiendo la estrategia <em>Top-Down</em>. El conjunto de
datos que analizaremos forma parte del libro <em>Mixed-Effects Models in S and S-PLUS</em> (2000), de los autores
Jose Pinheiro y Douglas Bates, quienes además son los desarrolladores del paquete <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code>.</p>
<h3>2.1 Descripción del conjunto de datos</h3>
<p>Los datos se originaron mediante un estudio en el cual 30 ratas fueron aleatoriamente asignadas a tres
tratamientos, caracterizados por tres niveles de dosis (alta, baja, control) de cierto compuesto.
El objetivo del estudio fue comparar los pesos, en el momento del nacimiento, de las crías de camadas de las ratas
que recibieron las dosis alta y baja con los pesos de las crías de las ratas que recibieron el tratamiento control.
Aunque al iniciar el experimento cada nivel de dosis se asignó a 10 ratas diferentes, el conjunto de datos cuenta con observaciones de 27 ratas ya que tres de las 10 ratas
que recibieron la dosis alta murieron en el transcurso del experimento. Cabe destacar además que el
número de crías paridas en cada camada varía ampliamente, entre 2 y 18 crías, por lo que el
estudio presenta un diseño desbalanceado.</p>
<p>Este conjunto de datos es un claro ejemplo de un experimento con datos agrupados a dos niveles. El nivel 1
está conformado por las crías, y el nivel dos por las camadas que parió cada rata, cada una de las cuales fue aleatoriamente asignada
a uno de los tres tratamientos. Es por ello que, es de esperar, los pesos de las crías de la misma camada estén correlacionadas
ya que compartieron el mismo ambiente materno.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; data(RatPupWeight, package="nlme")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; head(RatPupWeight)</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Grouped Data: weight ~ 1 | Litter</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>  weight  sex Litter Lsize Treatment</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1   6.60 Male      1    12   Control</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>2   7.40 Male      1    12   Control</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>3   7.15 Male      1    12   Control</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>4   7.24 Male      1    12   Control</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>5   7.10 Male      1    12   Control</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>6   6.04 Male      1    12   Control</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(RatPupWeight)</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>weight          sex          Litter        Lsize         Treatment</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Min.   :3.680   Male  :171   7      : 18   Min.   : 2.00   Control:131</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1st Qu.:5.650   Female:151   9      : 17   1st Qu.:12.00   Low    :126</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Median :6.055                8      : 17   Median :14.00   High   : 65</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Mean   :6.081                11     : 16   Mean   :13.33</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>3rd Qu.:6.397                20     : 16   3rd Qu.:16.00</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Max.   :8.330                14     : 15   Max.   :18.00</span></span></span>
</pre>
<p>Entre las variables registradas, identificamos las variables asociadas a los grupos de nivel 1, las crías, que son el peso (<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">weight</code>) y el sexo (<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">sex</code>) y las
variables asociadas a los grupos de nivel 2 (camadas): identificador de camada (<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Litter</code>), cantidad de crías de la camada (<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Lsize</code>) y tratamiento recibido (<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Treatment</code>).</p>
<p>Ignorando los efectos aleatorios anidados en este conjunto de datos, podemos explorar como se comporta la variable respuesta ante los dos factores de clasificación de interés
<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">sex</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Treatment</code>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; ggplot(RatPupWeight, aes(x=sex, y=weight, fill=Treatment))+geom_boxplot()</span></span></span>
</pre>
<p><img src="../Imagenes/rpupsboxplot.png" alt="Figura3"></p>
<p><em><strong>Figura 3</strong></em>: Diagramas de caja del peso de las crías, según el tratamiento de la rata y el sexo de la cría.</p>
<p>Ahora bien, las características del problema sugieren que las observaciones están agrupadas en una estructura a dos niveles, la cual puede tener cierto efecto sobre la variabilidad de la respuesta.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; g1&lt;-ggplot(RatPupWeight)+geom_jitter(aes(x=Treatment, y=weight, color=Litter))+facet_wrap(~sex)+theme(legend.position="none")</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; g2&lt;-ggplot(RatPupWeight, aes(x=Litter, y=weight, fill=Litter))+geom_boxplot()+facet_wrap(sex~Treatment, nrow = 2, scales="free_x")+theme(legend.position = "bottom", legend.justification = "center", legend.direction = "horizontal")</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; plot_grid(g1,g2, labels=c("A)", "B)"), nrow=2, rel_heights = c(0.65,1))</span></span></span>
</pre>
<p><img src="../Imagenes/ratPupsExplo.png" alt="Figura4"></p>
<p><em><strong>Figura 4</strong></em>: Diagramas exploratorios para el conjunto de datos de las crías de ratas.</p>
<p><strong>Ejercicio</strong>: Formule hipótesis acerca del peso de las crías de ratas a partir de lo observado en las gráficas anteriores.</p>
<h3>2.2 Ajuste de los modelos estadísticos</h3>
<h4>2.2.1 Modelo maximal en efectos fijos</h4>
<p>De acuerdo a la estrategia elegida, el primer modelo que ajustaremos debe ser
un modelo completo, en término de efectos fijos, donde además consideraremos al efecto camada como un efecto aleatorio. En nuestro caso este modelo a dos niveles es:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
Nivel~1: y_{ijkl}=\mu_{0j}+\alpha_k+\beta_l+\delta * nSize_{j}+\gamma_{kl}+\epsilon_{ijkl},~\epsilon_{ijkl} \sim N(0, \sigma^2) \\

Nivel~2: \mu_{0j}=\mu_0 + u_j,~u_j \sim N(0, \sigma^2_u)
\end{gathered}
\label{EC18}
\tag{18}

\end{equation}
</script></span>
<p>donde <span class="math"><script type="math/tex">\alpha_k</script></span> representa el efecto del k-ésimo tratamiento, <span class="math"><script type="math/tex">\beta_l</script></span> refiere al
efecto del l-ésimo sexo, <span class="math"><script type="math/tex">\delta</script></span> es el coeficiente de regresión para el tamaño (<em>nSize</em>) de la j-ésima camada,
y <span class="math"><script type="math/tex">\gamma_{kl}</script></span> representa el efecto de la interacción del k-ésimo tratamiento
con el l-ésimo nivel de la variable sexo.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; FEModel&lt;-lme(weight~Treatment+sex+Lsize+Treatment:sex, random=~1|Litter, data=RatPupWeight)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(FEModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: RatPupWeight</span></span></span>
<span class="syntax--text syntax--plain"><span>       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>AIC      BIC    logLik</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>419.1043 452.8775 -200.5522</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | Litter</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept) Residual</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:   0.3106722 0.404337</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects: weight ~ Treatment + sex + Lsize + Treatment:sex</span></span></span>
<span class="syntax--text syntax--plain"><span>                            </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Value  Std.Error  DF   t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)              8.323340 0.27333009 292 30.451605  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow            -0.467040 0.15818328  23 -2.952521  0.0071</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh           -0.906057 0.19154238  23 -4.730320  0.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexFemale               -0.411688 0.07315410 292 -5.627679  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Lsize                   -0.128382 0.01875336  23 -6.845819  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow:sexFemale   0.083866 0.10568189 292  0.793568  0.4281</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh:sexFemale  0.107023 0.13176318 292  0.812239  0.4173</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Correlation:</span></span></span>
<span class="syntax--text syntax--plain"><span>                        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intr) TrtmnL TrtmnH sexFml Lsize  TrtL:F</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow            -0.297</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh           -0.562  0.404</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexFemale               -0.111  0.191  0.158</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Lsize                   -0.916  0.022  0.363  0.001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow:sexFemale   0.044 -0.320 -0.096 -0.692  0.036</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh:sexFemale  0.043 -0.106 -0.323 -0.555  0.020  0.385</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min          Q1         Med          Q3         Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-7.47250744 -0.50014749  0.02911668  0.57348178  3.00962055</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 322</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups: 27</span></span></span>
</pre>
<p><strong>Ejercicio:</strong> Establezca hipótesis sobre los coeficientes del modelo.</p>
<p>Sobre los resutlados  del ajuste podemos utilizar diferentes funciones de <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code>. Por ejemplo,
podemos explorar <em>EBLUPs</em>, o el ANOVA sobre los
coeficientes del modelo.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; ranef(FEModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova(FEModel)</span></span></span>
<span class="syntax--text syntax--plain"><span>              </span><span class="syntax--meta syntax--paragraph syntax--text"><span>numDF denDF  F-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)       1   292 9093.772  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Treatment         2    23    5.082  0.0149</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sex               1   292   52.602  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Lsize             1    23   47.374  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Treatment:sex     2   292    0.466  0.6282</span></span></span>
</pre>
<h4>2.2.2 Selección de la estructura de los efectos aleatorios</h4>
<p>Ahora continuemos con la estrategia, definiendo la estructura de los efectos aleatorios. Para ello, lo primero que haremos será evaluar si es adecuada la inclusión de la camada (<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">litter</code>) como efecto aleatorio. Es decir,
buscamos evaluar el contraste de hipótesis planteado en la <a href="EC19">Ecuación 19</a>.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
H_0:~y_{ijkl}=\mu_0+u_j+\alpha_k+\beta_l+\delta * nSize_{j}+\gamma_{kl}+\epsilon_{ijkl} \\

H_1:~y_{ijkl}=\mu_0+\alpha_k+\beta_l+\delta * nSize_{j}+\gamma_{kl}+\epsilon_{ijkl}

\end{gathered}

\label{EC19}

\tag{19}

\end{equation}
</script></span>
<p>Directamente no evaluamos estas hipótesis, ya que los efectos aleatorios son variables aleatorias, sino que evaluamos la hipótesis asociada a su variabilidad:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
H_0:~\sigma^2_u=0 \\

H_1:~\sigma^2_u > 0

\end{gathered}

\label{EC20}

\tag{20}

\end{equation}
</script></span>
<p>Para evaluar esta hipótesis vamos a utilizar el LRT basado en las estimaciones REML, donde
el estadístico es construído mediante el cálculo de menos dos veces la diferencia de log-verosimilitud
que existe entre el modelo que incluye el efecto aleatorio (<span class="math"><script type="math/tex">H_1</script></span>) y el modelo que no lo incluye (<span class="math"><script type="math/tex">H_0</script></span>), ambos modelos ajustados con estimaciones
REML. La distribución asintótica de este estadístico es una mezcla de dos distribuciones <span class="math"><script type="math/tex">\chi^2</script></span> con <span class="math"><script type="math/tex">0</script></span> y <span class="math"><script type="math/tex">1</script></span> grados de libertad
e igual peso (0.5).</p>
<p>Ajustemos entonces el modelo nulo, y construyamos la prueba. Para ajustar el modelo utilizando las estimaciones REML emplearemos
la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">gls()</code> del paquete <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code> útil para ajustar modelos de efectos fijos (marginales).</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; LMModelGLS&lt;-gls(weight~Treatment+sex+Lsize+Treatment:sex, data=RatPupWeight)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; stat&lt;- (-2*logLik(LMModelGLS, REML=TRUE)+2*logLik(FEModel, REML=TRUE))[1]</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; stat</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>[1] 89.40562</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; pval&lt;- mean(pchisq(stat,df=c(0,1),lower.tail=FALSE))</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; pval</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>[1] 1.60811e-21</span></span></span>
</pre>
<p>Una alternativa a la construcción del estadístico y posterior obtención del valor-p es el uso
de la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">anova()</code> de <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code>. Una particularidad que se debe tener en cuenta es que el resultado
que otorga la prueba se basa en una distribución <span class="math"><script type="math/tex">\chi^2_1</script></span>, y que, además, la distribución <span class="math"><script type="math/tex">\chi^2_0</script></span> tiene toda su masa concentrada en 0,
por lo que para obtener el valor correcto, el valor-p del ANOVA se debe dividir por 2.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova(LMModelGLS, FEModel)</span></span></span>
<span class="syntax--text syntax--plain"><span>            </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Model df      AIC      BIC    logLik   Test  L.Ratio p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>LMModelGLS     1  8 506.5099 536.5305 -245.2550</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>FEModel        2  9 419.1043 452.8775 -200.5522 1 vs 2 89.40562  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova(LMModelGLS, FEModel)$'p-value'[2]/2</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>[1] 1.60811e-21</span></span></span>
</pre>
<p>Ambos resultados sugieren que la incorporación del identificador de la camada como efecto aleatorio es adecuada, por lo que
se decide conservar tal efecto en los modelos posteriores.</p>
<h4>2.2.3 Definición de la estructura de correlación de R</h4>
<p>El siguiente paso es determinar la estructura de correlación para la matriz de varianzas y covarianzas residual. El MLM planteado en la <a href="EC16">Ecuación 16</a> propone residuos no correlacionados con varianza residual homogénea. Ahora bien, de acuerdo a lo ilustrado en la <a href="Figura4">Figura 4</a>, la varianza dentro de las camadas en el grupo control parece ser mayor que la varianza intra-camada en los grupos de tratamiento <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">high</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">low</code>. Es por ello que debemos evaluar la posibilidad de contar con una estructura heterogénea en la matriz de varianzas y covarianzas residuales.</p>
<p>Una alternativa es considerar varianzas residuales heterogéneas para cada uno de los grupos definidos por el tratamiento (<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">high</code>, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">low</code>, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">control</code>). Por lo tanto, en vez de un parámetro de varianza residual, tendremos tres: <span class="math"><script type="math/tex">\sigma^2_{high}</script></span>, <span class="math"><script type="math/tex">\sigma^2_{low}</script></span> y <span class="math"><script type="math/tex">\sigma^2_{control}</script></span>. El ajuste del modelo con tal estructura de varianza lo haremos añadiendo a la llamada de la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">lme()</code> la definición de los parámetro<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">weights</code>:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; FEModelHetVar&lt;-lme(weight~Treatment+sex+Lsize+Treatment:sex, random=~1|Litter, weights = varIdent(form = ~1 | Treatment), data=RatPupWeight)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(FEModelHetVar)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: RatPupWeight</span></span></span>
<span class="syntax--text syntax--plain"><span>       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>AIC     BIC    logLik</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>381.8847 423.163 -179.9423</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | Litter</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)  Residual</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:   0.3134846 0.5147948</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Variance function:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Structure: Different standard deviations per stratum</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Formula: ~1 | Treatment</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Parameter estimates:</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Control       Low      High</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1.0000000 0.5649830 0.6394383</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects: weight ~ Treatment + sex + Lsize + Treatment:sex</span></span></span>
<span class="syntax--text syntax--plain"><span>                            </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Value  Std.Error  DF   t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)              8.345294 0.27464753 292 30.385468  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow            -0.466292 0.15908908  23 -2.931013  0.0075</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh           -0.903277 0.19215903  23 -4.700672  0.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexFemale               -0.408131 0.09303486 292 -4.386865  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Lsize                   -0.130007 0.01848708  23 -7.032332  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow:sexFemale   0.076013 0.10811858 292  0.703053  0.4826</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh:sexFemale  0.094666 0.12919527 292  0.732737  0.4643</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Correlation:</span></span></span>
<span class="syntax--text syntax--plain"><span>                        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intr) TrtmnL TrtmnH sexFml Lsize  TrtL:F</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow            -0.362                                   </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh           -0.598  0.466                            </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexFemale               -0.140  0.241  0.200                     </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Lsize                   -0.905  0.056  0.376  0.000              </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow:sexFemale   0.100 -0.303 -0.164 -0.860  0.022       </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh:sexFemale  0.087 -0.173 -0.304 -0.720  0.015  0.620</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min          Q1         Med          Q3         Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-5.88670114 -0.52493419  0.02123518  0.57307286  2.56409983</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 322</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups: 27</span></span></span>
</pre>
<p>Al especificar el parámetro <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">weights</code> mediante una fórmula, lo que hacemos es indicar que las varianzas dependen de los niveles del factor <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Treatment</code>. El resultado del ajuste indica que la desviación estándar residual es <span class="math"><script type="math/tex">0.515</script></span>. Los parámetros estimados que se indican a continuación indican el coeficiente por el que se debe multiplicar la desviación estándar residual para obtener la desviación estándar para cada grupo, es decir:  <span class="math"><script type="math/tex">\hat{\sigma}_{control}=1</script></span>, <span class="math"><script type="math/tex">\hat{\sigma}_{high}=0.515*0.639=0.329</script></span> y <span class="math"><script type="math/tex">\hat{\sigma}_{low}=0.515*0.565=0.291</script></span>. Las correspondientes varianzas residuales pueden obtenerse elevando al cuadrado tales desviaciones.</p>
<p>Para determinar si esta estructura es preferible sobra la estructura de varianza residual homogénea, podemos usar el LRT. En este caso, las hipótesis a constrastar son las siguientes:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
H_0:~\sigma^2_{control}=\sigma^2_{high}=\sigma^2_{low}=\sigma^2 \\
H_1:~Al~menos~un~par~de~varianzas~residuales~no~son~iguales
\end{gathered}
\label{EC21}
\tag{21}
\end{equation}
</script></span>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova( FEModel, FEModelHetVar)</span></span></span>
<span class="syntax--text syntax--plain"><span>              </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Model df      AIC      BIC    logLik   Test  L.Ratio p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>FEModel           1  9 419.1043 452.8775 -200.5522                        </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>FEModelHetVar     2 11 381.8847 423.1630 -179.9423 1 vs 2 41.21964  &lt;.0001</span></span></span>
</pre>
<p><strong>Ejercicio:</strong> construya el estadístico de la prueba y obtenga el valor-p correspondiente mediante el cálculo de las log-verosimilitudes de los modelos comparados.</p>
<p>Note que en este caso, como estamos evaluando valores de varianzas residuales dentro del espacio paramétrico y no en la frontera, el valor-p que obtenemos es el adecuado, sin tener que promediar ni dividirlo por 2. El resultado del LRT indica que hay evidencias suficientes para rechazar la <span class="math"><script type="math/tex">H_0</script></span> de homogeneidad de varianzas residuales.</p>
<p>Otra alternativa a este modelo, teniendo en cuenta que las estimaciones de los desvíos estándar residuales de los grupos <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">high</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">low</code> son similares, es considerar un modelo con varianza residual homogénea para las crías de tales grupos, y una varianza residual diferente para las del grupo <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">control</code>.
Para ajustar este modelo, primero vamos a definir el agrupamiento de los distintos tratamientos añadiendo una variable nueva a la base de datos, que contemple dos niveles, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">C</code> si las crías son del grupo <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">control</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">T</code> si son de los grupos <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">high</code> o <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">low</code>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; RatPupWeight$trtGroup[RatPupWeight$Treatment=="Control"]&lt;-"C"</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; RatPupWeight$trtGroup[RatPupWeight$Treatment!="Control"]&lt;-"T"</span></span></span>
</pre>
<p><strong>Nota</strong>: Como la definición del nivel de referencia sigue orden alfanumérico, el nivel <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">C</code> es el de referencia para el factor <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">trtGroup</code>, si no está seguro de esto, añada una línea re-definiendo los niveles del factor para fijar como referencia el deseado.</p>
<p>Ahora sí, ajustamos el modelo incorporando la estructura de varianzas definida según el nuevo agrupamiento de los tratamientos:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; FEModelHetVar2&lt;-lme(weight~Treatment+sex+Lsize+Treatment:sex, random=~1|Litter, weights = varIdent(form = ~1 | trtGroup), data=RatPupWeight)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(FEModelHetVar2)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: RatPupWeight</span></span></span>
<span class="syntax--text syntax--plain"><span>       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>AIC      BIC    logLik</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>381.0807 418.6065 -180.5404</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | Litter</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)  Residual</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:   0.3145679 0.5147878</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Variance function:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Structure: Different standard deviations per stratum</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Formula: ~1 | trtGroup</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Parameter estimates:</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>C         T</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1.0000000 0.5905487</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects: weight ~ Treatment + sex + Lsize + Treatment:sex</span></span></span>
<span class="syntax--text syntax--plain"><span>                            </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Value  Std.Error  DF   t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)              8.350351 0.27567833 292 30.290197  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow            -0.466596 0.15999337  23 -2.916347  0.0078</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh           -0.901844 0.19140145  23 -4.711793  0.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexFemale               -0.408195 0.09303540 292 -4.387529  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Lsize                   -0.130383 0.01856367  23 -7.023574  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow:sexFemale   0.076397 0.10939797 292  0.698337  0.4855</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh:sexFemale  0.092026 0.12461723 292  0.738473  0.4608</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Correlation:</span></span></span>
<span class="syntax--text syntax--plain"><span>                        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intr) TrtmnL TrtmnH sexFml Lsize  TrtL:F</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow            -0.358                                   </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh           -0.605  0.466                            </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexFemale               -0.140  0.240  0.201                     </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Lsize                   -0.906  0.054  0.382  0.000              </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow:sexFemale   0.097 -0.306 -0.162 -0.850  0.023       </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh:sexFemale  0.092 -0.178 -0.292 -0.747  0.013  0.635</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min          Q1         Med          Q3         Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-5.88725877 -0.52398495  0.01731334  0.56412341  2.55014746</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 322</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups: 27</span></span></span>
</pre>
<p>En este modelo, el coeficiente estimado por el cual se debe multiplicar la varianza residual para obener la varianza de los grupos <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">high</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">low</code> resultó ser <span class="math"><script type="math/tex">0.591</script></span>. Para determinar si este modelo es preferible sobre el modelo de varianzas completamente heterogéneas entre los tres grupos tratamientos, planteemos un LRT cuyas hipótesis son:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
H_0:~\sigma^2_{high}=\sigma^2_{low}\\
H_1:~\sigma^2_{high} \neq \sigma^2_{low}
\end{gathered}
\tag{22}
\label{EC22}
\end{equation}
</script></span>
<p>Esta prueba la logramos al comparar las verosimilitudes del modelo actual con el modelo de varianzas heterogéneas anteriormente ajustado:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova( FEModelHetVar2, FEModelHetVar)</span></span></span>
<span class="syntax--text syntax--plain"><span>               </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Model df      AIC      BIC    logLik   Test  L.Ratio p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>FEModelHetVar2     1 10 381.0807 418.6065 -180.5404                        </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>FEModelHetVar      2 11 381.8847 423.1630 -179.9423 1 vs 2 1.196053  0.2741</span></span></span>
</pre>
<p>El resultado de esta prueba indica que no hay evidencias suficientes para rechazar la hipótesis nula, por lo que asumimos que el modelo de varianzas residuales homogéneas para los sujetos de los grupos <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">high</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">low</code>, y diferente para los sujetos del grupo <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">control</code> es el más adecuado.</p>
<p>Por último, comparemos este modelo, con el modelo de varianzas homogéneas, inicialmente definido en la <a href="EC18">Ecuación 18</a>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; stat&lt;- (-2*logLik(FEModel, REML=TRUE)+2*logLik(FEModelHetVar2, REML=TRUE))[1]</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; pval&lt;- pchisq(stat,df=1,lower.tail=FALSE)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; pval</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># [1] 2.509153e-10</span></span></span>
</pre>
<h4>2.2.4 Reducción del modelo</h4>
<p>La última etapa de la estrategia de análisis elegida consiste en analizar los efectos fijos del modelo con el objetivo de eliminar aquellos efectos que no tengan una aporte significativo. Si analizamos los resultados de la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">summary()</code> sobre el modelo elegido hasta el momento (<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">FEModelHetVar2</code>), podemos apreciar que los resultados de las pruebas-<em>t</em> para los coeficientes del modelo indicarían que la interacción <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Treatment</code> con <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Sex</code> no es significativa. Es por ello que comenzaremos planteando una prueba adecuada para evaluar la hipótesis dada por la <a href="EC23">Ecuación 23</a>, donde <span class="math"><script type="math/tex">\beta_5</script></span> y <span class="math"><script type="math/tex">\beta_6</script></span> son los coeficientes asociados a las interacciones <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">TreatmentLow:sexFemale</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">TreatmentHigh:sexFemale</code>, respectivamente.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}

H_0:~\beta_5=\beta_6=0 \\

H_1:~\beta_5\neq 0~y/o~\beta_6 \neq 0
\end{gathered}
\label{EC23}
\tag{23}
\end{equation}
</script></span>
<p>Una alternativa para evaluar estas hipótesis es utilizar una prueba-<span class="math"><script type="math/tex">F</script></span>, mediante la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">anova()</code>, para evaluar la significancia de la interacción <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Treatment:Sex</code>. La otra, es usar un LRT, comparando el modelo actual con un modelo donde se ha removido dicha interacción, ambos ajustados mediante el método MV.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anove(FEModelHetVar2)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>numDF denDF  F-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)       1   292 9027.740  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Treatment         2    23    4.241  0.0271</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sex               1   292   61.568  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Lsize             1    23   49.577  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Treatment:sex     2   292    0.317  0.7288</span></span></span>
</pre>
<p>La llamada a la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">anova()</code> permite obtener los resultados de pruebas-<span class="math"><script type="math/tex">F</script></span> secuenciales sobre los distintos efectos del modelo. Particularmente, el término de la interacción <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Treatment:Sex</code> resulta ser no significativo, por lo cual no se puede rechazar la <span class="math"><script type="math/tex">H_0</script></span> planteada en la <a href="EC23">Ecuación 23</a>. Si utilizamos el LRT, obtendremos resultados análogos como lo muestra el siguiente cuadro:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; FEModelHetVar3LM&lt;-lme(weight~Treatment+sex+Lsize, random=~1|Litter,  weights = varIdent(form = ~1 | trtGroup), data=RatPupWeight, method = "ML")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; FEModelHetVar2LM&lt;-lme(weight~Treatment+sex+Lsize+Treatment:sex, random=~1|Litter, weights = varIdent(form = ~1 | trtGroup), data=RatPupWeight, method = "ML")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova(FEModelHetVar3LM,FEModelHetVar2LM)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Model df      AIC      BIC    logLik   Test   L.Ratio p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>FEModelHetVar3LM     1  8 353.7734 383.9698 -168.8867                         </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>FEModelHetVar2LM     2 10 357.1317 394.8773 -168.5659 1 vs 2 0.6416578  0.7255</span></span></span>
</pre>
<p>Acorde a los resultados, hay no evidencias suficientes para rechazar la hipótesis nula, por lo que se asume que no hay interacción entre los factores <em>Tratamiento</em> y <em>sexo</em>.</p>
<p>Finalmente, evaluemos si es significativa la incorporación del término <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">Treatment</code> en el modelo o no, mediante una prueba LRT:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; FEModelHetVar4LM&lt;-lme(weight~sex+Lsize, random=~1|Litter, weights = varIdent(form = ~1 | trtGroup), data=RatPupWeight, method = "ML")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova(FEModelHetVar4LM,FEModelHetVar3LM)</span></span></span>
<span class="syntax--text syntax--plain"><span>                 </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Model df      AIC      BIC    logLik   Test  L.Ratio p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>FEModelHetVar4LM     1  6 368.3706 391.0179 -178.1853                        </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>FEModelHetVar3LM     2  8 353.7734 383.9698 -168.8867 1 vs 2 18.59723   1e-04</span></span></span>
</pre>
<p>Los resultados de dicha prueba indican que hay evidencias significativas para preferir el modelo con el efecto <em>Tratamiento</em> por sobre el modelo que no lo incluye como efecto fijo.</p>
<p>Como conclusión, el modelo elegido es:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
y_{ijkl}=\mu_0+u_j+\alpha_k+\beta_l+\delta*nSize_j+\epsilon_{ijkl}
\label{EC24}
\tag{24}
\end{equation}
</script></span>
<p>donde <span class="math"><script type="math/tex">\mu_0</script></span> es la media general para el peso de las crías de rata, <span class="math"><script type="math/tex">u_j</script></span> es el efecto aleatorio asociado a la j-ésima camada, <span class="math"><script type="math/tex">\alpha_k</script></span> es el efecto del k-ésimo nivel del factor <em>Sexo</em>, <span class="math"><script type="math/tex">\beta_l</script></span> es el efecto asociado al l-ésimo nivel de <em>Tratamiento</em>, <span class="math"><script type="math/tex">\delta</script></span> representa el coeficiente de regresión asociado al tamaño de la j-ésima camada y <span class="math"><script type="math/tex">\epsilon_{ijkl}</script></span> es el término de error residual de la i-ésima cría. Particularmente, <span class="math"><script type="math/tex">u_j</script></span> es una V.A. con distribución <span class="math"><script type="math/tex">N(0,\sigma^2_u)</script></span> y <span class="math"><script type="math/tex">\epsilon_{ijkl}</script></span> es una V.A. con distribución <span class="math"><script type="math/tex">N(0,\sigma^2_{l*})</script></span> donde <span class="math"><script type="math/tex">\sigma^2_{l*}=\sigma^2_{C}</script></span> si <span class="math"><script type="math/tex">l=control</script></span> y <span class="math"><script type="math/tex">\sigma^2_{l*}=\sigma^2_{T}</script></span> si <span class="math"><script type="math/tex">l=high</script></span> o <span class="math"><script type="math/tex">l=low</script></span>. Además, <span class="math"><script type="math/tex">u_j</script></span> y <span class="math"><script type="math/tex">\epsilon_{ijkl}</script></span> no están correlacionados.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>SelectedModel&lt;-lme(weight~Treatment+sex+Lsize, random=~1|Litter, weights = varIdent(form = ~1 | trtGroup), data=RatPupWeight)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>summary(SelectedModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: RatPupWeight</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>AIC      BIC    logLik</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>372.2784 402.3497 -178.1392</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | Litter</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)  Residual</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:   0.3146374 0.5144324</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Variance function:</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Structure: Different standard deviations per stratum</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | trtGroup</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Parameter estimates:</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>C         T</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1.0000000 0.5889108</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects: weight ~ Treatment + sex + Lsize</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Value  Std.Error  DF   t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)    8.327633 0.27406956 294 30.385107  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow  -0.433663 0.15226167  23 -2.848140  0.0091</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh -0.862268 0.18293359  23 -4.713556  0.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexFemale     -0.343431 0.04204323 294 -8.168531  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Lsize         -0.130681 0.01855194  23 -7.044036  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Correlation:</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intr) TrtmnL TrtmnH sexFml</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentLow  -0.348                     </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>TreatmentHigh -0.610  0.464              </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexFemale     -0.103 -0.035 -0.006       </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Lsize         -0.913  0.064  0.403  0.043</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min          Q1         Med          Q3         Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-5.97351495 -0.53695365  0.01508652  0.54234475  2.58286992</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 322</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups: 27</span></span></span>
</pre>
<p><strong>Ejercicio</strong>: Analice e interprete los resultados del modelo en término de efectos fijos, ICC. Construya una gráfica que explique el comportamiento del peso promedio en los distintos grupos de crías de rata.</p>
<h2>3. Modelo a tres niveles para datos agrupados</h2>
<p>En los modelos a tres niveles, las unidades de análisis (nivel 1) están anidadas en subgrupos aleatoriamente muestreados (nivel 2) los cuales a su vez están anidados en grupos (nivel 3), surgidos también del muestreo aleatorio. Esta estructura permite entonces investigar el efecto que tienen las covariables mediadas en cualquiera de los niveles de agrupamiento, sobre la variable respuesta. Ejemplos de estos diseños pueden encontrarse por ejemplo, en medicina, en experimentos donde las unidades experimentales son los pacientes, los cuales están agrupados en hospitales, que a su vez, se agrupan en municipios (provincias o incluso países).</p>
<p>Para ilustrar el análisis de conjuntos de datos agrupados a tres niveles vamos a utilizar el dataset <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">SIIdata</code> del paquete <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlmeU</code>.</p>
<h3>3.1 Descripción del conjunto de datos</h3>
<p>El conjunto de datos pertenece a un estudio llevado a cabo por investigadores de la Universidad de Michigan, destinado a analizar el rendimiento en matemática logrado por alumnos de primer y tercer grado, aleatoriamente seleccionados de escuelas elementales de Estados Unidos. Particularmente, en este caso, se cuenta con datos de 1.190 estudiantes de primer grado aleatoriamente seleccionados de 312 cursos en 107 escuelas. La variable de interés, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">mathgain</code>, mide el cambio en la nota de matemática lograda por el alumno desde que salió de jardín de infantes hasta la fecha.
El diseño del experimento determinó una estructura de agrupamiento a tres niveles: los estudiantes (Nivel 1), anidados dentro de cursos (Nivel 2), agrupados dentro de escuelas (Nivel 3). Se desea examinar la contribución de los distintos niveles a la variación en la ganancia de notas de los alumnos.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; data(SIIdata, package="nlmeU")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; head(SIIdata)</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>sex minority mathkind mathgain   ses yearstea mathknow housepov mathprep classid schoolid childid</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 1   F Mnrt=Yes      448       32  0.46        1       NA    0.082     2.00     160        1       1</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 2   M Mnrt=Yes      460      109 -0.27        1       NA    0.082     2.00     160        1       2</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 3   F Mnrt=Yes      511       56 -0.03        1       NA    0.082     2.00     160        1       3</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 4   M Mnrt=Yes      449       83 -0.38        2    -0.11    0.082     3.25     217        1       4</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 5   M Mnrt=Yes      425       53 -0.03        2    -0.11    0.082     3.25     217        1       5</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 6   F Mnrt=Yes      450       65  0.76        2    -0.11    0.082     3.25     217        1       6</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(SIIdata)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sex         minority      mathkind        mathgain            ses              yearstea    </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>M:588   Mnrt=No :384   Min.   :290.0   Min.   :-110.00   Min.   :-1.61000   Min.   : 0.00  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>F:602   Mnrt=Yes:806   1st Qu.:439.2   1st Qu.:  35.00   1st Qu.:-0.49000   1st Qu.: 4.00  </span></span></span>
<span class="syntax--text syntax--plain"><span>                       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Median :466.0   Median :  56.00   Median :-0.03000   Median :10.00  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>                       Mean   :466.7   Mean   :  57.57   Mean   :-0.01298   Mean   :12.21  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>                       3rd Qu.:495.0   3rd Qu.:  77.00   3rd Qu.: 0.39750   3rd Qu.:20.00  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>                       Max.   :629.0   Max.   : 253.00   Max.   : 3.21000   Max.   :40.00  </span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span>   </span><span class="syntax--meta syntax--paragraph syntax--text"><span>mathknow          housepov         mathprep        classid        schoolid       childid    </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Min.   :-2.5000   Min.   :0.0120   Min.   :1.000   26     :  10   11     :  31   1      :   1  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1st Qu.:-0.7200   1st Qu.:0.0850   1st Qu.:2.000   42     :  10   12     :  27   2      :   1  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Median :-0.1300   Median :0.1270   Median :2.300   13     :   9   71     :  27   3      :   1  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Mean   : 0.0312   Mean   :0.1782   Mean   :2.612   189    :   9   76     :  27   4      :   1  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>3rd Qu.: 0.8500   3rd Qu.:0.2550   3rd Qu.:3.000   205    :   9   77     :  24   5      :   1  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Max.   : 2.6100   Max.   :0.5640   Max.   :6.000   253    :   9   31     :  22   6      :   1  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>NA's   :109                                        (Other):1134   (Other):1032   (Other):1184  </span></span></span>
</pre>
<p>Las variables contenidas en la base de datos son:</p>
<ul>
<li>Variables asociadas a los estudiantes:
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">childid</code>: Identificador único para cada estudiante.</li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">sex</code>: Sexo de cada estudiante.</li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">mathgain</code>: Ganancia en la nota de matemática entre la primavera del año de jardín de infantes a la primavera de primer grado.</li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">mathkind</code>: Nota de matemática en la primavera de jardín de infantes.</li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">ses</code>: Estado socioeconómico, en escala numérica.</li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">minority</code>: Variable indicadora del estado de minoría.</li>
</ul>
</li>
<li>Variables asociadas a los cursos:
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">classid</code>: Identificador del curso de cada estudiante.</li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">yearstea</code>: Años de experiencia del docente en primer grado.</li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">mathknow</code>: Indicador del nivel de conocimiento en matemática del docente.</li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">mathprep</code>: Número de cursos preparatorios en métodos y contenidos matemáticos que ha tomado el docente.</li>
</ul>
</li>
<li>Variables a nivel de las escuelas:
<ul>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">schoolid</code>: Identificador de la escuela a la que asiste cada estudiante.</li>
<li><code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">housepov</code>: Porcentaje de hogares bajo el nivel de pobreza en el barrio entorno a la escuela.</li>
</ul>
</li>
</ul>
<p><strong>Ejercicio</strong>: Obtenga medidas resumenes y descriptivas de las distintas variables. ¿Qué sucede con los datos faltantes? Cómo decide tratarlos? Explore la base de datos en búsqueda de posibles relaciones entre la variable respuesta y las covariables.</p>
<h3>3.2 Ajuste de los modelos estadísticos</h3>
<p>Para este análisis utilizaremos la estrategia <em>Step-up</em> previamente explicada.</p>
<h4>3.2.1 Modelo de componentes varianzas</h4>
<p>Es el modelo más sencillo, el MLM sólo considerará al intecepto como efecto fijo, y presentará la estructura de efectos aleatorios adecuados. Comencemos planteando el modelo con la estructura de anidamiento característica del diseño:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
Nivel~1:~y_{ijk}=\beta_{0jk}+\epsilon_{ijk}, \epsilon_{ijk} \sim N(0, \sigma^2) \\

Nivel~2:~\beta_{0jk}=\beta_0 + u_{j|k}+\beta_{0k},~u_{j|k}\sim N(0, \sigma^2_{uc})
\\
Nivel~3:~\beta_{0k}= u_k,~u_k \sim N(0, \sigma^2_{us})
\end{gathered}
\label{EC25}
\tag{25}

\end{equation}
</script></span>
<p>Asumimos además que el efecto aleatorio asociado a una escuela <em>k</em>, el efecto aleatorio asocido a un curso <em>j</em> dentro de la escuela <em>k</em> y los errores de estimación son independientes. Ajustemos el modelo con <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; varCompModel&lt;-lme(mathgain~1, random=~1|schoolid/classid, data=SIIdata, method="REML")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(varCompModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: SIIdata</span></span></span>
<span class="syntax--text syntax--plain"><span>       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>AIC      BIC    logLik</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>11776.76 11797.09 -5884.382</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:    8.802955</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | classid %in% schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept) Residual</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:    9.961301 32.06609</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects: mathgain ~ 1</span></span></span>
<span class="syntax--text syntax--plain"><span>               </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Value Std.Error  DF  t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept) 57.42703  1.443288 878 39.78903       0</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min          Q1         Med          Q3         Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-4.64405126 -0.59835943 -0.03364297  0.53341988  5.63351835</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 1190</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups:</span></span></span>
<span class="syntax--text syntax--plain"><span>             </span><span class="syntax--meta syntax--paragraph syntax--text"><span>schoolid classid %in% schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>                  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>107                   312</span></span></span>
</pre>
<p>Una vez ajustado este modelo, es posible obtener estimaciones iniciales de las componenetes de varianza de los efectos aleatorios, al nivel de la escuelas y de los cursos. En el contexto de los modelos anidados a tres niveles, el ICC se obtiene según la <a href="EC26">Ecuación 26</a> y <a href="EC27">Ecuación 27</a>.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
ICC_{school}=\frac{\sigma_{us}^2}{\sigma_{us}^2+\sigma_{uc}^2+\sigma^2}
\end{equation}
\label{EC26}
\tag{26}
</script></span>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
ICC_{class}=\frac{\sigma_{us}^2+\sigma_{uc}^2}{\sigma_{us}^2+\sigma_{uc}^2+\sigma^2}
\end{equation}
\label{EC27}
\tag{27}
</script></span>
<p>Debemos determinar si la estructura de los efectos aleatorios para el modelo de las componentes de varianzas es o no adecuado. Para ello lo compararemos, mediante una prueba LRT, con el modelo de componentes de varianzas que sólo tiene en cuenta la escuela como efecto aleatorio, dado por la <a href="EC28">Ecuación 28</a>. De esta manera, estaremos evaluando la hipótesis <span class="math"><script type="math/tex">H_0:~\sigma^2_{uc}=0</script></span>.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
Nivel~1:~y_{ijk}=\beta_{0k}+\epsilon_{ijk}, \epsilon_{ijk} \sim N(0, \sigma^2) \\
Nivel~2:~\beta_{0k}=\beta_0 + u_k+,~u_{k}\sim N(0, \sigma^2_{us})
\end{gathered}
\label{EC28}
\tag{28}

\end{equation}
</script></span>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; varCompModelSRE&lt;-lme(mathgain~1, random=~1|schoolid,data=SIIdata, method="REML")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; stat&lt;- (-2*logLik(varCompModelSRE, REML=TRUE)+2*logLik(varCompModel, REML=TRUE))[1]</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; pval&lt;- mean(pchisq(stat,df=c(0,1),lower.tail=FALSE))</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; pval</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># [1] 0.002465241</span></span></span>
</pre>
<p>A un nivel de significancia <span class="math"><script type="math/tex">\alpha=0.05</script></span>, el valor-p de la prueba es significativo, por lo que rechazamos <span class="math"><script type="math/tex">H_0</script></span>, asumiendo entonces que <span class="math"><script type="math/tex">\sigma^2_{uc}>0</script></span>, por lo que asumimos como adecuado el modelo de componentes de varianzas dado por la <a href="EC25">Ecuación 25</a>. Cabe destacar que conservaremos además que conservamos además el intercepto aleatorio asociado con las escuelas, para preservar la estructura jerárquica de los datos.</p>
<h4>3.2.2 Modelo con covariables de nivel 1</h4>
<p>En esta etapa, agregarmos los efectos fijos asociados a covariables medidas sobre los estudiantes, es decir, de Nivel 1, para así aumentar la proporción de varianza explicada por el modelo. En el Nivel 1, tenemos efectos de cuatro variables para añadir al modelo: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">mathkind</code>, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">sex</code>, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">minority</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">ses</code>. La <a href="EC29">Ecuación 29</a> presenta el modelo correspondiente, teniendo en cuenta la notación <span class="math"><script type="math/tex">\boldsymbol{y}=\boldsymbol{X}\boldsymbol{\beta}+\boldsymbol{Z}\boldsymbol{u}+\boldsymbol{\epsilon}</script></span>.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
y_{ijk}=\beta_0+\beta_{0jk}+\beta_1*sex_{ijk}+\beta_2*minority_{ijk}+\beta_3*ses_{ijk}+\beta_4*mathkind_{ijk}+\epsilon_{ijk}+u_{j|k}+u_k\\
 \epsilon_{ijk} \sim N(0, \sigma^2), ~u_{j|k}\sim N(0, \sigma^2_{uc})~u_k, \sim N(0, \sigma^2_{us})
\end{gathered}
\label{EC29}
\tag{29}
\end{equation}
</script></span>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; FEL1Model&lt;-lme(mathgain~sex+minority+ses+mathkind, random=~1|schoolid/classid, data=SIIdata, method="REML", na.action="na.omit")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(FEL1Model)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: SIIdata</span></span></span>
<span class="syntax--text syntax--plain"><span>      </span><span class="syntax--meta syntax--paragraph syntax--text"><span>AIC      BIC    logLik</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>11401.8 11442.42 -5692.902</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:    8.671991</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | classid %in% schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept) Residual</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:     9.12604 27.10286</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects: mathgain ~ sex + minority + ses + mathkind</span></span></span>
<span class="syntax--text syntax--plain"><span>                     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Value Std.Error  DF    t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)      282.79034 10.853234 874  26.055860  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexF              -1.25119  1.657730 874  -0.754762  0.4506</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>minorityMnrt=Yes  -8.26213  2.340113 874  -3.530655  0.0004</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>ses                5.34638  1.241094 874   4.307794  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>mathkind          -0.46980  0.022266 874 -21.099524  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Correlation:</span></span></span>
<span class="syntax--text syntax--plain"><span>                 </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intr) sexF   mnrM=Y ses   </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexF             -0.044                     </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>minorityMnrt=Yes -0.307 -0.018              </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>ses               0.140  0.019  0.163       </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>mathkind         -0.978 -0.031  0.163 -0.168</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min          Q1         Med          Q3         Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-5.82574352 -0.61102781 -0.03366662  0.55380954  4.26781224</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 1190</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups:</span></span></span>
<span class="syntax--text syntax--plain"><span>             </span><span class="syntax--meta syntax--paragraph syntax--text"><span>schoolid classid %in% schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>                  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>107                   312</span></span></span>
</pre>
<p>Si analizamos los resultados y los comparamos con los obtenidos para el modelo de componentes de varianzas, podemos observar que la varianza residual ha disminuido, al igual que los índices AIC y BIC. Utilicemos ahora un LRT para evaluar las siguientes hipótesis:</p>
<span class="math"><script type="math/tex; mode=display">
\begin{equation}
\begin{gathered}
H_0:~\beta_1=\beta_2=\beta_3=\beta_4=0 \\

H_1:~Algún~\beta_i\neq 0~con ~ i\in\{1,2,3,4\}
\end{gathered}

\label{EC30}
\tag{30}
\end{equation}
</script></span>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; stat&lt;- (-2*logLik(varCompModel, REML=FALSE)+2*logLik(FEL1Model, REML=FALSE))[1]</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; pval&lt;- pchisq(stat,df=4,lower.tail=FALSE)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; pval</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>#  4.855231e-81</span></span></span>
</pre>
<p><strong>Ejercicio</strong>: Plantee las pruebas de hipótesis para evaluar los coeficientes del modelo asociados a cada una de las covariables de nivel 1 en forma individual y discuta los resultados de dichas pruebas.</p>
<p>Hay evidencias significativas suficientes para rechazar la <span class="math"><script type="math/tex">H_0</script></span>, por lo que asumimos como adecuado el modelo de efectos fijos dado por la <a href="EC29">Ecuación 29</a>.</p>
<h4>3.2.3 Modelo con covariables de nivel 1 y nivel 2</h4>
<p>En esta etapa debemos añadir los efectos fijos asociados a las covariables medidas en el nivel 2, es decir sobre los cursos. Tenemos tres variables en este nivel: <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">yearstea</code>, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">mathprep</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">mathknow</code>, las cuales utilizaremos para explicar parte de la variabilidad de la respuesta debida a la variabilidad entre cursos. La ecuación de este modelo es:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
y_{ijk}=\beta_0+\beta_{0jk}+\beta_1*sex_{ijk}+\beta_2*minority_{ijk}+\beta_3*ses_{ijk}+\beta_4*mathkind_{ijk}+\beta_5*yearstea_{jk}+\beta_6*mathprep_{jk}+\beta_7*mathknow_{jk}+\epsilon_{ijk}+u_{j|k}+u_k\\
 \epsilon_{ijk} \sim N(0, \sigma^2), ~u_{j|k}\sim N(0, \sigma^2_{uc})~u_k, \sim N(0, \sigma^2_{us})
\end{gathered}
\label{EC31}
\tag{31}
\end{equation}
</script></span>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; FEL12Model&lt;-lme(mathgain~minority+ses+mathkind+sex+yearstea+mathprep+mathknow, random=~1|schoolid/classid, data=SIIdata, na.action="na.omit", method="REML")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(FEL12Model)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: SIIdata</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>AIC      BIC    logLik</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>10335 10389.76 -5156.499</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:    8.671285</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | classid %in% schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept) Residual</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:    9.310153 26.71766</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects: mathgain ~ minority + ses + mathkind + sex + yearstea + mathprep +      mathknow</span></span></span>
<span class="syntax--text syntax--plain"><span>                     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Value Std.Error  DF    t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)      282.02452 11.701687 792  24.101185  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>minorityMnrt=Yes  -7.86886  2.418081 792  -3.254177  0.0012</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>ses                5.41925  1.275995 792   4.247078  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>mathkind          -0.47501  0.022747 792 -20.882471  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexF              -1.33950  1.718580 792  -0.779423  0.4360</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>yearstea           0.03974  0.117070 177   0.339435  0.7347</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>mathprep           1.09485  1.148493 177   0.953296  0.3417</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>mathknow           1.91448  1.147015 177   1.669094  0.0969</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Correlation:</span></span></span>
<span class="syntax--text syntax--plain"><span>                 </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intr) mnrM=Y ses    mthknd sexF   yearst mthprp</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>minorityMnrt=Yes -0.302                                          </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>ses               0.121  0.159                                   </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>mathkind         -0.943  0.166 -0.163                            </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexF             -0.069 -0.015  0.020 -0.005                     </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>yearstea         -0.092  0.040 -0.033  0.005  0.015              </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>mathprep         -0.283  0.017  0.043  0.052 -0.002 -0.168       </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>mathknow         -0.049  0.146 -0.015  0.029  0.007  0.015  0.004</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min         Q1        Med         Q3        Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-3.3989531 -0.6289628 -0.0413954  0.5564112  4.3029072</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 1081</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups:</span></span></span>
<span class="syntax--text syntax--plain"><span>             </span><span class="syntax--meta syntax--paragraph syntax--text"><span>schoolid classid %in% schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>                  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>105                   285</span></span></span>
</pre>
<p>Cabe destacar que hay algunas observaciones que presentan datos faltantes, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">NAs</code>, que son omitidos a la hora de realizar los ajustes (<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">na.action="na.omit"</code>). Esto determina que los modelos dados por las Ecuaciones <a href="EC29">29</a> y <a href="EC31">31</a> no se puedan comparar mediante un LRT ya que se construyeron sobre diferentes conjuntos de datos. Por tal motivo, utilizaremos los resultados de las pruebas-t sobre los efectos fijos del modelo asociados a las covariables de nivel 2 para determinar cuál/cuáles de los coeficientes son significativamente distintos de 0. En función de los resultados obtenidos, decidimos descartar los tres coeficientes asociados a las variables de nivel 2, ya que, a un nivel <span class="math"><script type="math/tex">\alpha=0.05</script></span>, ninguno de los valores-p de dichas pruebas resultó significativo.</p>
<p><strong>Ejercicio</strong>: Defina un nuevo conjunto de datos, compuesto de aquellas observaciones que esten completas y realice los ajustes y pruenas de hipótesis correspondientes. Analice los resultados.</p>
<h4>3.2.4 Modelo con covariables de nivel 1 y nivel 3</h4>
<p>Al modelo resultante de la sección anterior, en este caso el modelo con las covariables de nivel 1, le añadiremos las covariables de nivel 3, es decir, medidas sobre las escuelas. En esta base de datos sólo se tiene una covariable medida sobre las escuelas, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">housepov</code>. La ecuación del modelo que incluye esta covariable es:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
y_{ijk}=\beta_0+\beta_{0jk}+\beta_1*sex_{ijk}+\beta_2*minority_{ijk}+\beta_3*ses_{ijk}+\beta_4*mathkind_{ijk}+\beta_5*housepov_{k}+\epsilon_{ijk}+u_{j|k}+u_k\\
 \epsilon_{ijk} \sim N(0, \sigma^2), ~u_{j|k}\sim N(0, \sigma^2_{uc})~u_k, \sim N(0, \sigma^2_{us})
\end{gathered}
\label{EC32}
\tag{32}
\end{equation}
</script></span>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; FEL13Model&lt;-lme(mathgain~sex+minority+ses+mathkind+housepov, random=~1|schoolid/classid, data=SIIdata, method="REML", na.action = "na.omit")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(FEL13Model)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: SIIdata</span></span></span>
<span class="syntax--text syntax--plain"><span>       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>AIC      BIC    logLik</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>11396.06 11441.75 -5689.029</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:    8.818243</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | classid %in% schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept) Residual</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:    9.030822 27.10018</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects: mathgain ~ sex + minority + ses + mathkind + housepov</span></span></span>
<span class="syntax--text syntax--plain"><span>                     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Value Std.Error  DF    t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)      285.05800 11.020766 874  25.865534  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexF              -1.23460  1.657434 874  -0.744884  0.4565</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>minorityMnrt=Yes  -7.75588  2.384993 874  -3.251950  0.0012</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>ses                5.23971  1.244971 874   4.208703  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>mathkind          -0.47086  0.022281 874 -21.132931  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>housepov         -11.43923  9.937384 105  -1.151131  0.2523</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Correlation:</span></span></span>
<span class="syntax--text syntax--plain"><span>                 </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intr) sexF   mnrM=Y ses    mthknd</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sexF             -0.042                            </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>minorityMnrt=Yes -0.265 -0.015                     </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>ses               0.123  0.019  0.144              </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>mathkind         -0.969 -0.032  0.153 -0.165       </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>housepov         -0.173 -0.009 -0.184  0.078  0.035</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min          Q1         Med          Q3         Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-5.79254947 -0.60523530 -0.03270737  0.55242345  4.27266338</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 1190</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups:</span></span></span>
<span class="syntax--text syntax--plain"><span>             </span><span class="syntax--meta syntax--paragraph syntax--text"><span>schoolid classid %in% schoolid</span></span></span>
<span class="syntax--text syntax--plain"><span>                  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>107                   312</span></span></span>
</pre>
<p>Utilicemos ahora un LRT para evaluar si es significativa la incorporación de este efecto al modelo, es decir <span class="math"><script type="math/tex">H_0:~\beta_5=0</script></span> vs. <span class="math"><script type="math/tex">H_1:~\beta_5\neq 0</script></span>. Recordemos que, como evaluamos efectos fijos, debemos tener en cuenta las estimaciones por máxima verosimilitud.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; FEL1ModelLM&lt;-lme(mathgain~sex+minority+ses+mathkind, random=~1|schoolid/classid,data=SIIdata, method="ML")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; FEL13ModelLM&lt;-lme(mathgain~sex+minority+ses+mathkind+housepov,random=~1|schoolid/classid, data=SIIdata, method="ML")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova(FEL13ModelLM, FEL1ModelLM)</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Model df      AIC      BIC    logLik   Test  L.Ratio p-value</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>FEL13ModelLM     1  9 11407.64 11453.38 -5694.822                        </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> FEL1ModelLM      2  8 11406.96 11447.62 -5695.481 1 vs 2 1.318652  0.2508</span></span></span>
</pre>
<p>Los resultados de la prueban indican que no hay evidencia suficiente para rechazar la hipótesis nula, por lo que la asumimos como verdadera. Por lo tanto, el modelo que hemos encontrado adecuado para nuestros datos es el dado por la <a href="EC29">Ecuación 29</a>.</p>
<h4>3.2.5 Verificación de los supuestos del modelo</h4>
<p>Al considerar un MLM debemos explorar si se cumplen los supuestos de normalidad y homocedasticidad tanto de los residuos como de los efectos aleatorios. También debe verificarse la independencia entre ellos. Analicemos primero los efectos aleatorios, particularmente, consideremos la Prueba de Shapiro-Wilks para evaluar la normalidad:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; EBLUPs&lt;-ranef(FEL1Model)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; shapiro.test(EBLUPs[[1]][,1])</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span>	</span><span class="syntax--meta syntax--paragraph syntax--text"><span>Shapiro-Wilk normality test</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>data:  EBLUPs[[1]][, 1]</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>W = 0.99357, p-value = 0.9004</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; shapiro.test(EBLUPs[[2]][,1])</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span>	</span><span class="syntax--meta syntax--paragraph syntax--text"><span>Shapiro-Wilk normality test</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>data:  EBLUPs[[2]][, 1]</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>W = 0.99596, p-value = 0.6076</span></span></span>
</pre>
<p>Como se puede apreciar, la distribución de los efectos aleatorios se puede asumir normal.</p>
<p><strong>Ejercicio</strong>: Estudie la independencia entre los EBLUPs y los residuos del modelo.</p>
<p>Exploremos ahora los residuos del modelo. Construyamos su QQ-plot, considerando los residuos en su forma estandarizados, y el diagrama de dispersión de residuos y valores predichos o ajustados.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; PearsonRes&lt;-resid(FEL1Model, type="pearson")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; fittedValues&lt;-fitted(FEL1Model)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; df&lt;-data.frame(PearsonRes, fittedValues)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; a&lt;-ggplot(df, aes(sample=PearsonRes))+geom_qq(color="blue", alpha=0.7)+geom_abline(slope=1, intercept=0)+labs(y="Residuos de Pearson", x="Valores teóricos")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; b&lt;-ggplot(df, aes(x=fittedValues,y=PearsonRes))+geom_point(color="blue", alpha=0.7)+geom_hline(yintercept = 0)+labs(y="Residuos de Pearson", x="Valores ajustados")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; library(cowplot)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; plot_grid(a,b, nrow=1, labels=c("A", "B"), rel_widths = c(0.8, 1.2))</span></span></span>
</pre>
<p><img src="../Imagenes/ClassResidPlots.png" alt="Figura5"></p>
<p><em><strong>Figura 5</strong></em>: Gráficos diagnósticos sobre los residuos del modelo lineal mixto para el conjunto de datos <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">SIIdata</code> <strong>A)</strong> QQ-plot de los residuos de Pearson. <strong>B)</strong> Diagrama de dispersión residuos de Pearson vs. valores ajustados.</p>
<p>Si analizamos el QQ-plot mostrado en la <a href="Figura5">Figura 5A</a>, es posible apreciar una desviación de la distribución teórica ideal en los extremos. Ésto sugiere una distribución de los residuos con colas largas tanto a la derecha como por la izquierda. Los puntos causantes de estas desviaciones no son muchos, y están equilibrados en ambas colas. Esto sugiere que debemos revisar las observaciones que irrumpen la normalidad.</p>
<p>Si analizamos ahora el diagrama de dispersión de los residuos de Pearson vs los valores ajustados de la variable respuesta (<a href="Figura5">Figura 5B</a>) podemos notar que los residuos no cumplen con el principio de homocedasticidad, ya que pareciera que a medida que la respuesta aumenta, también lo hace la variabilidad de los residuos. Este gráfico sugiere que el modelo puede estar mal especificado, es posible que se hayan omitido ciertas covariables o interacciones de éstas que permitan explicar mejor la variable respuesta, fundamentalmente para los valores mayores.</p>
<p><strong>Ejercicio</strong>: Explore la relación entre las variables predictoras y la respuesta, y la distribución de la variable respuesta y discuta acerca de la validez o no del modelo.</p>
<h2>4. Modelo para datos con medidas repetidas</h2>
<p>Ahora analizaremos datos con <em>medidas repetidas</em>, es decir, que consideran múltiples mediciones de la variable respuesta en los mismos sujetos ante diferentes condiciones experimentales. Los datos con medidas repetidas pueden considerarse datos agrupados a dos niveles donde el nivel a lo representan las medidas y el nivel 2 los sujetos sonre los que se toman dichas medidas. Las covariables medidas a nivel de los sujetos describen la variabilidad entre sujetos mientras que las medidas a nivel 1 describen la variabilidad intra sujetos.</p>
<h3>4.1 Descripción del conjunto de datos</h3>
<p>Para ilustrar este tipo de modelos vamos a considerar un conjunto de datos obtenido mediante un estudio experimental sobre ratas reportado por Douglas et al. (2004). El objetivo del experimento fue determinar la activación de nucleótidos (guanina) en siete regiones del cerebro en cinco ratas macho adultas. La activación de nucleótidos basal, medida luego del tratamiento con solución salina, se comparó con la activación de la misma región luego del tratamiento con la droga Carbacol. La activación se midió como la densidad óptica media producida por autoradiografía. En este ejemplo consideraremos tres de las siete regiones cerebralas originalmente analizadas: el núcleo del lecho de la estría terminal (<em>bed nucleus of the stria terminalis, BST</em>), el septum lateral (<em>lateral septum, LS</em>), y la banda diagonal de Broca (<em>diagonal band of Broca, VDB</em>). Cabe destacar que las regiones del cerebro y los tratamientos son factores que están cruzados dentro de los sujetos y que, para este ejemplo, no se han considerado las variables medidas en los sujetos (peso, edad, etc.). En este estudio se realizaron medidas en las mismas regiones cerebrales para los mismos tratamientos dentro de cada rata.</p>
<p>Comencemos cargando el conjunto de datos, el cual está disponible en el paquete <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">R</code> <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">WWGbook</code>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; data("rat.brain", package="WWGbook")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; head(rat.brain)</span></span></span>
<span class="syntax--text syntax--plain"><span>   </span><span class="syntax--meta syntax--paragraph syntax--text"><span>animal   treatment region activate</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>1 R111097         1      1   366.19</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 2 R111097         1      2   199.31</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 3 R111097         1      3   187.11</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 4 R111097         2      1   371.71</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 5 R111097         2      2   302.02</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 6 R111097         2      3   449.70</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(rat.brain)</span></span></span>
<span class="syntax--text syntax--plain"><span>     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>animal    treatment       region     activate    </span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>R100797:6   Min.   :1.0   Min.   :1   Min.   :179.4  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> R100997:6   1st Qu.:1.0   1st Qu.:1   1st Qu.:261.4  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> R110597:6   Median :1.5   Median :2   Median :406.6  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> R111097:6   Mean   :1.5   Mean   :2   Mean   :402.1  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> R111397:6   3rd Qu.:2.0   3rd Qu.:3   3rd Qu.:493.6  </span></span></span>
<span class="syntax--text syntax--plain"><span>             </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Max.   :2.0   Max.   :3   Max.   :727.0</span></span></span>
</pre>
<p>El conjunto de datos que utilizaremos como ejemplo ilustrativo, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">rat.brain</code>, contiene cuatro variables, todas con datos completos. Algo que debemos considerar es que las variables <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">treatment</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">region</code> que debería representar los dos niveles de tratamiento y las tres regiones cerebrales exploradas son del tipo numéricas, por lo que, antes de cualquier análisis debemos transformarlas a variables del tipo categóricas. El órden en que se han listado las variables es el presentado anteriormente, por lo que sólo debemos definir dichas columnas como del tipo <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">factor</code> y asignar los nombres correspondientes a sus niveles.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; rat.brain$treatment&lt;-as.factor(rat.brain$treatment)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; levels(rat.brain$treatment)&lt;-c("Basal", "Carb")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; rat.brain$region&lt;-as.factor(rat.brain$region)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; levels(rat.brain$region)&lt;-c("BST", "LS", "VDB")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(rat.brain)</span></span></span>
<span class="syntax--text syntax--plain"><span>   </span><span class="syntax--meta syntax--paragraph syntax--text"><span>animal   treatment   region      activate    </span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>R100797:6   Basal:15   BST:10   Min.   :179.4  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> R100997:6   Carb :15   LS :10   1st Qu.:261.4  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> R110597:6              VDB:10   Median :406.6  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> R111097:6                       Mean   :402.1  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> R111397:6                       3rd Qu.:493.6  </span></span></span>
<span class="syntax--text syntax--plain"><span>                                 </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Max.   :727.0</span></span></span>
</pre>
<p>Exploremos el comportamiento de la variable respuesta en las distintas condiciones experimentales. Para ello utilizaremos la librería <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">dplyr</code>, altamente recomendada para la manipulación de bases de datos.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; library(dplyr)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; rat.brain %&gt;% group_by(treatment, region) %&gt;%  summarise(avgActiv=mean(activate), sdActiv=sd(activate))</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span># A tibble: 6 x 4</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> # Groups:   treatment [?]</span></span></span>
<span class="syntax--text syntax--plain"><span>   </span><span class="syntax--meta syntax--paragraph syntax--text"><span>treatment region avgActiv sdActiv</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>   &lt;fct&gt;     &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>1 Basal     BST        429.    53.3</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 2 Basal     LS         238.    34.7</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 3 Basal     VDB        212.    35.7</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 4 Carb      BST        527.   110.</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 5 Carb      LS         435.   112.</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> 6 Carb      VDB        572.   117.</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; ggplot(rat.brain, aes(x=region, y=activate, color=animal, group=animal))+geom_point()+geom_line()+facet_wrap(~treatment)+labs(x="Región", y="Activación", color="Animal")+theme(legend.position="bottom")</span></span></span>
</pre>
<p><img src="../Imagenes/exploRat.png" alt="Figura6"></p>
<p><strong>Figura 6</strong>: Diagrama de punto y línea de la activación medida en tres regiones cerebrales de sujetos del grupo basal y del grupo tratado con Carbacol (Carb).</p>
<p>La exploración de la variable respuesta en cada una de las combinaciones tratamiento-región revela que la media muestral de los grupos tratados con Carbacol es mayor que la de los respectivos grupos basales. Analizando la <a href="Figura6">Figura 6</a> también se evidencian diferencias en la activación entre las distintas regiones evaluadas. Particularmente, la región <em>BST</em> es la que presenta mayores valores de activación en la condición basal, mientras que la región <em>VDB</em> presenta, en la mayoría de las ratas, mayor activación luego del tratamiento con Carbacol. Estas observaciones sugieren que los efectos <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">treatment</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">region</code> así como la interacción entre éstos deben formar parte del modelo. El análisis de la <a href="Figura6">Figura 6</a> también permite apreciar la variabilidad existente entre los sujetos, fundamentalmente en el grupo tratado con Carbacol, lo que sugiere no sólo la inclusión de un intercepto aleatorio al modelo, sino además la presencia de un intercepto aleatorio diferente para cada grupo tratado.</p>
<h3>4.2 Ajuste de modelos estadísticos</h3>
<p>Para construir el modelo vamos a seguir la estrategia <em>top-down</em>.</p>
<h4>4.2.1 Modelo maximal en efectos fijos</h4>
<p>El primer modelo que ajustaremos tiene los efectos <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">region</code>, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">treatment</code> y su interacción, además del efecto aleatorio que modela la correlación entre las medidas de un mismo animal.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
y_{ijk}=\mu_{0}+u_{0i}+\alpha_j+\beta_k+\delta_{jk}+\epsilon_{ijk},~\epsilon_{ijk} \sim N(0, \sigma^2),~u_{0i} \sim N(0, \sigma^2_{ui})
\end{gathered}
\label{EC33}
\tag{33}

\end{equation}
</script></span>
<p>donde <span class="math"><script type="math/tex">\mu_0</script></span> representa la media general de activación, <span class="math"><script type="math/tex">u_i</script></span> es el efecto aleatorio debido al i-ésimo animal, <span class="math"><script type="math/tex">\alpha_j</script></span> el efecto del j-ésimo tratamiento, <span class="math"><script type="math/tex">\beta_k</script></span> refiere al
efecto de la k-ésima región y <span class="math"><script type="math/tex">\delta_{jk}</script></span> representa el efecto de la interacción del j-ésimo tratamiento con la k-ésima región cerebral. Además, $\epsilon_{ijk} representa los residuos del modelo, los cuales se asumen independientes y de igual varianza a lo largo de las regiones y los tratemientos.</p>
<p>El ajuste del modelo dado por la <a href="EC33">Ecuación 33</a> usando el paquete <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code> es:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; maximalModel&lt;-lme(activate~treatment+region+treatment:region, random=~1|animal,  method="REML", data=rat.brain)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(maximalModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># Data: rat.brain</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># AIC      BIC    logLik</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># 291.2822 300.7066 -137.6411</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>#</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>#     Formula: ~1 | animal</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># (Intercept) Residual</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># StdDev:    69.64057 49.50045</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>#</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># Fixed effects: activate ~ treatment + region + treatment:region</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>#                            Value Std.Error DF   t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># (Intercept)              428.506  38.21022 20 11.214435  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># treatmentCarb             98.204  31.30684 20  3.136823  0.0052</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># regionLS                -190.762  31.30684 20 -6.093302  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># regionVDB               -216.212  31.30684 20 -6.906223  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># treatmentCarb:regionLS    99.322  44.27455 20  2.243320  0.0364</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># treatmentCarb:regionVDB  261.822  44.27455 20  5.913600  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># Correlation:</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>#     (Intr) trtmnC regnLS rgnVDB trC:LS</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># treatmentCarb           -0.410                            </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># regionLS                -0.410  0.500                     </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># regionVDB               -0.410  0.500  0.500              </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># treatmentCarb:regionLS   0.290 -0.707 -0.707 -0.354       </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># treatmentCarb:regionVDB  0.290 -0.707 -0.354 -0.707  0.500</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>#</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>#     Min          Q1         Med          Q3         Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># -1.46425392 -0.57621824  0.08020306  0.40718428  1.55091562</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>#</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># Number of Observations: 30</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># Number of Groups: 5</span></span></span>
</pre>
<p><strong>Ejercicio</strong>: Analice los resultados del modelo en términos de ICC, significancia de los efectos.</p>
<p>Para analizar si este modelo es adecuado vamos a utilizar los resultados de las pruebas <em>F</em> sobre los distintos efectos que se obtienen mediante la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">anova</code> del paquete <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>anova(maximalModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># numDF denDF   F-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># (Intercept)          1    20 153.77636  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># treatment            1    20 146.24632  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># region               2    20  20.60935  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># treatment:region     2    20  17.82470  &lt;.0001</span></span></span>
</pre>
<p>Los resultados de las pruebas <em>F</em> indican que los términos del modelo son significativos (<span class="math"><script type="math/tex">\alpha=0.05</script></span>), por lo que decidimos conservarlos.</p>
<h4>4.2.2 Selección de la estructura de los efectos aleatorios.</h4>
<p>El diseño experimental determina la existencia de correlación entre las medidas de activación de cada sujeto, por lo que, debe incluirse un efecto aleatorio asociado al sujeto que refleje dicho diseño.</p>
<p><strong>Ejercicio</strong>: Construya la prueba de hipótesis que evalúe si es significativa la inclusión del efecto aleatorio y obtenga sus resultados en <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">R</code>.</p>
<p>Ahora bien, en la <a href="Figura6">Figura 6</a> encontramos que la variabilidad entre los sujetos parecía ser mayor para el tratamiento con Carbacol que para el Basal, lo que nos hace sospechar que quizás sea necesario el uso de efectos aleatorios diferentes para cada tratamiento. Para ello, proponemos entonces el MLM dado por la <a href="EC34">Ecuación 34</a>.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
y_{ijk}=\mu_{0}+u_{0i}+u_{ij}+\alpha_j+\beta_k+\delta_{jk}+\epsilon_{ijk},~\epsilon_{ijk} \sim N(0, \sigma^2),~(u_{0i},u_{ij}) \sim N(0, \boldsymbol{R}_i)
\end{gathered}
\label{EC34}
\tag{34}

\end{equation}
</script></span>
<p>En este modelo, el efecto aleatorio <span class="math"><script type="math/tex">u_{ij}</script></span> esta asociado al efecto aleatorio del j-ésimo tratamiento sobre las mediciones del i-ésimo animal. De manera que, la matriz de varianzas y covarianzas <span class="math"><script type="math/tex">\boldsymbol{R}</script></span> ahora tiene en su diagonal principal la varianzas correspondiente al efecto individuo y la varianza asociada al efecto del tratamiento, <span class="math"><script type="math/tex">\sigma_{uT}^2</script></span>, y fuera de dicha diagonal, incorpora la covarianza entre los dos efectos aleatorios, $\sigma^2_{ui,uT}.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; randTreatModel&lt;-lme(activate~treatment+region+treatment:region, random=~treatment-1|animal, method="REML", data=rat.brain)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(randTreatModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: rat.brain</span></span></span>
<span class="syntax--text syntax--plain"><span>       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>AIC     BIC    logLik</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>269.1904 280.971 -124.5952</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~treatment | animal</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Structure: General positive-definite, Log-Cholesky parametrization</span></span></span>
<span class="syntax--text syntax--plain"><span>              </span><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev   Corr  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)   35.83696 (Intr)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb 79.82012 0.801</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Residual      23.21432       </span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects: activate ~ treatment + region + treatment:region</span></span></span>
<span class="syntax--text syntax--plain"><span>                           </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Value Std.Error DF    t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)              428.506  19.09551 20  22.440145  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb             98.204  38.59808 20   2.544271  0.0193</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>regionLS                -190.762  14.68203 20 -12.992892  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>regionVDB               -216.212  14.68203 20 -14.726304  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb:regionLS    99.322  20.76352 20   4.783485  0.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb:regionVDB  261.822  20.76352 20  12.609710  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Correlation:</span></span></span>
<span class="syntax--text syntax--plain"><span>                        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intr) trtmnC regnLS rgnVDB trC:LS</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb            0.476                            </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>regionLS                -0.384  0.190                     </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>regionVDB               -0.384  0.190  0.500              </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb:regionLS   0.272 -0.269 -0.707 -0.354       </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb:regionVDB  0.272 -0.269 -0.354 -0.707  0.500</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>         </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min           Q1          Med           Q3          Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-1.561096490 -0.403922296 -0.006412947  0.464164074  1.825174931</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 30</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups: 5</span></span></span>
</pre>
<p>La prueba de hipótesis que debemos evaluar para determinar cuál de las dos propuestas es la estructura de efectos aleatorios más adecuada consiste en comparar las dos matrices <span class="math"><script type="math/tex">\boldsymbol{R}</script></span> de los modelos dados por las Ecuaciones <a href="EC33">33</a> y <a href="EC34">34</a>, lo que es equivalente a plantear una hipótesis nula <span class="math"><script type="math/tex">H_0:~\sigma^2_{uT}=0~y~\sigma^2_{ui,uT}=0</script></span>.
Para ello usaremos un LRT, teniendo en cuenta que como evaluamos valores del espacio paramétrico en su frontera, la distribución del estadístico del LRT será una mezcla de dos disitribuciones <span class="math"><script type="math/tex">\chi^2_1</script></span> y <span class="math"><script type="math/tex">\chi^2_2</script></span>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; stat&lt;- (-2*logLik(maximalModel, REML=TRUE)+2*logLik(randTreatModel, REML=TRUE))[1]</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; pval&lt;- mean(pchisq(stat,df=c(1,2),lower.tail=FALSE))</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; pval</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>[1] 1.2423e-06</span></span></span>
</pre>
<p>Los resultados indican que hay evidencias suficientes para rechazar la hipótesis nula, por lo que se asume que las varianzas de los efectos aleatorios son diferentes para los grupos Basal y Carbacol.</p>
<h4>4.2.3 Definición de la estructura de correlación de <strong>R</strong></h4>
<p>En los modelos planteados hasta ahora, los residuos correspondientes a las observaciones del <em>i</em>-ésimo individuo se asumen normalmente distribuídos, es decir:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}

\boldsymbol{\epsilon}_i=\begin{bmatrix} \epsilon_{1i}\\
\epsilon_{2i}\\
\epsilon_{3i}\\
\epsilon_{4i}\\
\epsilon_{5i}\\
\epsilon_{6i}\\
\end{bmatrix} \sim \boldsymbol{N}(0,\sigma^2\boldsymbol{I}_6)

\tag{35}
  \label{EC35}
\end{equation}
</script></span>
<p>donde el órden de las componentes de dicho vector es tal que los primeros tres residuos se asocian con las observaciones del tratamiento basal en <em>BST</em>, <em>LS</em> y <em>VDB</em>, y los últimos residuos lo hacen con las observaciones del tratamiento con Carbacol, en las mismas regiones. Ahora bien, en la <a href="Figura6">Figura 6</a> observamos que la variabilidad en las observaciones asociadas al tratamiento con Carbacol parece ser mayor a las observaciones del tratamiento Basal. En la sección anterior evaluamos si estas diferencias pueden atribuirse a la variabilidad entre sujetos, al considerar un efecto aleatorio asociado al tratamiento además del intercepto aleatorio. Lo que haremos en esta sección es indagar si es adecuado plantear, o no, heterogeneidad en las varianzas residuales de los grupos definidos por el tratamiento, lo que determinaría una estructura de <span class="math"><script type="math/tex">\boldsymbol{R}_i</script></span> dada por la <a href="EC36">Ecuación 36</a>.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}

\boldsymbol{R}_i=\begin{bmatrix} \sigma^2_{Basal}\boldsymbol{I}_3 & 0\\
0 & \sigma^2_{Carb}\boldsymbol{I}_3\\
\end{bmatrix}

\tag{36}
  \label{EC36}
\end{equation}
</script></span>
<p>Lo primero que debemos hacer es ajustar el modelo con los mismos efectos fijos y aleatorios seleccionado en el paso anterior, pero incorporando la estructura de correlación de la matriz de varianzas y covarianzas residual.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; randTreatCorModel&lt;-lme(activate~treatment+region+treatment:region, random=~treatment|animal, weights = varIdent(form=~1|treatment), method="REML", data=rat.brain)</span></span></span>
</pre>
<p>Evaluemos ahora cuál de las estructuras de correlación es más adecuada. La prueba de hipótesis que debemos evaluar tiene como hipótesis nula <span class="math"><script type="math/tex">H_0:~\sigma^2_{Basal}=\sigma^2_{Carb}</script></span> vs <span class="math"><script type="math/tex">H_1:~\sigma^2_{Basal}\neq \sigma^2_{Carb}</script></span>. Planteemos el LRT de los modelos con y sin estructura de correlación mediante la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">anova()</code>:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova(randTreatModel, randTreatCorModel)</span></span></span>
<span class="syntax--text syntax--plain"><span>                  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Model df      AIC      BIC    logLik   Test   L.Ratio p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>randTreatModel        1 10 269.1904 280.9710 -124.5952                         </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>randTreatCorModel     2 11 271.0383 283.9969 -124.5192 1 vs 2 0.1521269  0.6965</span></span></span>
</pre>
<p>Los resultados del LRT entre los dos modelos indican que no hay evidencias suficientes para rechazar la hipótesis nula, por lo que la asumimos como cierta, prefiriendo entonces al modelo de varianzas residuales homogéneas dado por la <a href="EC35"> Ecuación 35</a>.</p>
<h4>4.2.4 Reducción de los efectos fijos del modelo</h4>
<p>Finalmente, analicemos los efectos fijos del modelo para determinar si hay alguno de ellos que no sean significativos.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova(randTreatModel)</span></span></span>
<span class="syntax--text syntax--plain"><span>                 </span><span class="syntax--meta syntax--paragraph syntax--text"><span>numDF denDF   F-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)          1    20 313.79323  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatment            1    20  35.49469  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>region               2    20  93.70669  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatment:region     2    20  81.04544  &lt;.0001</span></span></span>
</pre>
<p>Los resultados de las pruebas <em>F</em> sobre los efectos fijos del modelo indican que todos ellos son significativos, por lo que decidimos que el MLM dado por la <a href="EC35">Ecuación 35</a> es el más adecuado para el conjunto de datos aquí analizados.</p>
<p><strong>Ejercicio</strong>: Discuta que otra prueba podría plantear para evaluar la significancia de los efectos fijos del MLM.</p>
<h4>4.2.5 Análisis del ajuste del modelo</h4>
<p>La <a href="Figura7">Figura 7A</a> presenta el QQ-plot de los residuos de Pearson del MLM. Los residuos parecieran ajustarse a los valores teóricos de una distribución normal estándar, algo que no es tan facil de decidir teniendo en cuenta que se cuenta con 30 observaciones. Los resultados pueden complementarse con la prueba de Shapiro-Wilks sobre los residuos.</p>
<p><img src="../Imagenes/RatThreeResidPlots.png" alt="Figura7"></p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; PearsonRes&lt;-resid(randTreatModel, type="pearson")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; shapiro.test(PearsonRes)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># Shapiro-Wilk normality test</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>#</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># data:  PearsonRes</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># W = 0.97081, p-value = 0.5614</span></span></span>
</pre>
<p>Los resultados de la prueba soportan la hipótesis de normalidad de los residuos del MLM. La <a href="Figura7">Figura7B</a> muestra el diagrama de dispersión de los residuos de Pearson y los valores ajustados por el modelo, con cada observación identificada de un color correspondiente al tratamiento asociado. Como se puede apreciar, la variabilidad de las observaciones es similar entre los dos grupos, lo que soporta la homocedasticidad de los residuos respecto de los tratamientos.</p>
<h4>4.2.6 Análisis de los resultados</h4>
<p>Para el análisis e interpretación de los resultados del modelo utilizaremos algunas de las funciones de los paquetes <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">nlme</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">emmeans</code>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; install.packages("emmeans")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; library(emmeans)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(randTreatModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: rat.brain</span></span></span>
<span class="syntax--text syntax--plain"><span>       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>AIC     BIC    logLik</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>269.1904 280.971 -124.5952</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~treatment | animal</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Structure: General positive-definite, Log-Cholesky parametrization</span></span></span>
<span class="syntax--text syntax--plain"><span>              </span><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev   Corr  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)   35.83696 (Intr)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb 79.82012 0.801</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Residual      23.21432       </span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects: activate ~ treatment + region + treatment:region</span></span></span>
<span class="syntax--text syntax--plain"><span>                           </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Value Std.Error DF    t-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)              428.506  19.09551 20  22.440145  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb             98.204  38.59808 20   2.544271  0.0193</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>regionLS                -190.762  14.68203 20 -12.992892  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>regionVDB               -216.212  14.68203 20 -14.726304  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb:regionLS    99.322  20.76352 20   4.783485  0.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb:regionVDB  261.822  20.76352 20  12.609710  0.0000</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Correlation:</span></span></span>
<span class="syntax--text syntax--plain"><span>                        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intr) trtmnC regnLS rgnVDB trC:LS</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb            0.476                            </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>regionLS                -0.384  0.190                     </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>regionVDB               -0.384  0.190  0.500              </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb:regionLS   0.272 -0.269 -0.707 -0.354       </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb:regionVDB  0.272 -0.269 -0.354 -0.707  0.500</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Standardized Within-Group Residuals:</span></span></span>
<span class="syntax--text syntax--plain"><span>         </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Min           Q1          Med           Q3          Max</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>-1.561096490 -0.403922296 -0.006412947  0.464164074  1.825174931</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 30</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups: 5</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; intervals(randTreatModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Approximate 95% confidence intervals</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Fixed effects:</span></span></span>
<span class="syntax--text syntax--plain"><span>                             </span><span class="syntax--meta syntax--paragraph syntax--text"><span>lower     est.     upper</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)              388.67347  428.506  468.3385</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb             17.68981   98.204  178.7182</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>regionLS                -221.38817 -190.762 -160.1358</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>regionVDB               -246.83817 -216.212 -185.5858</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb:regionLS    56.01005   99.322  142.6339</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb:regionVDB  218.51005  261.822  305.1339</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>attr(,"label")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>[1] "Fixed effects:"</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Random Effects:</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Level: animal</span></span></span>
<span class="syntax--text syntax--plain"><span>                                    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>lower       est.       upper</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sd((Intercept))                16.2424559 35.8369586  79.0697919</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>sd(treatmentCarb)              38.3783865 79.8201157 166.0114313</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>cor((Intercept),treatmentCarb) -0.3466652  0.8009907   0.9882222</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Within-group standard error:</span></span></span>
<span class="syntax--text syntax--plain"><span>   </span><span class="syntax--meta syntax--paragraph syntax--text"><span>lower     est.    upper</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>16.41653 23.21432 32.82697</span></span></span>
</pre>
<p>Particularmente, <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">emmeans</code> es un paquete <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">R</code> útil para explorar y analizar las medias estimadas a partir de modelos ajustados. La función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">emmeans()</code> permite obtener las medias marginales estimadaras para los distintos factores y sus niveles. En este caso, la utilizaremos para obtener la media estimada de activación para cada tratamiento en cada región.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; emmRegTreat&lt;-emmeans(randTreatModel, specs=c("region", "treatment"))</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; emmRegTreat</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>region treatment  emmean       SE df lower.CL upper.CL</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> BST    Basal     428.506 19.09551  4 375.4884 481.5236</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> LS     Basal     237.744 19.09551  4 184.7264 290.7616</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> VDB    Basal     212.294 19.09551  4 159.2764 265.3116</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> BST    Carb      526.710 50.55082  4 386.3584 667.0616</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> LS     Carb      435.270 50.55082  4 294.9184 575.6216</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> VDB    Carb      572.320 50.55082  4 431.9684 712.6716</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Degrees-of-freedom method: containment</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Confidence level used: 0.95</span></span></span>
</pre>
<p>Los resultados del modelo ajutado indican que la media de activación estimada luego del tratamiento con solución salina (Basal), es de 428,506 en la región BST, 237,744 en la región LS y 212,294 en la región VDB. En el caso del tratamiento con Carbacol, los valores estimados para la media de activación en las distintas regiones fueron: 526,71 para la región BST, 435,27 para LS y 572,32 para la región BDV. COn el objetivo de comparar los niveles medios de activación por región y por tratamiento, utilzaremos la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">contrast()</code></p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; contrast(emmRegTreat, method = "pairwise", by="region")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>region = BST:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>contrast     estimate       SE df t.ratio p.value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Basal - Carb  -98.204 38.59808 20  -2.544  0.0193</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>region = LS:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>contrast     estimate       SE df t.ratio p.value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Basal - Carb -197.526 38.59808 20  -5.118  0.0001</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>region = VDB:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>contrast     estimate       SE df t.ratio p.value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Basal - Carb -360.026 38.59808 20  -9.328  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; contrast(emmRegTreat, method = "pairwise", by="treatment")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> treatment = Basal:</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> contrast  estimate       SE df t.ratio p.value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> BST - LS   190.762 14.68203 20  12.993  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> BST - VDB  216.212 14.68203 20  14.726  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> LS - VDB    25.450 14.68203 20   1.733  0.2177</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatment = Carb:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>contrast  estimate       SE df t.ratio p.value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> BST - LS    91.440 14.68203 20   6.228  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> BST - VDB  -45.610 14.68203 20  -3.107  0.0147</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> LS - VDB  -137.050 14.68203 20  -9.335  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>P value adjustment: tukey method for comparing a family of 3 estimates</span></span></span>
</pre>
<p>Los resultados obtenidos indican, por un lado, que el tratamiento con Carbacol determinó mayores niveles de activación en cada una de las regiones analizadas. Por otro lado, en el caso del tratamiento Basal, se encontraron diferencias siginificativas al comparar las medias de activación de las regiones BST y LS y BST con VDB. En ambos casos, la activación resultó mayor en la región BST. Por el contrario,entre las regions LS y VDB no se encontró evidencia suficiente para suponer que la activación promedio, bajo tratamiento basal, sea diferente entre ellas. En el caso del tratamiento con Carbacol, todas las comparaciones de medias estimadas en las regiones resultaron significativas, evidenciando mayores valores de activación ante dicho tratamiento en la región VDB y menores valores de activación en la región LS.</p>
<p>Exploremos las varianzas estimadas para los efectos fijos y residual.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>getVarCov(randTreatModel)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects variance covariance matrix</span></span></span>
<span class="syntax--text syntax--plain"><span>              </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept) treatmentCarb</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)        1284.3        2291.2</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentCarb      2291.2        6371.3</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Standard Deviations: 35.837 79.82</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; getVarCov(randTreatModel, type="conditional")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>animal R111097</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Conditional variance covariance matrix</span></span></span>
<span class="syntax--text syntax--plain"><span>      </span><span class="syntax--meta syntax--paragraph syntax--text"><span>1     2     3     4     5     6</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1 538.9   0.0   0.0   0.0   0.0   0.0</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>2   0.0 538.9   0.0   0.0   0.0   0.0</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>3   0.0   0.0 538.9   0.0   0.0   0.0</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>4   0.0   0.0   0.0 538.9   0.0   0.0</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>5   0.0   0.0   0.0   0.0 538.9   0.0</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>6   0.0   0.0   0.0   0.0   0.0 538.9</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Standard Deviations: 23.214 23.214 23.214 23.214 23.214 23.214</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; getVarCov(randTreatModel, type="marginal")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>animal R111097</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Marginal variance covariance matrix</span></span></span>
<span class="syntax--text syntax--plain"><span>       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>1      2      3       4       5       6</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1 1823.2 1284.3 1284.3  3575.5  3575.5  3575.5</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>2 1284.3 1823.2 1284.3  3575.5  3575.5  3575.5</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>3 1284.3 1284.3 1823.2  3575.5  3575.5  3575.5</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>4 3575.5 3575.5 3575.5 12777.0 12238.0 12238.0</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>5 3575.5 3575.5 3575.5 12238.0 12777.0 12238.0</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>6 3575.5 3575.5 3575.5 12238.0 12238.0 12777.0</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Standard Deviations: 42.699 42.699 42.699 113.04 113.04 113.04</span></span></span>
</pre>
<p>Como lo sospechamos inicialmente, la variabilidad entre los sujetos resultó mayor para las observaciones asociadas al grupo tratado con Carbacol que las asociadas al tratamiento Basal. Adicionalmente, la covarianza entre las medidas de los dos grupos tratados es elevada (2291,2), lo cual es consistente con el hecho de que estamos analizando medidas repetidas.</p>
<h2>5. Modelo para datos longitudinales</h2>
<p>Como dijimos anteriormente, los datos longitudinales son un tipo de datos con medidas repetidas. Particularmente, los estudios longitudinales miden la variable respuesta en un conjunto de sujetos en diferentes momentos de tiempo, definidos en el diseño del experimento.</p>
<h3>5.1 Descripción del conjunto de datos</h3>
<p>La depresión es uno de los problemas de salud pública más frecuentes en todo el mundo. Los tratamientos generalmente involucran el uso de antidepresivos, aunque muchos pacientes no responden a ellos o prefieren no tomarlos. Una alternativa a ellos es la psicoterapia y los tratamientos modernos, como la <em>terapia del comportamiento cognitivo</em> (<em>Cognitive Behavioural Therapy, CBT</em>), los cuales han demostrado ser efectivos más aún en casos de recaída. Entre las distintas alternativas derivadas de la <em>CBT</em>, se han desarrollado propuestas interactivas basadas en elementos multimedia e informáticos. Los datos usados en este ejemplo pertenecen a un ensayo clínico de un programa multimedia llamado <em>Beat the Blues</em>, diseñado para desarrollar <em>CBT</em> en pacientes depresivos por medio de computadoras. Particularmente, <em>Beat the Blues</em> es un programa interactivo basado en técnicas multimedias (audios, videos, etc.). La intervención con la computadora consiste de nueve sesiones, luego le siguen 8 sesiones terapéuticas, de aproximadamente 50 minutos. Cada paciente recibe una explicación breve (menos de 5 minutos), por parte de enfermeros, de cómo usar el programa y luego simplemente interactúan con la computadora. El ensayo clínico involucró un conjunto de pacientes que fueron aleatoriamente asignados a recibir el tratamiento con el programa <em>Beat the Blues</em> (BtB) o el tratamiento usual (TAU). Los pacientes asignados al tratamiento con el programa <em>Beat the Blues</em> también recibieron soporte farmacológico y ayuda práctica o social, ofrecida como parte del tratamiento usual, con excepción de cualquier asesoramiento o intervención psicológica presencial. Los pacientes asignados a TAU recibieron el tratamiento prescripto por su médico de cabecera, lo que comprende, además de cualquier medicación, discusión de problemas, provisión de ayuda práctica/social, derivación a un consejero, a una enfermera practicante o a  profesionales de la salud mental (psicólogo, psiquiatra, enfermera psiquiátrica comunitaria), o un examen físico adicional. Durante el ensayo se registraron varias variables de respuesta, aquí nos concentraremos en el Inventario de Depresión de Beck II (<em>BDI</em>). Esta variable se registró cinco veces en cada paciente de un grupo de 100 sujetos: Antes del tratamiento, dos meses después de iniciar el tratamiento y a uno, tres y seis meses de seguimiento (tres, cinco y ocho meses luego de iniciado el tratamiento). Además de evaluar los efectos de cada tratamiento, también es de interés determinar el efecto de tomar o no antidepresivos y de la longitud del episodio de depresión.</p>
<p>El conjunto de datos sobre el que trabajaremos está disponible en el paquete <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">HSAUR2</code>, bajo el nombre <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">BtheB</code>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; data("BtheB", package="HSAUR2")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; head(BtheB)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>drug length treatment bdi.pre bdi.2m bdi.3m bdi.5m bdi.8m</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1   No    &gt;6m       TAU      29      2      2     NA     NA</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>2  Yes    &gt;6m     BtheB      32     16     24     17     20</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>3  Yes    &lt;6m       TAU      25     20     NA     NA     NA</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>4   No    &gt;6m     BtheB      21     17     16     10      9</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>5  Yes    &gt;6m     BtheB      26     23     NA     NA     NA</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>6  Yes    &lt;6m     BtheB       7      0      0      0      0</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; summary(BtheB)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>drug    length   treatment     bdi.pre          bdi.2m          bdi.3m          bdi.5m          bdi.8m     </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>No :56   &lt;6m:49   TAU  :48   Min.   : 2.00   Min.   : 0.00   Min.   : 0.00   Min.   : 0.00   Min.   : 0.00  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Yes:44   &gt;6m:51   BtheB:52   1st Qu.:15.00   1st Qu.: 8.00   1st Qu.: 6.00   1st Qu.: 3.00   1st Qu.: 3.00  </span></span></span>
<span class="syntax--text syntax--plain"><span>                             </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Median :22.00   Median :15.00   Median :13.00   Median :10.00   Median :10.50  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>                             Mean   :23.33   Mean   :16.92   Mean   :14.81   Mean   :12.76   Mean   :11.13  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>                             3rd Qu.:30.25   3rd Qu.:23.00   3rd Qu.:20.00   3rd Qu.:20.00   3rd Qu.:15.25  </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>                             Max.   :49.00   Max.   :48.00   Max.   :53.00   Max.   :47.00   Max.   :40.00  </span></span></span>
<span class="syntax--text syntax--plain"><span>                                             </span><span class="syntax--meta syntax--paragraph syntax--text"><span>NA's   :3       NA's   :27      NA's   :42      NA's   :48    </span></span></span>
</pre>
<p>La base de datos está estructurada en lo que se denomina comúnmente <em>formato ancho</em>, en donde las medidas de la variable respuesta en los distintos instantes de tiempos están ubicadas en diferentes columnas. Es por ello que lo primero que haremos será definir un nuevo conjunto de datos con los registros el <em>formato largo</em>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; BtheB$patient &lt;- factor(rownames(BtheB), levels=rownames(BtheB))</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; nobs &lt;- nrow(BtheB)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; BtheB_long &lt;- reshape(BtheB, idvar = "patient", varying = c("bdi.2m", "bdi.3m", "bdi.5m", "bdi.8m"), direction = "long")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; BtheB_long$time &lt;-as.numeric(do.call(c, lapply(BtheB_long$time, function(x){strsplit(x, split="")[[1]][1]})))</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; head(BtheB_long)</span></span></span>
<span class="syntax--text syntax--plain"><span>     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>drug length treatment bdi.pre patient time bdi</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1.2m   No    &gt;6m       TAU      29       1    2   2</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>2.2m  Yes    &gt;6m     BtheB      32       2    2  16</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>3.2m  Yes    &lt;6m       TAU      25       3    2  20</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>4.2m   No    &gt;6m     BtheB      21       4    2  17</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>5.2m  Yes    &gt;6m     BtheB      26       5    2  23</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>6.2m  Yes    &lt;6m     BtheB       7       6    2   0</span></span></span>
</pre>
<p>Exploremos ahora el comportamiento de la variable respuesta frente a las covariables.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; ggplot(BtheB_long,aes(x=as.factor(time), y=bdi))+geom_boxplot()+facet_grid(~treatment)</span></span></span>
</pre>
<p><img src="../Imagenes/boxplotBtB.png" alt="Figura8"></p>
<p><strong>Figura 8</strong>: Diagramas de caja de la variable respuesta, <em>BDI</em>, medida a los 2, 3, 5 y 8 meses de haber iniciado el tratamiento con terapia clásica (<em>TAU</em>) y con el programa interactivo <em>Beat the Blues</em> (BtheB).</p>
<p>La <a href="Figura8">Figura 8</a> explora el efecto del tratamiento sobre la respuesta a lo largo del tiempo. Al parecer, el BDI disminuye a lo largo del tiempo en ambos grupos tratados. Además, pareciera que el BDI del grupo tratado con la terapia convencional es algo menor que el del grupo tratado con <em>Beat the Blues</em>. Ahora bien, esta gráfica no considera que, dentro de cada tratamiento, hay pacientes que recibieron o no fármacos y cuyo episodio depresivo tuvo corta (<span class="math"><script type="math/tex"><6m</script></span>) o larga (<span class="math"><script type="math/tex">>6m</script></span>) duración. Incorporemos estos datos al gráfico y veamos que sucede:</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; ggplot(BtheB_long,aes(x=as.factor(time), y=bdi, fill=treatment))+geom_boxplot()+facet_grid(length~drug)+theme(legend.position = "bottom")+labs(x="Mes", y="BDI", fill="Tratamiento")</span></span></span>
</pre>
<p><img src="../Imagenes/boxplotBtB2.png" alt="Figura9"></p>
<p><strong>Figura 9</strong>: Diagramas de caja de la variable respuesta, <em>BDI</em>, medida a los 2, 3, 5 y 8 meses de haber iniciado el tratamiento con terapia clásica (<em>TAU</em>) y con el programa interactivo <em>Beat the Blues</em> (BtheB). Los diagramas de caja han sido agrupados horizontalmente según si el paciente recibió (<em>Yes</em>) o no (<em>No</em>) terapia farmacológica y verticalmente de acuerdo a la duración del episodio de depresión: <em>&lt;6m</em> indica menos de 6 meses y <em>&gt;6m</em> refiere a más de 6 meses.</p>
<p>La <a href="Figura9">Figura 9</a> muestra diferencias más notorias en el BDI, entre los dos grupos tratados, en aquellos pacientes que no recibieron fármacos en el tratamiento. También se aprecia cierta tendencia de mayores valores de BDI en aquellos pacientes cuya depresión duró más de seis meses, respecto de aquellos cuyos episodios fueron más cortos.</p>
<p>No debemos olvidar que estamos trabajando con datos longitudinales, es decir, correlacionados, por lo que también debemos explorar qué sucede con la variable respuesta en cada uno de los pacientes.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; ggplot(BtheB_long,aes(x=as.factor(time), y=bdi, group=patient, color=patient))+geom_point()+geom_line()+facet_grid(treatment~length+drug)+theme(legend.position = "none")+labs(x="Mes", y="BDI")</span></span></span>
</pre>
<p><img src="../Imagenes/pointsBtB.png" alt="Figura10"></p>
<p><strong>Figura 10</strong>: Diagramas de punto y línea de la variable respuesta, <em>BDI</em>, medida en 100 pacientes a los 2, 3, 5 y 8 meses de haber iniciado el tratamiento con terapia clásica (<em>TAU</em>) y con el programa interactivo <em>Beat the Blues</em> (BtheB), verticalmente agrupados. Los diagramas de caja han sido agrupados horizontalmente según si el paciente recibió (<em>Yes</em>) o no (<em>No</em>) terapia farmacológica y de acuerdo a la duración del episodio de depresión, <em>&lt;6m</em> indica menos de 6 meses y <em>&gt;6m</em> refiere a más de 6 meses.</p>
<p>La <a href="Figura10">Figura 10</a> indica la presencia de variabilidad entre los distintos pacientes, diferente en cada uno de los grupos experimentales, por lo que un MLM resulta adecuado para explicar el comportamiento de la variable respuesta.</p>
<h3>5.2 Ajuste de modelos estadísticos</h3>
<p>Cuando se debe analizar modelos de datos longitudinales, donde interesa analizar el efecto del tiempo en la variable respuesta, modelando además la aleatoriedad debida a las medidas repetidas en cada sujeto, se suele plantear dos modelos: el <em>modelo de ordenada aleatoria</em> y el <em>modelo de ordenada y pendiente aleatoria</em>. El primero de ellos (<a href="EC37">Ecuación 37</a>) incorpora un efecto aleatorio al intercepto, de manera de asumir que, parte de la variabilidad total es explicada por la variabilidad entre los distintos sujetos, la cual es constante a lo largo del tiempo ($\sigma^2_{u0}). De esta manera, se admite que la curva de regresión respecto del tiempo tenga diferentes ordenadas para los distintos sujetos.</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
y_{ij}=\beta_{0}+u_{0i}+\beta_1t_j+\epsilon_{ij},~\epsilon_{ij} \sim N(0, \sigma^2),~(u_{0i}) \sim N(0,\sigma^2_{u0})
\end{gathered}
\label{EC37}
\tag{37}
\end{equation}
</script></span>
<p>El <em>modelo de ordenada y pendiente aleatoria</em>, dado por la <a href="EC38">Ecuación 38</a>, incorpora un intercepto aleatorio asociado al sujeto(<span class="math"><script type="math/tex">u_{0i}</script></span>), y un segundo efecto aleatorio asociado a la pendiente de la recta de regresión entre el tiempo y la variable respuesta (<span class="math"><script type="math/tex">u_{1i}</script></span>). Cabe destacar que, ambos modelos, permiten la especificaciones de efectos adicionales asociados a covariables medidas en los dos niveles (tiempo e individuos).</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
y_{ij}=\beta_{0}+u_{0i}+\beta_1t_j+u_{1i}t_j+\epsilon_{ij},~\epsilon_{ij} \sim N(0, \sigma^2),~(u_{0i}, u_{1i}) \sim N(0,\boldsymbol{G}_i=\begin{bmatrix} \sigma^2_{u0} & \sigma^2_{u0,u1}\\
\sigma^2_{u0,u1} & \sigma^2_{u1}\\
\end{bmatrix})
\end{gathered}
\label{EC38}
\tag{38}
\end{equation}
</script></span>
<p>Planteemos los dos modelos con nuestro conjunto de datos, incluyendo además el resto de las covariables que se han registrado. Agreguemos además las interacciones de a pares entre las covariables.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>randomIntercept&lt;-lme(bdi~time+length+treatment+drug+bdi.pre+length:treatment+treatment:drug+bdi.pre:length+bdi.pre:drug+bdi.pre:treatment+length:drug:treatment,</span></span></span>
<span class="syntax--text syntax--plain"><span>                     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>random=~1|patient, data=BtheB_long, method = "REML")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>randomSlope&lt;-lme(bdi~time+length+treatment+drug+bdi.pre+length:treatment+treatment:drug+bdi.pre:length+bdi.pre:drug+bdi.pre:treatment+length:drug:treatment,</span></span></span>
<span class="syntax--text syntax--plain"><span>                 </span><span class="syntax--meta syntax--paragraph syntax--text"><span>random=~1+time|patient, data=BtheB_long, method = "REML")</span></span></span>
</pre>
<p><strong>Ejercicio:</strong> Hasta aquí hemos trabajado utilizando la variable <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">bdi.pre</code> como una predictora, ¿Cree Ud. que esto es correcto? Discuta el efecto de esta decisión sobre el modelo propuesto.</p>
<p>Para evaluar cuál de las estructuras de efectos aleatorios de estos modelos es preferible, planteemos la siguiente prueba de hipótesis:</p>
<span class="math"><script type="math/tex; mode=display">\begin{equation}
\begin{gathered}
H_0:~\sigma^2_{u1}=\sigma^2_{u0,u1}=0\\
H_1:~\sigma^2_{u1}\neq 0 \lor \sigma^2_{u0,u1} \neq 0
\end{gathered}
\label{EC39}
\tag{39}
\end{equation}
</script></span>
<p>Como estamos evaluando valores de los parámetros en la frontera del espacio paramétrico, y el número de parámetros que se anulan bajo <span class="math"><script type="math/tex">H_0</script></span> es dos, el estadístico del LRT se distribuirá según una mezcla de distribuciones <span class="math"><script type="math/tex">\chi^2_{2}</script></span> y <span class="math"><script type="math/tex">\chi^2_{1}</script></span>.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; stat&lt;- -2*logLik(randomIntercept, REML=T)[1]+2*logLik(randomSlope,REML=T)[1]</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; mean(pchisq(stat,c(1,2),lower.tail = F))</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># [1] 0.581104</span></span></span>
</pre>
<p>El resultado del LRT indica que no hay evidencias significativas para rechazar la hipótesis nula de la <a href="EC39">Ecuación 39</a>, por lo que se la asume cierta, prefiriendo entonces al modelo de <em>intercepto aleatorio</em>, por sobre el modelo de <em>pendiente e intercepto aleatorio</em>.</p>
<p>Con el objetivo de definir una estructura apropiada para la matriz de varianzas residual, exploremos ahora los gráficos diagnósticos del modelo.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; df&lt;-na.omit(BtheB_long)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>df$residCond&lt;-resid(randomIntercept, type="pearson")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>df$predCond&lt;-predict(randomIntercept)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>g1&lt;-ggplot(df, aes(sample=residCond))+geom_qq()+geom_qq_line()+labs(y="Cuantiles de Residuos de Pearson", x="Cuantiles teóricos")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>g2&lt;-ggplot(df, aes(x=predCond, y= residCond))+geom_point()+</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>labs(x="Valores ajustados de BDI", y="Residuos de Pearson", color="Longitud depresión")+theme(legend.position = "bottom")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>p1&lt;-plot_grid(g1,g2, nrow=1, labels=c("A)", "B)"))</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>ggsave(p1, file="../Dropbox/CursoPG/github/RCourse/imagenes/diagBtB.jpg", height = 5, width=5, dpi=400)</span></span></span>
</pre>
<p><img src="../Imagenes/diagBtB.jpg" alt="Figura10"></p>
<p><strong>Figura 10</strong>: Gráficos diagnósticos del modelo de intercepto aleatorio. <strong>A)</strong> QQ-plot de los residuos condicionales de Pearson, <strong>B)</strong> Diagrama de dispersión de los valores ajustados de medias condicionales vs. los residuos condicionales de Pearson.</p>
<p>Claramente podemos notar tanto en el QQ-plot de la <a href="Figura10">Figura 10<strong>A</strong></a> y en el diagrama de dispersión de los valores ajustados contra los residuos del modelo la existencia de cierto patrón que sugiere la necesidad de definir una estructura para la matriz de varianzas residual. El análisis de la <a href="Figura9">Figura 9</a> indica que la variabilidad entre los individuos pareciera ser mayor para aquellos individuos cuya duración del episodio de depresión fue mayor a 6 meses. Exploremos los residuos del modelo en cada uno de los grupos definidos por esta variable. Siguiendo las recomendaciones de Santos Nobre y da Motta Singer (2007), utilizaremos para esto los residuos marginales del modelo.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; df$residMarg&lt;-resid(randomIntercept, type="pearson", level=0)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; df$predMarg&lt;-predict(randomIntercept, level=0)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; g1&lt;-ggplot(df, aes(x=length, y=residMarg, fill=length))+geom_boxplot()+</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>labs(x="Longitud episodio depresión", y="Residuos de Pearson")+theme(legend.position="none")</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; g2&lt;-ggplot(df, aes(x=length, y=residMarg, fill=treatment))+geom_boxplot()+</span></span></span>
<span class="syntax--text syntax--plain"><span>    </span><span class="syntax--meta syntax--paragraph syntax--text"><span>labs(x="Longitud episodio depresión", y="Residuos de Pearson", fill="Tratamiento")+scale_x_discrete(labels = c("Yes" = "Sí","No" = "No"))+facet_wrap(~drug)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; p&lt;-plot_grid(g1,g2,labels=c("A)", "B)"), rel_widths = c(0.7,1))</span></span></span>
</pre>
<p><strong>Ejercicio</strong>: Plantee un modelo equivalente utilizando un modelo lineal con matriz de varianzas residual de estructura de simetría compuesta y compare los resultados obtenidos con el modelo de intercepto aleatorio. Discuta los resultados.</p>
<p><img src="../Imagenes/linBtB.jpg" alt="Figura11"></p>
<p><strong>Figura 11</strong>: Gráficos de cajas de los residuos marginales del modelo de intercepto aleatorio: <strong>A)</strong> Para los dos grupos de pacientes definidos según la duración del episodio de depresión, <strong>B)</strong> Para cada grupo definido por la combinación de la duración del episodio de depresión con el tratamiento recibido y el estado de prescripción de fármacos durante el experimento.</p>
<p>En la <a href="Figura11">Figura 11</a>, panel <strong>A)</strong>, se puede apreciar el mismo comportamiento previamente mencionado, donde los residuos presentan mayor variabilidad para el grupo de observaciones correspondietes a sujetos con episodios de depresión mayores a 6 meses. Por lado, el panel <strong>B)</strong> sugiere además que, a igual duración del episodio de depresión, parecería que las observaciones de pacientes tratados bajo el tratamiento convencional presentarían mayor variabilidad.  Es por ello que decidimos utilizar estas variables para definir la estructura de la matriz de varianzas de los residuos.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; randomIntercept2&lt;-lme(bdi~time+length+treatment+drug+bdi.pre+length:treatment+treatment:drug+bdi.pre:drug+bdi.pre:treatment+bdi.pre:length, random=~1|patient, data=BtheB_long, method = "REML", weights = varIdent(form=~1|length*treatment))</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; randomIntercept2</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Linear mixed-effects model fit by REML</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Data: BtheB_long</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>  Log-restricted-likelihood: -916.7057</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>  Fixed: bdi ~ time + length + treatment + drug + bdi.pre + length:treatment +      treatment:drug + bdi.pre:length + bdi.pre:drug + bdi.pre:treatment +      length:drug:treatment</span></span></span>
<span class="syntax--text syntax--plain"><span>                     </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)                             time</span></span></span>
<span class="syntax--text syntax--plain"><span>                      </span><span class="syntax--meta syntax--paragraph syntax--text"><span>-5.1315814                       -0.6715885</span></span></span>
<span class="syntax--text syntax--plain"><span>                       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>length&gt;6m                   treatmentBtheB</span></span></span>
<span class="syntax--text syntax--plain"><span>                      </span><span class="syntax--meta syntax--paragraph syntax--text"><span>11.7001698                        5.6892433</span></span></span>
<span class="syntax--text syntax--plain"><span>                         </span><span class="syntax--meta syntax--paragraph syntax--text"><span>drugYes                          bdi.pre</span></span></span>
<span class="syntax--text syntax--plain"><span>                       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>1.6833992                        1.0148570</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>length&gt;6m:treatmentBtheB           treatmentBtheB:drugYes</span></span></span>
<span class="syntax--text syntax--plain"><span>                      </span><span class="syntax--meta syntax--paragraph syntax--text"><span>-7.4051857                       -0.5396482</span></span></span>
<span class="syntax--text syntax--plain"><span>               </span><span class="syntax--meta syntax--paragraph syntax--text"><span>length&gt;6m:bdi.pre                  drugYes:bdi.pre</span></span></span>
<span class="syntax--text syntax--plain"><span>                      </span><span class="syntax--meta syntax--paragraph syntax--text"><span>-0.2943286                       -0.1016845</span></span></span>
<span class="syntax--text syntax--plain"><span>          </span><span class="syntax--meta syntax--paragraph syntax--text"><span>treatmentBtheB:bdi.pre   length&gt;6m:treatmentTAU:drugYes</span></span></span>
<span class="syntax--text syntax--plain"><span>                      </span><span class="syntax--meta syntax--paragraph syntax--text"><span>-0.2319889                       -7.4171847</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>length&gt;6m:treatmentBtheB:drugYes</span></span></span>
<span class="syntax--text syntax--plain"><span>                       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>0.8265039</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Random effects:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Formula: ~1 | patient</span></span></span>
<span class="syntax--text syntax--plain"><span>        </span><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept) Residual</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>StdDev:    6.878283  6.08293</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Variance function:</span></span></span>
<span class="syntax--text syntax--plain"><span> </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Structure: Different standard deviations per stratum</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Formula: ~1 | length * treatment</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span> Parameter estimates:</span></span></span>
<span class="syntax--text syntax--plain"><span>  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt;6m*TAU &gt;6m*BtheB &lt;6m*BtheB   &lt;6m*TAU</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>1.0000000 0.8090245 0.7330674 0.6589738</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Observations: 280</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>Number of Groups: 97</span></span></span>
</pre>
<p>Este modelo propone que la estructura de la matriz de varianzas y covarianzas de los residuos sea una matriz diagonal, con cuatro valores posibles, <span class="math"><script type="math/tex">\sigma^2_{<6m*TAU}</script></span>, <span class="math"><script type="math/tex">\sigma^2_{<6m*BtheB}</script></span>, <span class="math"><script type="math/tex">\sigma^2_{>6m*TAU}</script></span> y <span class="math"><script type="math/tex">\sigma^2_{>6mBtheB}</script></span>, de acuerdo a la duración del episodio de depresión y al tratamiento de cada individuo. Para determinar si este modelo es preferible sobre el modelo que asume homocedasticidad entre los residuos, usaremos un LRT, cuya hipótesis nula será <span class="math"><script type="math/tex">H_0=~\sigma^2_{<6m*TAU} = \sigma^2_{<6m*BtheB}=\sigma^2_{>6m*TAU}=\sigma^2_{>6mBtheB}</script></span>, mientras la hipótesis alternativa es que al menos un par de estas varianzas son diferentes entre sí.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova(randomIntercept2, randomIntercept)</span></span></span>
<span class="syntax--text syntax--plain"><span>                 </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Model df      AIC      BIC    logLik   Test  L.Ratio p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>randomIntercept2     1 18 1869.411 1933.982 -916.7057                        </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>randomIntercept      2 15 1872.275 1926.084 -921.1377 1 vs 2 8.863904  0.0312</span></span></span>
</pre>
<p>El resultado de esta prueba indica que la estructura de varianzas diferentes según la duración del episodio de depresión y el tratamiento es preferible sobre el modelo de homocedasticidad, por lo que nos quedamos con el modelo <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">randomIntercept2</code>.</p>
<p>Para determinar si esta estructura de varianzas definidas por la combinación de los niveles de las variables <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">length</code> y <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">treatment</code> es adecuada, evaluemos que sucede cuando optamos por cada una de dichas variables, en forma separada.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; randomIntercept2A&lt;-lme(bdi~time+length+treatment+drug+bdi.pre+length:treatment+treatment:drug+bdi.pre:length+bdi.pre:drug+bdi.pre:treatment+length:drug:treatment,</span></span></span>
<span class="syntax--text syntax--plain"><span>                      </span><span class="syntax--meta syntax--paragraph syntax--text"><span>random=~1|patient, data=BtheB_long, method = "REML",</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>                      weights = varIdent(form=~1|treatment))</span></span></span>
<span class="syntax--text syntax--plain"><span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; randomIntercept2B&lt;-lme(bdi~time+length+treatment+drug+bdi.pre+length:treatment+treatment:drug+bdi.pre:length+bdi.pre:drug+bdi.pre:treatment+length:drug:treatment,</span></span></span>
<span class="syntax--text syntax--plain"><span>                      </span><span class="syntax--meta syntax--paragraph syntax--text"><span>random=~1|patient, data=BtheB_long, method = "REML",</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>                      weights = varIdent(form=~1|length))</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova(randomIntercept2A, randomIntercept2)</span></span></span>
<span class="syntax--text syntax--plain"><span>                  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Model df      AIC      BIC    logLik   Test  L.Ratio p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>randomIntercept2A     1 16 1872.633 1930.029 -920.3165                        </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>randomIntercept2      2 18 1869.411 1933.982 -916.7057 1 vs 2 7.221531   0.027</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; anova(randomIntercept2B, randomIntercept2)</span></span></span>
<span class="syntax--text syntax--plain"><span>                  </span><span class="syntax--meta syntax--paragraph syntax--text"><span>Model df      AIC      BIC    logLik   Test  L.Ratio p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>randomIntercept2B     1 16 1868.083 1925.479 -918.0414                        </span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>randomIntercept2      2 18 1869.411 1933.982 -916.7057 1 vs 2 2.671391   0.263</span></span></span>
</pre>
<p>El resultado del primera llamada a la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">anova()</code> se corresponde con un LRT cuya hipótesis nula es <span class="math"><script type="math/tex">H_0:~\sigma^2_{<6m*TAU} = \sigma^2_{>6m*TAU} = \sigma^2_{TAU}~\land \sigma^2_{<6m*BtheB}=\sigma^2_{>6mBtheB}=\sigma^2_{BtheB} \land \sigma^2_{BtheB} \neq \sigma^2_{TAU}</script></span>. Los resultados de esta prueba indican que hay evidencia suficiente para rechazar la <span class="math"><script type="math/tex">H_0</script></span>, por lo que se prefiere al modelo <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">randomIntercept2</code>. Ahora bien, la segunda llamada de la función <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">anova()</code> se corresponde con un LRT que contrasta dicho modelo con aquel que plantea que las varianzas residuales serán diferentes sólo si el episodio de depresión entre dos observaciones es diferente. Es decir, el LRT con <span class="math"><script type="math/tex">H_0:~\sigma^2_{<6m*TAU} = \sigma^2_{<6m*BtheB} = \sigma^2_{<6m}~\land~ \sigma^2_{>6m*TAU}=\sigma^2_{>6m*BtheB}=\sigma^2_{>6m} \land \sigma^2_{<6m} \neq \sigma^2_{>6m}</script></span>. Los resultados de esta prueba indican que el modelo con varianzas residuales dependientes sólo de la duración del episodio de depresión es suficiente para explicar la variabilidad de los datos, por lo que lo elegimos.</p>
<p>Estudiemos ahora  os resultados de las pruebas <em>F</em> secuenciales sobre los efectos fijos del modelo seleccionado para determinar si es posible reducir el número de coeficientes a estimar.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>anova(randomIntercept2B)</span></span></span>
<span class="syntax--text syntax--plain"><span>                      </span><span class="syntax--meta syntax--paragraph syntax--text"><span>numDF denDF  F-value p-value</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>(Intercept)               1   182 399.7588  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>time                      1   182  25.9702  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>length                    1    85   5.2283  0.0247</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatment                 1    85   5.7780  0.0184</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>drug                      1    85   0.0724  0.7885</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>bdi.pre                   1    85  72.1002  &lt;.0001</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>length:treatment          1    85   3.6616  0.0590</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatment:drug            1    85   1.2315  0.2703</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>length:bdi.pre            1    85   2.4492  0.1213</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>drug:bdi.pre              1    85   2.4471  0.1215</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>treatment:bdi.pre         1    85   0.4931  0.4845</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>length:treatment:drug     2    85   0.8083  0.4490</span></span></span>
</pre>
<p>Veamos que sucede si ajustamos nuestro modelo descartando el efecto de la droga, y de las interacciones droga-tratamiento, droga-BDI previo, tratamiento-BDI previo y duración depresión-droga-tratamiento.</p>
<pre class="editor-colors lang-text"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt;randomIntercept3&lt;-lme(bdi~time+length+treatment+bdi.pre+length:treatment+length:bdi.pre,</span></span></span>
<span class="syntax--text syntax--plain"><span>                       </span><span class="syntax--meta syntax--paragraph syntax--text"><span>random=~1|patient, data=BtheB_long, method = "REML",</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>                       weights = varIdent(form=~1|length))</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; stat&lt;- -2*(logLik(randomIntercept3, REML=FALSE)[1]-logLik(randomIntercept2B, REML=FALSE)[1])</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>&gt; pchisq(stat, 6, lower.tail = FALSE)</span></span></span>
<span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span># [1] 0.2614501</span></span></span>
</pre>
<p>Como se puede apreciar, el resultado del LRT útil para evaluar si los coeficientes asociados a dichos efectos son simultáneamente nulos indican que tal hipótesis nula se puede asumir cierta, por lo que este modelo es preferible sobre el modelo que incorpora más efectos (<code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">randomIntercept2B</code>).</p>
<p><strong>Ejercicio</strong>: Explore los resultados del <code style="font-family: Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;">anova</code> sobre los coeficientes de este modelo y discuta.</p>
<p>Analicemos finalmente el ajuste del modelo, para verificar que se cumplan los supuestos. Exploraremos primero el QQ-plot de los residuos, mostrado en la <a href="Figura12">Figura 12</a> panel <strong>A)</strong>. En este gráfico se ha discriminado los resultados para considerar por separado los dos grupos de observaciones definidos según la longitud del período de depresión, ya que se asume que ambos provienen de dos distribuciones normales pero con diferentes varianzas.</p>
<p><img src="../Imagenes/diagBtB2.jpg" alt="Figura12"></p>
<p><strong>Figura 12</strong>:  Gráficos diagnósticos del modelo de intercepto aleatorio. <strong>A)</strong> QQ-plot de los residuos condicionales de Pearson, <strong>B)</strong> Diagrama de dispersión de los valores ajustados de medias condicionales vs. los residuos condicionales de Pearson. En ambos casos se ha graficado en forma separada los resultados según la duración del episodio de depresión de cada sujeto.</p>
<p>El análisis de la <a href="Figura12">Figura 12</a> revela cierto grado de homocedasticidad de los residuos del modelo. Cabe destacar aquí que la verificación de los supuestos de un MLM no es tan sencilla o directa como el caso de los ML. Aquí hemos explorado los gráficos diagnósticos considerando siempre los residuos condicionados a los valores estimados (EBLUPs) de los efectos aleatorios, los cuales también pueden estar sujetos a violaciones de los supuestos del modelo.</p>

  </body>
</html>
